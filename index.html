<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVA - Trámites Vehiculares en Morelos</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap" rel="stylesheet">
    <script src="https://www.google.com/recaptcha/api.js?render=6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV" async defer></script>
    <script src="https://elfsightcdn.com/platform.js" async></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

        :root {
            --azul-dark:   #0A1F44;
            --azul-mid:    #162d54;
            --azul-blue:   #165DFF;
            --azul-light:  #e8f0ff;
            --blanco:      #FFFFFF;
            --gris-dark:   #333333;
            --gris-mid:    #6b7280;
            --gris-light:  #f3f6fa;
            --gris-border: #dde3ec;
            --verde:       #22c55e;
            --rojo:        #ef4444;
            --r:           10px;
            --r-lg:        16px;
            --shadow:      0 4px 24px rgba(10,31,68,.10);
            --shadow-lg:   0 8px 40px rgba(10,31,68,.14);
            /* For summary component */
            --p:  #0A1F44;
            --a:  #165DFF;
            --bd: #dde3ec;
            --bg: #f3f6fa;
            --mid: #6b7280;
            --lt:  #9ca3af;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #eef2f8;
            color: var(--gris-dark);
            min-height: 100vh;
            padding: 24px 16px 100px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .wrapper {
            max-width: 860px;
            margin: 0 auto;
            animation: fadeUp .6s ease both;
        }
        @keyframes fadeUp {
            from { opacity:0; transform:translateY(20px); }
            to   { opacity:1; transform:translateY(0); }
        }

        /* ── HEADER ── */
        .hdr {
            background: linear-gradient(135deg, var(--azul-dark) 0%, var(--azul-mid) 100%);
            border-radius: var(--r-lg) var(--r-lg) 0 0;
            padding: 40px 40px 34px;
            text-align: center;
            position: relative; overflow: hidden;
        }
        .hdr::before {
            content:''; position:absolute; inset:0;
            background: radial-gradient(ellipse 80% 60% at 50% 120%, rgba(22,93,255,.28) 0%, transparent 70%);
        }
        .hdr-logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.7rem; font-weight: 800;
            letter-spacing: 3px;
            position: relative; z-index:1; line-height:1; margin-bottom:8px;
        }
        .hdr-logo .letra-a  { color: var(--blanco); font-style:normal; }
        .hdr-logo .letra-va { color: var(--azul-blue); font-style:normal; }
        .hdr-sub {
            font-size: .78rem; font-weight:600; letter-spacing:4px;
            text-transform:uppercase; color:rgba(255,255,255,.70);
            position:relative; z-index:1;
        }

        /* ── FORM CARD ── */
        .form-card {
            background: var(--blanco);
            border:1px solid var(--gris-border); border-top:none;
            border-radius:0 0 var(--r-lg) var(--r-lg);
            padding: 40px; box-shadow: var(--shadow-lg);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        /* ── SECTION TITLE ── */
        .sec-title {
            display:flex; align-items:center; gap:12px;
            margin-bottom:24px; padding-bottom:14px;
            border-bottom:2px solid var(--azul-blue);
        }
        .sec-icon {
            width:34px; height:34px; background:var(--azul-light);
            border-radius:8px; display:flex; align-items:center; justify-content:center;
            font-size:1rem; flex-shrink:0;
            transition: background 0.3s ease;
        }
        .sec-title h2 {
            font-size:.88rem; font-weight:700; letter-spacing:1.5px;
            text-transform:uppercase; color:var(--azul-dark);
            transition: color 0.3s ease;
        }

        /* ── GRID ── */
        .g2 { display:grid; grid-template-columns:1fr 1fr; gap:18px; }
        .g-full { grid-column:1 / -1; }

        /* ── FIELD ── */
        .fld { display:flex; flex-direction:column; gap:6px; }
        .fld label {
            font-size:.8rem; font-weight:600; color:var(--azul-dark); letter-spacing:.2px;
            transition: color 0.3s ease;
        }
        .fld label .req { color:var(--azul-blue); margin-left:2px; }
        .fld label .opt { color:var(--gris-mid); font-weight:400; font-style:italic; margin-left:4px; font-size:.75rem; }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        select {
            width:100%; padding:11px 14px;
            border:1.5px solid var(--gris-border);
            border-radius:var(--r);
            font-size:.9rem; font-family:'Inter',sans-serif; color:var(--gris-dark);
            background:var(--blanco);
            transition:border-color .25s, box-shadow .25s, background-color 0.3s ease, color 0.3s ease;
        }
        input::placeholder { color:#b0b9c8; transition: color 0.3s ease; }
        input:focus, select:focus {
            outline:none; border-color:var(--azul-blue);
            box-shadow:0 0 0 3px rgba(22,93,255,.11);
        }
        select {
            cursor:pointer; appearance:none;
            background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23165DFF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat:no-repeat; background-position:right 12px center;
            padding-right:40px;
        }

        /* ── DIVIDER ── */
        .div { height:1px; background:var(--gris-border); margin:30px 0; transition: background 0.3s ease; }

        /* ── COST PILL ── */
        .cost-pill {
            display:none; align-items:center; justify-content:space-between;
            background:linear-gradient(135deg, var(--azul-light) 0%, #dbeafe 100%);
            border:1.5px solid var(--azul-blue);
            border-radius:var(--r-lg); padding:14px 20px; margin-top:10px;
            animation:fadeUp .4s ease;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .cost-pill.show { display:flex; }
        .cp-lbl { font-size:.8rem; font-weight:700; color:var(--azul-dark); transition: color 0.3s ease; }
        .cp-amt { font-size:1.65rem; font-weight:800; color:var(--azul-blue); font-feature-settings:"tnum"; }

        /* ── REQ BOX ── */
        .rbox { background:var(--gris-light); border-radius:var(--r-lg); border:1px solid var(--gris-border); overflow:hidden; transition: background 0.3s ease, border-color 0.3s ease; }
        .rbox-head {
            background:var(--azul-dark); color:var(--blanco);
            padding:12px 18px; font-size:.78rem; font-weight:700;
            letter-spacing:1px; text-transform:uppercase;
            display:flex; align-items:center; gap:8px;
        }
        .rbox-body { padding:18px; }
        .r-alert {
            background:#fefce8; border:1px solid #facc15;
            border-radius:8px; padding:12px 14px;
            font-size:.8rem; color:#854d0e; margin-bottom:16px; line-height:1.6;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .rg-title {
            font-size:.75rem; font-weight:700; text-transform:uppercase;
            letter-spacing:.8px; color:var(--azul-blue); margin:14px 0 7px;
        }
        .rlist { list-style:none; }
        .rlist li {
            font-size:.8rem; line-height:1.6; padding:5px 0 5px 22px;
            position:relative; border-bottom:1px solid rgba(0,0,0,.04);
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .rlist li:last-child { border-bottom:none; }
        .rlist li.ob::before { content:'✓'; position:absolute; left:0; top:5px; color:var(--azul-blue); font-weight:800; }
        .rlist li.op::before { content:'○'; position:absolute; left:1px; top:5px; color:var(--gris-mid); font-weight:800; }
        .bOb {
            display:inline-block; background:var(--azul-blue); color:#fff;
            font-size:.6rem; font-weight:800; padding:1px 5px; border-radius:3px;
            margin-right:3px; vertical-align:middle; text-transform:uppercase;
        }
        .bOp {
            display:inline-block; background:var(--gris-mid); color:#fff;
            font-size:.6rem; font-weight:800; padding:1px 5px; border-radius:3px;
            margin-right:3px; vertical-align:middle; text-transform:uppercase;
        }
        .r-fmt {
            background:#eff6ff; border:1px solid #93c5fd;
            border-radius:8px; padding:12px 14px;
            font-size:.79rem; color:#1e40af; margin-top:14px; line-height:1.7;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* ── LEGIBILITY GUIDE ── */
        .legibility-guide {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
            margin-top: 16px; margin-bottom: 4px;
        }
        .leg-card {
            border-radius: 10px; padding: 14px 16px;
            display: flex; align-items: flex-start; gap: 12px;
        }
        .leg-card--ok {
            background: #f0fdf4; border: 1.5px solid #86efac;
        }
        .leg-card--no {
            background: #fef2f2; border: 1.5px solid #fca5a5;
        }
        .leg-card-icon {
            width: 28px; height: 28px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: .85rem; flex-shrink: 0; margin-top: 1px;
        }
        .leg-card--ok .leg-card-icon { background: #22c55e; }
        .leg-card--no .leg-card-icon { background: #ef4444; }
        .leg-card-body { flex: 1; }
        .leg-card-title {
            font-size: .75rem; font-weight: 800; letter-spacing: .08em;
            text-transform: uppercase; margin-bottom: 3px;
        }
        .leg-card--ok .leg-card-title { color: #166534; }
        .leg-card--no .leg-card-title { color: #991b1b; }
        .leg-card-desc { font-size: .74rem; line-height: 1.55; }
        .leg-card--ok .leg-card-desc { color: #166534; }
        .leg-card--no .leg-card-desc { color: #991b1b; }

        .auth-req {
            background: #f8fafc; border: 1.5px solid var(--gris-border);
            border-left: 4px solid var(--azul-blue);
            border-radius: 0 10px 10px 0;
            padding: 13px 16px;
            font-size: .8rem; color: var(--gris-dark); line-height: 1.6;
            margin-top: 14px;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .auth-req strong { color: var(--azul-dark); }

        /* ── FILE UPLOAD (JSZip Component) ── */
        .attach-dropzone {
            border: 2.5px dashed var(--gris-border);
            border-radius: var(--r-lg);
            padding: 28px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--gris-light);
            position: relative;
            overflow: hidden;
        }
        .attach-dropzone:hover,
        .attach-dropzone.drag-over {
            border-color: var(--azul-blue);
            background: rgba(22,93,255,.04);
        }
        .attach-dropzone.drag-over::before {
            content: 'Suelta aquí';
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; font-weight: 700; color: var(--azul-blue);
            background: rgba(22,93,255,.08); border-radius: 13px;
        }
        .attach-folder-icon { font-size: 44px; margin-bottom: 10px; display: block; }
        .attach-dropzone-text { font-size: 14px; color: var(--gris-mid); line-height: 1.6; }
        .attach-dropzone-text a { color: var(--azul-blue); font-weight: 600; cursor: pointer; text-decoration: none; }
        .attach-formats-line { font-size: .79rem; color: var(--gris-mid); margin-top: 4px; }
        .attach-formats-line strong { color: var(--gris-dark); }
        .attach-auto-compress-line { font-size: .78rem; color: var(--azul-blue); font-weight: 600; margin-top: 5px; }
        .attach-limit-line { font-size: .78rem; color: var(--gris-mid); margin-top: 3px; }
        .attach-limit-line strong { color: var(--gris-dark); }

        .attach-realtime-stats {
            display: none; align-items: center; justify-content: center;
            gap: 10px; margin-top: 10px;
            background: var(--azul-light); border-radius: 8px;
            padding: 8px 14px; font-size: .8rem; font-weight: 600; color: var(--azul-dark);
        }
        .attach-stats-sep { color: var(--gris-mid); }

        .attach-limit-exceeded {
            display: none;
            background: #fef2f2; color: #991b1b;
            border-radius: 8px; padding: 8px 14px;
            font-size: .78rem; font-weight: 700; margin-top: 8px;
        }

        /* Capacity bar */
        .attach-capacity-wrap { margin-top: 16px; display: none; }
        .attach-capacity-wrap.visible { display: block; }
        .attach-capacity-header {
            display: flex; justify-content: space-between; margin-bottom: 6px;
            font-size: .76rem; font-weight: 600; color: var(--azul-dark);
        }
        .attach-capacity-label { text-transform: uppercase; letter-spacing: .05em; }
        .attach-capacity-value { color: var(--gris-mid); }
        .attach-bar-track {
            height: 10px; background: #e5e7eb;
            border-radius: 99px; overflow: hidden;
        }
        .attach-bar-fill {
            height: 100%; border-radius: 99px;
            transition: width 0.4s ease;
            position: relative; overflow: hidden;
        }
        .attach-bar-fill::after {
            content: ''; position: absolute; top: 0; left: -60px;
            width: 50px; height: 100%;
            background: linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent);
            animation: barShine 2s infinite;
        }
        @keyframes barShine { 0%{left:-60px} 100%{left:calc(100% + 20px)} }
        .attach-bar-fill.green  { background: linear-gradient(90deg,#0FC373,#12e080); }
        .attach-bar-fill.yellow { background: linear-gradient(90deg,#F59E0B,#fbbf24); }
        .attach-bar-fill.red    { background: linear-gradient(90deg,#FF4757,#ff6370); }
        .attach-bar-fill.red::after { display: none; }

        .attach-status {
            margin-top: 6px; font-size: 12.5px;
            display: flex; align-items: center; gap: 6px;
        }
        .attach-status-dot {
            width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
        }
        .attach-status-dot.green  { background: #0FC373; }
        .attach-status-dot.yellow { background: #F59E0B; }
        .attach-status-dot.red    { background: #FF4757; animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 0%,100%{opacity:1} 50%{opacity:.4} }

        .attach-error-msg {
            background: rgba(255,71,87,.08); border: 1.5px solid rgba(255,71,87,.3);
            border-radius: 10px; padding: 10px 14px;
            font-size: 12.5px; color: #d93546;
            margin-top: 10px; display: none; align-items: center; gap: 8px;
        }
        .attach-error-msg.show { display: flex; }

        /* File list */
        .attach-file-list { margin-top: 12px; display: flex; flex-direction: column; gap: 6px; }
        .attach-file-item {
            display: flex; align-items: center; gap: 10px;
            background: var(--blanco); border: 1px solid var(--gris-border);
            border-radius: 10px; padding: 9px 12px;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .attach-file-icon { font-size: 1.1rem; flex-shrink: 0; }
        .attach-file-name { flex: 1; font-size: 13px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--azul-dark); }
        .attach-file-size { font-size: 12px; color: var(--gris-mid); flex-shrink: 0; }
        .attach-file-remove {
            width: 24px; height: 24px; border-radius: 50%; border: none;
            background: rgba(255,71,87,.1); color: #FF4757;
            cursor: pointer; font-size: 14px; transition: all .2s;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .attach-file-remove:hover { background: #FF4757; color: #fff; }

        /* Offline notice */
        .offline-msg {
            background: rgba(255,71,87,.08); border: 1.5px solid rgba(255,71,87,.25);
            border-radius: 10px; padding: 10px 14px;
            font-size: 12.5px; color: #d93546;
            margin-top: 10px; display: none; align-items: center; gap: 8px;
        }
        .offline-msg.show { display: flex; }

        /* Compression progress panel */
        .compress-progress {
            display: none; border: 1.5px solid var(--gris-border);
            border-radius: 14px; overflow: hidden; margin-top: 14px;
            transition: border-color 0.3s ease;
        }
        .compress-progress.show { display: block; }
        .compress-header {
            background: var(--azul-dark); padding: 12px 16px;
            display: flex; align-items: center; gap: 8px;
        }
        .compress-header-text {
            font-size: 12px; font-weight: 700; letter-spacing: 1px;
            text-transform: uppercase; color: #fff;
        }
        .compress-pct { font-weight: 700; color: var(--azul-blue); font-size: 12.5px; margin-left: auto; }
        .compress-body { padding: 14px 16px; background: var(--gris-light); transition: background 0.3s ease; }
        .compress-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .compress-stat { text-align: center; }
        .compress-stat-val { font-size: 16px; font-weight: 800; color: var(--azul-dark); transition: color 0.3s ease; }
        .compress-stat-label { font-size: 10.5px; color: var(--gris-mid); text-transform: uppercase; letter-spacing: .5px; margin-top: 2px; }
        .compress-bar-track { height: 8px; background: #e5e7eb; border-radius: 99px; overflow: hidden; margin-bottom: 8px; }
        .compress-bar-fill {
            height: 100%; background: linear-gradient(90deg,#165DFF,#3a7fff);
            border-radius: 99px; width: 0%; transition: width .3s ease;
            position: relative; overflow: hidden;
        }
        .compress-bar-fill::after {
            content: ''; position: absolute; top: 0; left: -60px;
            width: 50px; height: 100%;
            background: linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent);
            animation: barShine 1.5s infinite;
        }
        .compress-info { display: flex; justify-content: space-between; font-size: 11.5px; color: var(--gris-mid); }
        .compress-resume-note {
            background: rgba(245,158,11,.1); border: 1px solid rgba(245,158,11,.3);
            border-radius: 8px; padding: 8px 12px; font-size: 12px; color: #92400e;
            margin-top: 8px; display: none; align-items: center; gap: 6px;
        }
        .compress-resume-note.show { display: flex; }

        /* ── SUMMARY BOX ── */
        .sumbox {
            background: #fff;
            border: 1.5px solid var(--bd);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1.4rem;
            box-shadow: 0 2px 16px rgba(10,31,68,.07);
            transition: background .3s ease, border-color .3s ease;
        }
        .sum-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 1rem 1.35rem .9rem;
            background: linear-gradient(135deg, var(--p) 0%, #0e2a60 100%);
            position: relative; overflow: hidden;
        }
        .sum-header::before {
            content: ''; position: absolute; top: -28px; right: -28px;
            width: 110px; height: 110px; border-radius: 50%;
            background: radial-gradient(circle,rgba(91,142,255,.25) 0%,transparent 70%);
            pointer-events: none;
        }
        .sum-header-left { display: flex; align-items: center; gap: .65rem; position: relative; z-index: 1; }
        .sum-header-icon {
            width: 34px; height: 34px; border-radius: 8px;
            background: rgba(255,255,255,.12);
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .sum-header-icon svg { width: 17px; height: 17px; fill: #fff; }
        .sum-ttl { font-size: .82rem; font-weight: 800; color: #fff; letter-spacing: .07em; text-transform: uppercase; }
        .sum-ttl-sub { font-size: .68rem; color: rgba(255,255,255,.55); font-weight: 400; margin-top: .1rem; }
        .sum-badge {
            display: inline-flex; align-items: center; gap: .35rem;
            background: rgba(15,195,115,.18); border: 1px solid rgba(15,195,115,.4);
            border-radius: 99px; padding: .26rem .72rem;
            font-size: .68rem; font-weight: 700; color: #6eeabb;
            letter-spacing: .04em; text-transform: uppercase;
            position: relative; z-index: 1;
        }
        .sum-badge-dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: #0FC373; animation: pulseDot 2s ease-in-out infinite;
        }
        @keyframes pulseDot {
            0%,100% { opacity:1; transform:scale(1); }
            50%      { opacity:.5; transform:scale(.75); }
        }
        .sum-body {}
        .sum-group { padding: .9rem 1.35rem; }
        .sum-group + .sum-group { border-top: 1px solid #EEF2F7; }
        .sum-group-label { display: flex; align-items: center; gap: .45rem; margin-bottom: .7rem; }
        .sum-group-label-icon { font-size: .88rem; }
        .sum-group-label-text { font-size: .68rem; font-weight: 800; color: var(--a); letter-spacing: .1em; text-transform: uppercase; }
        .sum-row { display: flex; align-items: baseline; gap: .5rem; font-size: .8rem; line-height: 1.9; }
        .sum-k { color: var(--mid); font-weight: 500; min-width: 148px; flex-shrink: 0; font-size: .77rem; }
        .sum-v { color: #1a1a2e; font-weight: 600; font-size: .82rem; word-break: break-word; }
        .sum-v--empty { color: var(--lt); font-weight: 400; font-style: italic; }
        .sum-chip {
            display: inline-block; background: rgba(22,93,255,.08);
            color: #1e40af; border: 1px solid rgba(22,93,255,.2);
            border-radius: 99px; padding: .12rem .6rem;
            font-size: .76rem; font-weight: 600;
        }
        .sum-chip--files {
            background: rgba(15,195,115,.1); color: #166534;
            border-color: rgba(15,195,115,.3);
        }
        .sum-chip--amount {
            background: rgba(245,158,11,.1); color: #92400e;
            border-color: rgba(245,158,11,.3);
        }
        .sum-footer {
            display: flex; align-items: flex-start; gap: .6rem;
            padding: .85rem 1.35rem; border-top: 1px solid #EEF2F7;
            background: #F8FAFC;
        }
        .sum-footer-icon { font-size: 1rem; flex-shrink: 0; margin-top: .05rem; }
        .sum-footer-text { font-size: .76rem; color: var(--mid); line-height: 1.55; }
        .sum-footer-text strong { color: var(--azul-dark); }

        /* ── CASILLA DE VERIFICACIÓN ── */
        .check-wrap {
            background: var(--gris-light);
            border: 1.5px solid var(--gris-border);
            border-radius: var(--r-lg);
            padding: 18px 20px;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .check-label {
            display: flex; align-items: flex-start; gap: 14px; cursor: pointer;
        }
        .check-label input[type="checkbox"] { display: none; }
        .check-box {
            width: 22px; height: 22px; min-width: 22px;
            border: 2px solid var(--gris-border);
            border-radius: 5px; background: var(--blanco);
            display: flex; align-items: center; justify-content: center;
            margin-top: 1px;
            transition: all .2s ease;
        }
        .check-box::after {
            content: ''; display: none;
            width: 6px; height: 11px;
            border: 2.5px solid var(--blanco);
            border-top: none; border-left: none;
            transform: rotate(45deg) translateY(-1px);
        }
        .check-label input:checked ~ .check-box {
            background: var(--azul-blue); border-color: var(--azul-blue);
        }
        .check-label input:checked ~ .check-box::after { display: block; }
        .check-label:hover .check-box { border-color: var(--azul-blue); }
        .check-txt {
            font-size: .77rem; line-height: 1.65;
            color: var(--gris-dark); font-weight: 500;
            transition: color 0.3s ease;
        }

        /* ── TELÉFONO CON LADA ── */
        .phone-wrap {
            display: flex; gap: 0;
            border: 1.5px solid var(--gris-border);
            border-radius: var(--r);
            overflow: visible;
            transition: border-color .25s, box-shadow .25s;
            position: relative;
        }
        .phone-wrap:focus-within {
            border-color: var(--azul-blue);
            box-shadow: 0 0 0 3px rgba(22,93,255,.11);
        }

        .lada-custom {
            position: relative; flex-shrink: 0;
            border-right: 1.5px solid var(--gris-border);
            background: var(--gris-light);
            border-radius: var(--r) 0 0 var(--r);
            user-select: none;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .lada-trigger {
            display: flex; align-items: center; gap: 6px;
            padding: 11px 10px 11px 12px;
            cursor: pointer; min-width: 108px;
            font-size: .85rem; font-family: 'Inter', sans-serif;
            color: var(--gris-dark); white-space: nowrap;
            transition: color 0.3s ease;
        }
        .lada-trigger .lada-flag  { font-size: 1.15rem; line-height: 1; }
        .lada-trigger .lada-code  { font-weight: 600; }
        .lada-trigger .lada-arrow {
            margin-left: auto; font-size: .65rem; color: var(--azul-blue);
            transition: transform .2s;
        }
        .lada-custom.open .lada-arrow { transform: rotate(180deg); }

        .lada-dropdown {
            display: none; position: absolute; top: calc(100% + 4px); left: -1px;
            width: 220px; max-height: 280px; overflow-y: auto;
            background: var(--blanco); border: 1.5px solid var(--azul-blue);
            border-radius: var(--r); box-shadow: 0 8px 24px rgba(10,31,68,.14);
            z-index: 200;
            transition: background 0.3s ease;
        }
        .lada-custom.open .lada-dropdown { display: block; }

        .lada-search {
            padding: 8px 10px;
            border-bottom: 1px solid var(--gris-border);
            position: sticky; top: 0; background: var(--blanco); z-index: 1;
            transition: background 0.3s ease;
        }
        .lada-search input {
            width: 100%; border: 1.5px solid var(--gris-border); border-radius: 7px;
            padding: 6px 10px; font-size: .8rem; font-family: 'Inter', sans-serif;
            outline: none; color: var(--gris-dark);
            transition: border-color .2s, background 0.3s ease, color 0.3s ease;
        }
        .lada-search input:focus { border-color: var(--azul-blue); }

        .lada-opt {
            display: flex; align-items: center; gap: 9px;
            padding: 9px 12px; cursor: pointer; font-size: .83rem;
            transition: background .15s;
        }
        .lada-opt:hover   { background: var(--azul-light); }
        .lada-opt.active  { background: var(--azul-light); font-weight: 700; }
        .lada-opt .lo-flag { font-size: 1.1rem; line-height: 1; flex-shrink: 0; }
        .lada-opt .lo-name { color: var(--gris-mid); font-size: .76rem; flex: 1; }
        .lada-opt .lo-code { font-weight: 600; color: var(--azul-dark); flex-shrink: 0; }

        .lada-select-hidden { display: none !important; }

        .phone-input {
            border: none !important;
            border-radius: 0 var(--r) var(--r) 0 !important;
            box-shadow: none !important;
            flex: 1;
        }
        .phone-input:focus { outline: none; box-shadow: none !important; }

        /* ── RECAPTCHA ── */
        .recap { margin:26px 0 18px; text-align:center; min-height:32px; }
        .recap-spin {
            display:inline-block; width:26px; height:26px;
            border:3px solid var(--gris-border);
            border-top:3px solid var(--azul-blue);
            border-radius:50%; animation:spin 1s linear infinite;
        }
        @keyframes spin { to { transform:rotate(360deg); } }
        .recap-txt { font-size:.79rem; margin-top:7px; color:var(--gris-mid); transition: color 0.3s ease; }
        .recap-txt.ok  { color:var(--verde); }
        .recap-txt.err { color:var(--rojo); }

        /* ── SUBMIT ── */
        .btn-submit {
            width:100%; padding:14px;
            background:linear-gradient(135deg, var(--azul-blue) 0%, #0d3dcc 100%);
            color:var(--blanco); border:none; border-radius:var(--r-lg);
            font-family:'Inter',sans-serif; font-size:.9rem; font-weight:700;
            letter-spacing:.8px; text-transform:uppercase;
            cursor:pointer;
            box-shadow:0 6px 18px rgba(22,93,255,.28);
            transition:transform .2s, box-shadow .2s, opacity .2s;
        }
        .btn-submit:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 10px 28px rgba(22,93,255,.38); }
        .btn-submit:disabled { opacity:.5; cursor:not-allowed; }

        /* ── TOAST ── */
        .toast { display:none; margin-top:16px; padding:13px 16px; border-radius:var(--r); font-size:.84rem; font-weight:600; text-align:center; }
        .toast.ok  { background:#f0fdf4; color:#166534; border:1px solid #bbf7d0; display:block; }
        .toast.err { background:#fef2f2; color:#991b1b; border:1px solid #fecaca; display:block; }

        /* ── HIDDEN ── */
        .sec-hide { display:none; }

        /* ── SUCCESS MODAL ── */
        .success-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(8,18,42,0.75); backdrop-filter: blur(6px);
            z-index: 9000; align-items: center; justify-content: center; padding: 20px;
        }
        .success-overlay.show { display: flex; }
        .success-card {
            background: #ffffff; border-radius: 28px;
            width: 100%; max-width: 460px;
            box-shadow: 0 32px 80px rgba(10,31,68,0.28), 0 8px 24px rgba(10,31,68,0.12);
            animation: popIn 0.45s cubic-bezier(0.34,1.56,0.64,1);
            overflow: hidden;
        }
        @keyframes popIn {
            from { opacity:0; transform:scale(0.8) translateY(20px); }
            to   { opacity:1; transform:scale(1) translateY(0); }
        }
        .success-header-modal {
            background: linear-gradient(135deg, #0A1F44 0%, #0e2a60 100%);
            padding: 40px 40px 36px; position: relative; overflow: hidden; text-align: center;
        }
        .success-header-modal::before {
            content:''; position:absolute; top:-40px; right:-40px;
            width:180px; height:180px; border-radius:50%;
            background:radial-gradient(circle,rgba(22,93,255,0.35) 0%,transparent 70%);
        }
        .success-header-modal::after {
            content:''; position:absolute; bottom:-30px; left:-30px;
            width:120px; height:120px; border-radius:50%;
            background:radial-gradient(circle,rgba(22,93,255,0.2) 0%,transparent 70%);
        }
        .success-checkmark {
            width:72px; height:72px;
            background: linear-gradient(135deg, #165DFF, #0FC373);
            border-radius:50%; display:flex; align-items:center; justify-content:center;
            margin: 0 auto 20px; position:relative; z-index:1;
            box-shadow: 0 8px 24px rgba(15,195,115,0.4);
            animation: checkPop 0.5s 0.3s cubic-bezier(0.34,1.56,0.64,1) both;
        }
        .success-checkmark svg { width:36px; height:36px; }
        @keyframes checkPop {
            from { transform:scale(0) rotate(-20deg); }
            to   { transform:scale(1) rotate(0deg); }
        }
        .success-title    { font-size:24px; font-weight:800; color:#fff; margin-bottom:8px; position:relative; z-index:1; }
        .success-subtitle { font-size:13px; color:rgba(255,255,255,0.6); letter-spacing:1.5px; text-transform:uppercase; position:relative; z-index:1; }
        .success-body-modal { padding: 28px 32px 32px; }
        .success-info-row {
            display:flex; align-items:flex-start; gap:14px;
            background:#F4F6FB; border-radius:14px; padding:16px 18px; margin-bottom:12px;
        }
        .success-info-icon {
            width:38px; height:38px; border-radius:10px;
            background:rgba(22,93,255,0.1);
            display:flex; align-items:center; justify-content:center;
            flex-shrink:0; margin-top:1px;
        }
        .success-info-icon svg { width:18px; height:18px; }
        .success-info-text { font-size:13px; color:#6B7A99; line-height:1.6; }
        .success-info-text strong { display:block; color:#333; font-size:14px; font-weight:700; margin-bottom:4px; }
        .success-contact-list { display:flex; flex-direction:column; gap:6px; margin-top:6px; }
        .success-contact-item { display:flex; align-items:center; gap:8px; font-size:13px; color:#444; font-weight:500; }
        .success-contact-item a { color:#165DFF; text-decoration:none; font-weight:600; }
        .success-divider { height:1px; background:#E8ECF4; margin:20px 0; }
        .success-close-btn {
            width:100%;
            background: linear-gradient(135deg, #165DFF, #0e46cc);
            color:#fff; border:none; border-radius:14px;
            padding:16px 28px; font-size:15px; font-weight:700;
            cursor:pointer; transition:all 0.25s;
            box-shadow: 0 6px 20px rgba(22,93,255,0.35);
        }
        .success-close-btn:hover { transform:translateY(-2px); box-shadow:0 10px 30px rgba(22,93,255,0.5); }

        /* ── WHATSAPP ── */
        .wa-btn {
            position:fixed; bottom:50px; left:50px;
            background:linear-gradient(135deg,#25d366 0%,#128c7e 100%);
            color:white; width:72px; height:72px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            box-shadow:0 10px 30px rgba(37,211,102,.4);
            cursor:pointer; z-index:900;
            transition:all .4s cubic-bezier(.4,0,.2,1);
            text-decoration:none;
            animation:waFloat 3s ease-in-out infinite;
            border:4px solid white; overflow:hidden;
        }
        .wa-btn::before {
            content:''; position:absolute; inset:0;
            background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.3) 50%,transparent 70%);
            animation:waShine 3s infinite;
        }
        .wa-btn:hover { transform:scale(1.18) translateY(-5px); box-shadow:0 20px 40px rgba(37,211,102,.6); animation:none; }
        .wa-tip {
            position:absolute; left:90px; background:white; color:#333;
            padding:11px 18px; border-radius:10px; white-space:nowrap;
            box-shadow:0 8px 24px rgba(0,0,0,.14); opacity:0; pointer-events:none;
            transition:all .4s cubic-bezier(.4,0,.2,1);
            font-size:.85rem; font-weight:600; border:1px solid rgba(0,0,0,.08); z-index:901;
        }
        .wa-btn:hover .wa-tip { opacity:1; transform:translateX(10px); }
        .wa-svg { width:32px; height:32px; position:relative; z-index:1; }
        .wa-svg path { fill:white; }
        @keyframes waFloat {
            0%,100% { transform:translateY(0) rotate(0deg); }
            25%      { transform:translateY(-13px) rotate(2deg); }
            75%      { transform:translateY(-5px) rotate(-2deg); }
        }
        @keyframes waShine {
            0%   { transform:translateX(-100%); }
            100% { transform:translateX(100%); }
        }

        .elfsight-app-beb4a331-0ecc-4c09-b401-4d88d35cbf03 { z-index:950 !important; }

        /* ── THEME TOGGLE ── */
        .theme-toggle-btn {
          position: fixed; top: 20px; right: 20px; z-index: 2000;
          width: 52px; height: 52px; border-radius: 50%;
          background: linear-gradient(145deg, #e8ecf4, #d0d6e8);
          box-shadow: 0 6px 20px rgba(0,0,0,0.18), inset 0 -2px 4px rgba(0,0,0,0.15), inset 0 2px 4px rgba(255,255,255,0.9);
          cursor: pointer; border: none; outline: none; overflow: hidden;
          transition: all 0.3s ease; animation: subtlePulse 3s infinite ease-in-out;
        }
        .theme-toggle-btn::before {
          content: ''; position: absolute; top: -50%; left: -50%;
          width: 200%; height: 200%;
          background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.75) 0%, rgba(255,255,255,0) 65%);
          opacity: 0; transition: opacity 0.4s ease; pointer-events: none;
        }
        .theme-toggle-btn:hover::before { opacity: 1; }
        .theme-toggle-btn:hover { animation: none; transform: scale(1.08); }
        .theme-toggle-btn:active { transform: scale(0.94); }
        @keyframes subtlePulse {
          0%,100% { transform: scale(1); } 50% { transform: scale(1.03); }
        }
        .toggle-icon-wrap {
          position: relative; width: 100%; height: 100%;
          display: flex; align-items: center; justify-content: center;
          transition: transform 0.5s cubic-bezier(0.34,1.56,0.64,1);
        }
        .theme-toggle-btn:hover .toggle-icon-wrap { transform: rotate(20deg); }
        .icon-sun, .icon-moon {
          position: absolute; width: 28px; height: 28px;
          transition: all 0.45s cubic-bezier(0.68,-0.55,0.265,1.55);
        }
        .icon-sun { opacity:1; transform:scale(1) rotate(0deg); filter:drop-shadow(0 0 4px rgba(255,215,0,0.6)); }
        .icon-moon { opacity:0; transform:scale(0.4) rotate(-80deg); filter:drop-shadow(0 0 4px rgba(100,120,255,0.6)); }
        body.dark-mode .icon-sun  { opacity:0; transform:scale(0.4) rotate(80deg); }
        body.dark-mode .icon-moon { opacity:1; transform:scale(1) rotate(0deg); }
        body.dark-mode .theme-toggle-btn {
          background: linear-gradient(145deg, #1e2d50, #0f1d38);
          box-shadow: 0 6px 20px rgba(0,0,0,0.4), 0 0 15px rgba(65,105,225,0.3), inset 0 -2px 4px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.06);
        }

        /* ── FLOATING BUTTON TRAMITE ── */
        .tramite-float {
            position:fixed; top:50px; left:50px;
            background:linear-gradient(135deg,#0A1F44 0%,#1a3a6e 100%);
            color:white; width:75px; height:75px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            box-shadow:0 10px 30px rgba(10,31,68,.4);
            cursor:pointer; z-index:1000;
            transition:all .4s cubic-bezier(.4,0,.2,1);
            text-decoration:none;
            animation:floatPremium 3s ease-in-out infinite;
            border:4px solid white; overflow:hidden;
        }
        .tramite-float::before {
            content:''; position:absolute; top:0; left:0; right:0; bottom:0;
            background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.2) 50%,transparent 70%);
            animation:shine 3s infinite;
        }
        .tramite-float:hover { transform:scale(1.2) translateY(-5px); box-shadow:0 20px 40px rgba(10,31,68,.6); animation:none; }
        .tramite-tooltip {
            position:absolute; left:95px; background:white; color:#0A1F44;
            padding:15px 25px; border-radius:12px; white-space:nowrap;
            box-shadow:0 8px 25px rgba(0,0,0,.15); opacity:0; pointer-events:none;
            transition:all .4s cubic-bezier(.4,0,.2,1); font-size:1rem; font-weight:600;
            border:1px solid rgba(0,0,0,.1); z-index:1001;
        }
        .tramite-float:hover .tramite-tooltip { opacity:1; transform:translateX(10px); }
        .tramite-icon { width:36px; height:36px; position:relative; z-index:1; fill:white; }
        @keyframes floatPremium {
            0%,100% { transform:translateY(0) rotate(0deg); }
            25% { transform:translateY(-15px) rotate(2deg); }
            75% { transform:translateY(-5px) rotate(-2deg); }
        }
        @keyframes shine { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }

        /* ── PROGRESS BAR ── */
        .form-progress-wrap {
          position:fixed; bottom:28px; left:50%; transform:translateX(-50%);
          z-index:1500; display:none;
          width:calc(100% - 200px); max-width:720px; min-width:280px;
          pointer-events:none;
        }
        .form-progress-wrap.visible { display:block; }
        .form-progress-pill {
          background:#ffffff; border-radius:60px; padding:10px 20px 10px 16px;
          display:flex; align-items:center; gap:14px;
          box-shadow:0 4px 24px rgba(10,31,68,0.14), 0 1px 4px rgba(10,31,68,0.08);
          border:1px solid rgba(10,31,68,0.07);
          transition:background .3s ease, border-color .3s ease, box-shadow .3s ease;
        }
        .form-progress-bar-track {
          flex:1; height:8px; background:#E8ECF4; border-radius:99px; overflow:hidden;
          position:relative; transition:background .3s ease;
        }
        .form-progress-bar-fill {
          height:100%; background:linear-gradient(90deg,#165DFF 0%,#3a7fff 100%);
          border-radius:99px; width:0%; transition:width .45s cubic-bezier(.4,0,.2,1);
          position:relative;
        }
        .form-progress-bar-fill::after {
          content:''; position:absolute; top:0; left:-60px;
          width:50px; height:100%;
          background:linear-gradient(90deg,transparent,rgba(255,255,255,.55),transparent);
          animation:barShine 2.2s ease-in-out infinite;
        }
        .form-progress-text {
          font-size:12.5px; font-weight:500; color:#6B7A99;
          white-space:nowrap; flex-shrink:0; letter-spacing:.1px;
          min-width:150px; text-align:right; transition:color .3s ease;
        }
        .form-progress-text strong { color:#165DFF; font-weight:700; }

        /* ── DARK MODE ── */
        body.dark-mode { background:#0c1525; color:#d0d8ec; }
        body.dark-mode .form-card { background:#111e36; border-color:#1e2d4a; }
        body.dark-mode .sec-title h2 { color:#a8bde0; }
        body.dark-mode .sec-icon { background:#1a2d50; }
        body.dark-mode .fld label { color:#7a8fb0; }
        body.dark-mode input[type="text"],
        body.dark-mode input[type="email"],
        body.dark-mode input[type="tel"],
        body.dark-mode input[type="number"],
        body.dark-mode select {
          background:#162040; border-color:#243660; color:#d0d8ec;
        }
        body.dark-mode input[type="text"]:focus,
        body.dark-mode input[type="email"]:focus,
        body.dark-mode input[type="tel"]:focus,
        body.dark-mode input[type="number"]:focus,
        body.dark-mode select:focus {
          background:#1a2850; border-color:#4d8aff; box-shadow:0 0 0 3px rgba(77,138,255,.15);
        }
        body.dark-mode input::placeholder { color:#4a5878; }
        body.dark-mode .div { background:#1e2d4a; }
        body.dark-mode .cost-pill { background:linear-gradient(135deg,#1a2d50 0%,#162040 100%); border-color:#4d8aff; }
        body.dark-mode .cp-lbl { color:#a8bde0; }
        body.dark-mode .cp-amt { color:#78b0ff; }
        body.dark-mode .rbox { background:#0f1d35; border-color:#1e2d4a; }
        body.dark-mode .rbox-head { background:#0a1525; }
        body.dark-mode .rlist li { color:#b0c4e0; border-bottom-color:rgba(255,255,255,.06); }
        body.dark-mode .r-alert { background:#2a2000; border-color:#6b5300; color:#e0c060; }
        body.dark-mode .r-fmt { background:#0f1e35; border-color:#1e3a60; color:#6ba3ff; }
        body.dark-mode .leg-card--ok { background:#0a200f; border-color:#166534; }
        body.dark-mode .leg-card--ok .leg-card-title,
        body.dark-mode .leg-card--ok .leg-card-desc { color:#4ade80; }
        body.dark-mode .leg-card--no { background:#220a0a; border-color:#7f1d1d; }
        body.dark-mode .leg-card--no .leg-card-title,
        body.dark-mode .leg-card--no .leg-card-desc { color:#f87171; }
        body.dark-mode .auth-req { background:#111e36; border-color:#1e2d4a; border-left-color:#4d8aff; color:#b0c4e0; }
        body.dark-mode .auth-req strong { color:#a8bde0; }
        body.dark-mode .attach-dropzone { background:#0f1d35; border-color:#243660; }
        body.dark-mode .attach-dropzone:hover,
        body.dark-mode .attach-dropzone.drag-over { background:#162040; border-color:#4d8aff; }
        body.dark-mode .attach-dropzone-text { color:#4a5878; }
        body.dark-mode .attach-formats-line { color:#4a5878; }
        body.dark-mode .attach-formats-line strong { color:#7a8fb0; }
        body.dark-mode .attach-limit-line { color:#4a5878; }
        body.dark-mode .attach-limit-line strong { color:#7a8fb0; }
        body.dark-mode .attach-realtime-stats { background:#1a2d50; color:#a8bde0; }
        body.dark-mode .attach-bar-track { background:#1e2d4a; }
        body.dark-mode .attach-file-item { background:#162040; border-color:#243660; }
        body.dark-mode .attach-file-name { color:#a8bde0; }
        body.dark-mode .attach-file-size { color:#4a5878; }
        body.dark-mode .attach-capacity-header { color:#7a8fb0; }
        body.dark-mode .compress-body { background:#0f1d35; }
        body.dark-mode .compress-stat-val { color:#a8bde0; }
        body.dark-mode .compress-progress { border-color:#243660; }
        body.dark-mode .check-wrap { background:#0f1d35; border-color:#1e2d4a; }
        body.dark-mode .check-box { background:#162040; border-color:#243660; }
        body.dark-mode .check-txt { color:#b0c4e0; }
        body.dark-mode .lada-custom { background:#162040; border-color:#243660; }
        body.dark-mode .lada-trigger { color:#d0d8ec; }
        body.dark-mode .lada-dropdown { background:#111e36; border-color:#4d8aff; }
        body.dark-mode .lada-search { background:#0f1d35; border-color:#1e2d4a; }
        body.dark-mode .lada-search input { background:#162040; border-color:#243660; color:#d0d8ec; }
        body.dark-mode .lada-opt:hover { background:#1a2d50; }
        body.dark-mode .lada-opt.active { background:#1a2d50; }
        body.dark-mode .lada-opt .lo-name { color:#4a5878; }
        body.dark-mode .lada-opt .lo-code { color:#a8bde0; }
        body.dark-mode .phone-wrap { border-color:#243660; }
        body.dark-mode .recap-txt { color:#4a5878; }
        body.dark-mode .toast.ok  { background:#052e16; color:#86efac; border-color:#166534; }
        body.dark-mode .toast.err { background:#2d0a0a; color:#fca5a5; border-color:#7f1d1d; }
        body.dark-mode .tramite-float { border:2px solid rgba(255,255,255,.09); }
        body.dark-mode .wa-btn { border:2px solid rgba(255,255,255,.12); }
        body.dark-mode .tramite-tooltip { background:rgba(14,24,44,.96); color:#c8d8f0; border:1px solid #243660; box-shadow:0 8px 28px rgba(0,0,0,.40); }
        body.dark-mode .form-progress-pill { background:#1a2645; border-color:rgba(255,255,255,.12); box-shadow:0 4px 28px rgba(0,0,0,.55),0 1px 4px rgba(0,0,0,.35); }
        body.dark-mode .form-progress-bar-track { background:#263558; }
        body.dark-mode .form-progress-bar-fill { background:linear-gradient(90deg,#4d8aff 0%,#78b0ff 100%); }
        body.dark-mode .form-progress-text { color:#c8d6f0; font-weight:600; }
        body.dark-mode .form-progress-text strong { color:#78b0ff; font-weight:800; }
        body.dark-mode .sumbox { background:#111f3a; border-color:#1e2d50; }
        body.dark-mode .sum-group + .sum-group { border-top-color:#1e2d50; }
        body.dark-mode .sum-group-label-text { color:#6ba3ff; }
        body.dark-mode .sum-k { color:#4a5878; }
        body.dark-mode .sum-v { color:#c8d6f0; }
        body.dark-mode .sum-v--empty { color:#3a4e70; }
        body.dark-mode .sum-footer { border-top-color:#1e2d50; background:#0e1a30; }
        body.dark-mode .sum-footer-text { color:#4a5878; }
        body.dark-mode .sum-footer-text strong { color:#c8d6f0; }
        body.dark-mode .sum-chip { background:rgba(22,93,255,.15); color:#6ba3ff; border-color:rgba(22,93,255,.3); }
        body.dark-mode .sum-chip--files { background:rgba(15,195,115,.12); color:#6eeabb; border-color:rgba(15,195,115,.3); }
        body.dark-mode .sum-chip--amount { background:rgba(245,158,11,.12); color:#fcd34d; border-color:rgba(245,158,11,.3); }

        /* ── RESPONSIVE ── */
        @media(max-width:640px){
            body { padding:10px 10px 90px; }
            .hdr, .form-card { padding-left:20px; padding-right:20px; }
            .hdr { padding-top:28px; padding-bottom:26px; }
            .hdr-logo { font-size:2rem; }
            .g2 { grid-template-columns:1fr; }
            .legibility-guide { grid-template-columns:1fr; }
            .wa-btn { width:58px; height:58px; bottom:24px; left:18px; }
            .wa-svg { width:26px; height:26px; }
            .wa-tip { display:none; }
            .theme-toggle-btn { top:14px; right:14px; width:44px; height:44px; }
            .icon-sun, .icon-moon { width:22px; height:22px; }
            .form-progress-wrap { width:calc(100% - 24px); bottom:16px; }
            .form-progress-pill { padding:8px 14px 8px 12px; gap:10px; }
            .form-progress-text { font-size:11.5px; min-width:110px; }
            .tramite-float { width:65px; height:65px; top:30px; left:30px; }
            .tramite-icon { width:32px; height:32px; }
            .tramite-tooltip { display:none; }
            .sum-row { flex-direction:column; gap:.04rem; line-height:1.55; padding:.12rem 0; }
            .sum-k { min-width:unset; font-size:.72rem; color:var(--a); }
        }
    </style>
</head>
<body>

<!-- ===== SUCCESS MODAL ===== -->
<div class="success-overlay" id="successOverlay">
  <div class="success-card">
    <div class="success-header-modal">
      <div class="success-checkmark">
        <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      </div>
      <div class="success-title">¡Solicitud Enviada!</div>
      <div class="success-subtitle">Tu trámite está en proceso</div>
    </div>
    <div class="success-body-modal">
      <div class="success-info-row">
        <div class="success-info-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="#165DFF" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
          </svg>
        </div>
        <div class="success-info-text">
          <strong>Próximo paso</strong>
          Nos pondremos en contacto contigo en un plazo de 24 a 48 horas hábiles para confirmar tu trámite y darte seguimiento.
        </div>
      </div>
      <div class="success-info-row">
        <div class="success-info-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="#165DFF" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/>
          </svg>
        </div>
        <div class="success-info-text">
          <strong>Contacto directo</strong>
          <div class="success-contact-list">
            <div class="success-contact-item">📞 <a href="tel:+527771234567">+52 (777) 123-4567</a></div>
            <div class="success-contact-item">✉️ <a href="/cdn-cgi/l/email-protection#7f161119103f1e110f1e16511c1012511207"><span class="__cf_email__" data-cfemail="127b7c747d52737c62737b3c717d7f3c7f6a">[email&#160;protected]</span></a></div>
            <div class="success-contact-item">🌐 <a href="https://www.anpai.com.mx" target="_blank">www.anpai.com.mx</a></div>
          </div>
        </div>
      </div>
      <div class="success-divider"></div>
      <button class="success-close-btn" onclick="closeSuccessModal()">Volver al Formulario</button>
    </div>
  </div>
</div>

<!-- ===== BOTÓN FLOTANTE TRAMITE ===== -->
<a href="https://www.anpai.com.mx/iniciar-tramite" class="tramite-float" target="_blank" rel="noopener noreferrer" aria-label="Iniciar trámite en ANPAI">
    <span class="tramite-tooltip">📝 Iniciar trámite</span>
    <svg class="tramite-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
    </svg>
</a>

<!-- ===== BOTÓN TEMA ===== -->
<button class="theme-toggle-btn" id="themeToggleBtn" aria-label="Cambiar tema claro/oscuro" title="Cambiar tema">
  <div class="toggle-icon-wrap">
    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="4.5" fill="#FFD700" stroke="#FFA500" stroke-width="1.4"/>
      <g stroke="#FFD700" stroke-width="2" stroke-linecap="round">
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(0 12 12)"/>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(45 12 12)"/>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(90 12 12)"/>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(135 12 12)"/>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(180 12 12)"/>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(225 12 12)"/>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(270 12 12)"/>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(315 12 12)"/>
      </g>
    </svg>
    <svg class="icon-moon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="#c8d0ff" stroke="#4169E1" stroke-width="1.5"/>
    </svg>
  </div>
</button>

<!-- WhatsApp flotante -->
<a href="https://wa.me/527771234567?text=Hola,%20tengo%20una%20consulta%20sobre%20tr%C3%A1mites%20vehiculares" class="wa-btn" target="_blank" rel="noopener noreferrer">
    <svg class="wa-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
    </svg>
    <div class="wa-tip">💬 ¿Dudas? Chatea con nosotros</div>
</a>

<div class="elfsight-app-beb4a331-0ecc-4c09-b401-4d88d35cbf03" data-elfsight-app-lazy></div>

<!-- ════════════ FORMULARIO ════════════ -->
<div class="wrapper">
    <div class="hdr">
        <div class="hdr-logo"><span class="letra-a">A</span><span class="letra-va">VA</span></div>
        <div class="hdr-sub">Trámites Vehiculares en Morelos</div>
    </div>

    <div class="form-card">
        <form id="tramiteForm" action="https://formsubmit.co/info@anpai.com.mx" method="POST" enctype="multipart/form-data" novalidate>
            <input type="hidden" name="_subject" value="Nueva solicitud de trámite vehicular — AVA Morelos">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_captcha" value="false">
            <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off">
            <input type="hidden" name="_autoresponse" value="Hemos recibido tu solicitud de trámite vehicular. En breve nos pondremos en contacto contigo. — AVA Trámites Vehiculares en Morelos">
            <input type="hidden" name="_cc" value="info@anpai.com.mx">
            <input type="hidden" name="Archivos_adjuntos_info_alta" id="attachHiddenALTA">
            <input type="hidden" name="Archivos_adjuntos_info_ref" id="attachHiddenREF">

            <!-- 1. Datos Personales -->
            <div class="sec-title">
                <div class="sec-icon">👤</div>
                <h2>Datos Personales</h2>
            </div>

            <div class="g2">
                <div class="fld g-full">
                    <label for="nombre">Nombre completo <span class="req">*</span></label>
                    <input type="text" id="nombre" name="nombre" placeholder="Tu nombre completo" required>
                </div>
                <div class="fld">
                    <label for="telefono">Teléfono de contacto <span class="req">*</span></label>
                    <div class="phone-wrap">
                        <div class="lada-custom" id="ladaCustom">
                            <div class="lada-trigger" id="ladaTrigger">
                                <span class="lada-flag">🇲🇽</span>
                                <span class="lada-code">+52</span>
                                <span class="lada-arrow">▼</span>
                            </div>
                            <div class="lada-dropdown" id="ladaDropdown">
                                <div class="lada-search"><input type="text" id="ladaSearchInput" placeholder="🔍 Buscar país…" autocomplete="off"></div>
                                <div id="ladaOptionsList"></div>
                            </div>
                        </div>
                        <select id="ladaPais" name="lada" class="lada-select-hidden"><option value="+52" selected>+52</option></select>
                        <input type="tel" id="telefono" name="telefono" placeholder="Ej: 7771234567" required class="phone-input">
                    </div>
                </div>
                <div class="fld">
                    <label for="email">Correo electrónico <span class="req">*</span></label>
                    <input type="email" id="email" name="email" placeholder="correo@ejemplo.com" required>
                </div>
            </div>

            <div class="div"></div>

            <!-- 2. Tipo de Trámite -->
            <div class="sec-title">
                <div class="sec-icon">🚗</div>
                <h2>Tipo de Trámite</h2>
            </div>

            <div class="fld">
                <label for="tipoTramite">Seleccione el trámite <span class="req">*</span></label>
                <select id="tipoTramite" name="tipoTramite" required>
                    <option value="">— Seleccione una opción —</option>
                    <option value="alta">Alta vehicular</option>
                    <option value="refrendo">Refrendo</option>
                </select>
            </div>

            <!-- ══ SECCIÓN ALTA VEHICULAR ══ -->
            <div id="sec-alta" class="sec-hide">
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">💰</div>
                    <h2>Valor del Vehículo y Costo</h2>
                </div>
                <div class="fld">
                    <label for="valorVehiculo">Valor del vehículo <span class="req">*</span><span class="opt">(pesos mexicanos MXN)</span></label>
                    <input type="number" id="valorVehiculo" name="valorVehiculo" min="0" placeholder="Ej: 850000">
                </div>
                <div class="cost-pill" id="costPill">
                    <span class="cp-lbl">Costo total del trámite</span>
                    <span class="cp-amt" id="costoTotal">$0.00</span>
                </div>
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">📋</div>
                    <h2>Requisitos para Alta Vehicular</h2>
                </div>
                <div class="rbox">
                    <div class="rbox-head"><span>📌</span> Documentación necesaria</div>
                    <div class="rbox-body">
                        <div class="r-alert"><strong>IMPORTANTE:</strong> Todos los requisitos marcados como obligatorios son indispensables para procesar el trámite. El costo total incluye el pago de derechos e impuestos correspondientes, por lo que no es necesario que el cliente los abone por separado.</div>
                        <div class="rg-title">Personas Físicas</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Factura de origen y archivo XML de la misma.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Carta factura (vigente 30 días máx.) — solo si la compra fue a crédito.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Identificación oficial vigente con fotografía (INE, pasaporte, licencia de conducir de Morelos, etc.).</li>
                            <li class="op"><span class="bOp">Opcional</span> Comprobante de domicilio en Morelos no mayor a 3 meses.</li>
                            <li class="op"><span class="bOp">Opcional</span> Identificación del titular del comprobante de domicilio (si no es el propietario del vehículo).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Póliza de seguro automotriz vigente.</li>
                        </ul>
                        <div class="rg-title">Personas Morales</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Factura de origen y archivo XML de la misma.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Carta factura (vigente 30 días máx.).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Acta constitutiva.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Poder notarial que acredite la representación legal.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Identificación oficial vigente del representante legal.</li>
                            <li class="op"><span class="bOp">Opcional</span> Comprobante de domicilio en Morelos a nombre de la empresa, no mayor a 3 meses.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Constancia de situación fiscal actualizada de la empresa y del representante legal.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Póliza de seguro automotriz vigente.</li>
                        </ul>
                        <div class="r-fmt"><strong>📄 REQUISITOS DE FORMATO</strong><br>Todos los documentos deben estar escaneados en <strong>formato PDF</strong> y ser completamente legibles.<br><br>Este formulario cuenta con un <strong>sistema de compresión automática en ZIP</strong>. Sin embargo, si la compresión resultante supera los 5 MB, deberás comprimirlos por tu cuenta en archivos <strong>ZIP o RAR que no superen los 5 MB cada uno</strong> y enviarlos por separado al correo <a href="/cdn-cgi/l/email-protection#5b32353d341b3a352b3a3275383436753623" style="color:inherit;font-weight:700;"><span class="__cf_email__" data-cfemail="d7beb9b1b897b6b9a7b6bef9b4b8baf9baaf">[email&#160;protected]</span></a>. Es preferible enviar <strong>varios correos con archivos de hasta 5 MB</strong> que intentar enviar archivos de mayor tamaño o varios archivos de 5 MB en un mismo correo, ya que el sistema de mensajería podría no entregarlos o rechazarlos.</div>
                    </div>

                <!-- Legibility Guide -->
                    </div>
                </div>

                <!-- Legibility Guide -->
                <div class="auth-req">
                    📄 <strong>Requisito de autenticidad.</strong> Los documentos deben ser copia fiel del original: completamente legibles, sin alteraciones.
                </div>
                <div class="legibility-guide">
                    <div class="leg-card leg-card--ok">
                        <div class="leg-card-icon">✔</div>
                        <div class="leg-card-body">
                            <div class="leg-card-title">Legible</div>
                            <div class="leg-card-desc">Foto nítida, bien iluminada, encuadre completo. Sin sombras ni reflejos que cubran datos.</div>
                        </div>
                    </div>
                    <div class="leg-card leg-card--no">
                        <div class="leg-card-icon">✖</div>
                        <div class="leg-card-body">
                            <div class="leg-card-title">No Legible</div>
                            <div class="leg-card-desc">Imagen borrosa, oscura, con dedos tapando datos, o recortada. No puede procesarse.</div>
                        </div>
                    </div>
                </div>

                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">📎</div>
                    <h2>Cargar Documentación</h2>
                </div>
                <div class="fld">
                    <label>Adjuntar Documentos <span class="req">*</span></label>
                    <div class="attach-dropzone" id="attachDropzoneALTA"
                         ondragover="onDragOver(event,'ALTA')" ondragleave="onDragLeave(event,'ALTA')" ondrop="onDrop(event,'ALTA')"
                         onclick="document.getElementById('fileInputALTA').click()">
                        <span class="attach-folder-icon">📁</span>
                        <div class="attach-dropzone-text">Arrastra tus archivos aquí o <a onclick="event.stopPropagation();document.getElementById('fileInputALTA').click()">haz clic para seleccionarlos</a></div>
                        <div class="attach-formats-line">Formatos: <strong>PDF, JPG, PNG</strong></div>
                        <div class="attach-auto-compress-line">✨ Compresión automática incluida</div>
                        <div class="attach-limit-line">📏 Límite total: <strong>5 MB</strong></div>
                        <div class="attach-realtime-stats" id="attachRealtimeALTA" style="display:none">
                            <span>📦 <strong id="attachCountALTA">0</strong> archivo(s)</span>
                            <span class="attach-stats-sep">|</span>
                            <span>Peso: <strong id="attachWeightALTA">0 KB</strong></span>
                        </div>
                        <div class="attach-limit-exceeded" id="attachLimitExcALTA" style="display:none">¡Límite de 5 MB superado!</div>
                        <input type="file" id="fileInputALTA" multiple accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="handleFiles(this.files,'ALTA')">
                    </div>
                    <div class="attach-capacity-wrap" id="capacityWrapALTA">
                        <div class="attach-capacity-header">
                            <span class="attach-capacity-label">Capacidad utilizada</span>
                            <span class="attach-capacity-value" id="capacityValueALTA">0 MB de 5 MB</span>
                        </div>
                        <div class="attach-bar-track"><div class="attach-bar-fill green" id="attachBarALTA" style="width:0%"></div></div>
                        <div class="attach-status" id="attachStatusALTA">
                            <span class="attach-status-dot green" id="attachDotALTA"></span>
                            <span id="attachStatusTextALTA">Capacidad disponible</span>
                        </div>
                        <div class="attach-error-msg" id="attachErrALTA"><span>⚠️</span><span id="attachErrTextALTA">El archivo supera el límite de 5 MB.</span></div>
                    </div>
                    <div class="attach-file-list" id="fileListALTA"></div>
                    <div class="compress-progress" id="compressProgressALTA">
                        <div class="compress-header">
                            <span style="font-size:16px;">⚡</span>
                            <span class="compress-header-text">Comprimiendo...</span>
                            <span id="compressPctALTA" class="compress-pct" style="margin-left:auto;">0%</span>
                        </div>
                        <div class="compress-body">
                            <div class="compress-row">
                                <div class="compress-stat"><div class="compress-stat-val" id="compressDoneMBALTA">0 KB</div><div class="compress-stat-label">Comprimido</div></div>
                                <div class="compress-stat"><div class="compress-stat-val" id="compressRemMBALTA">0 KB</div><div class="compress-stat-label">Restante</div></div>
                                <div class="compress-stat"><div class="compress-stat-val" id="compressElapsedALTA">0s</div><div class="compress-stat-label">Transcurrido</div></div>
                                <div class="compress-stat"><div class="compress-stat-val" id="compressEtaALTA">—</div><div class="compress-stat-label">Estimado</div></div>
                            </div>
                            <div class="compress-bar-track"><div class="compress-bar-fill" id="compressBarFillALTA"></div></div>
                            <div class="compress-info">
                                <span id="compressInfoALTA">Preparando…</span>
                                <span id="compressDonePctALTA">0% completado</span>
                            </div>
                            <div class="compress-resume-note" id="compressResumeALTA"><span>🔄</span><span>Pausado. Continuará cuando vuelva la conexión.</span></div>
                        </div>
                    </div>
                    <div class="offline-msg" id="offlineMsgALTA"><span>📡</span><span>Sin conexión. La compresión se reanudará automáticamente.</span></div>
                </div>
            </div>

            <!-- ══ SECCIÓN REFRENDO ══ -->
            <div id="sec-ref" class="sec-hide">
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">🔄</div>
                    <h2>Datos del Refrendo</h2>
                </div>
                <div class="g2">
                    <div class="fld g-full">
                        <label for="numeroPlacas">Número de placas <span class="req">*</span></label>
                        <input type="text" id="numeroPlacas" name="numeroPlacas" placeholder="Ej: ABC-123-X">
                    </div>
                    <div class="fld g-full">
                        <label for="tipoUnidad">Tipo de unidad a refrendar <span class="req">*</span></label>
                        <select id="tipoUnidad" name="tipoUnidad">
                            <option value="">— Seleccione el tipo de unidad —</option>
                            <option value="autos" data-costo="2764.28">Automóviles particulares</option>
                            <option value="camiones" data-costo="2655.71">Camiones, remolques, autos antiguos y demostradoras</option>
                            <option value="motos" data-costo="2384.28">Motocicletas</option>
                            <option value="capacidades" data-costo="2492.85">Vehículos con capacidades diferentes</option>
                            <option value="publico" data-costo="3144.27">Transporte público</option>
                        </select>
                    </div>
                </div>
                <div class="cost-pill" id="costPillRef">
                    <span class="cp-lbl">Costo total del refrendo</span>
                    <span class="cp-amt" id="costoTotalRef">$0.00</span>
                </div>
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">📋</div>
                    <h2>Requisitos para Refrendo</h2>
                </div>
                <div class="rbox">
                    <div class="rbox-head"><span>📌</span> Documentación necesaria</div>
                    <div class="rbox-body">
                        <div class="r-alert"><strong>IMPORTANTE:</strong> Todos los requisitos son indispensables para procesar el trámite. El costo total incluye el pago de derechos e impuestos correspondientes.</div>
                        <div class="rg-title">Personas Físicas</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Identificación oficial con fotografía vigente (INE — por los dos lados, pasaporte, licencia de conducir de Morelos, etc.).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Póliza de seguro automotriz vigente expedida por una aseguradora registrada.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Tarjeta de circulación anterior.</li>
                        </ul>
                        <div class="rg-title">Personas Morales</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Todos los requisitos de Personas Físicas, más:</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> RFC de la empresa (constancia de situación fiscal).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Acta constitutiva certificada ante notario público.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Poder notarial que acredite la representación legal.</li>
                        </ul>
                        <div class="r-fmt"><strong>📄 REQUISITOS DE FORMATO</strong><br>Todos los documentos deben estar escaneados en <strong>formato PDF</strong> y ser completamente legibles.<br><br>Este formulario cuenta con un <strong>sistema de compresión automática en ZIP</strong>. Sin embargo, si la compresión resultante supera los 5 MB, deberás comprimirlos por tu cuenta en archivos <strong>ZIP o RAR que no superen los 5 MB cada uno</strong> y enviarlos por separado al correo <a href="/cdn-cgi/l/email-protection#a8c1c6cec7e8c9c6d8c9c186cbc7c586c5d0" style="color:inherit;font-weight:700;"><span class="__cf_email__" data-cfemail="c0a9aea6af80a1aeb0a1a9eea3afadeeadb8">[email&#160;protected]</span></a>. Es preferible enviar <strong>varios correos con archivos de hasta 5 MB</strong> que intentar enviar archivos de mayor tamaño o varios archivos de 5 MB en un mismo correo, ya que el sistema de mensajería podría no entregarlos o rechazarlos.</div>
                    </div>
                </div>

                <!-- Legibility Guide -->
                <div class="auth-req">
                    📄 <strong>Requisito de autenticidad.</strong> Los documentos deben ser copia fiel del original: completamente legibles, sin alteraciones.
                </div>
                <div class="legibility-guide">
                    <div class="leg-card leg-card--ok">
                        <div class="leg-card-icon">✔</div>
                        <div class="leg-card-body">
                            <div class="leg-card-title">Legible</div>
                            <div class="leg-card-desc">Foto nítida, bien iluminada, encuadre completo. Sin sombras ni reflejos que cubran datos.</div>
                        </div>
                    </div>
                    <div class="leg-card leg-card--no">
                        <div class="leg-card-icon">✖</div>
                        <div class="leg-card-body">
                            <div class="leg-card-title">No Legible</div>
                            <div class="leg-card-desc">Imagen borrosa, oscura, con dedos tapando datos, o recortada. No puede procesarse.</div>
                        </div>
                    </div>
                </div>

                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">📎</div>
                    <h2>Cargar Documentación</h2>
                </div>
                <div class="fld">
                    <label>Adjuntar Documentos <span class="req">*</span></label>
                    <div class="attach-dropzone" id="attachDropzoneREF"
                         ondragover="onDragOver(event,'REF')" ondragleave="onDragLeave(event,'REF')" ondrop="onDrop(event,'REF')"
                         onclick="document.getElementById('fileInputREF').click()">
                        <span class="attach-folder-icon">📁</span>
                        <div class="attach-dropzone-text">Arrastra tus archivos aquí o <a onclick="event.stopPropagation();document.getElementById('fileInputREF').click()">haz clic para seleccionarlos</a></div>
                        <div class="attach-formats-line">Formatos: <strong>PDF, JPG, PNG</strong></div>
                        <div class="attach-auto-compress-line">✨ Compresión automática incluida</div>
                        <div class="attach-limit-line">📏 Límite total: <strong>5 MB</strong></div>
                        <div class="attach-realtime-stats" id="attachRealtimeREF" style="display:none">
                            <span>📦 <strong id="attachCountREF">0</strong> archivo(s)</span>
                            <span class="attach-stats-sep">|</span>
                            <span>Peso: <strong id="attachWeightREF">0 KB</strong></span>
                        </div>
                        <div class="attach-limit-exceeded" id="attachLimitExcREF" style="display:none">¡Límite de 5 MB superado!</div>
                        <input type="file" id="fileInputREF" multiple accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="handleFiles(this.files,'REF')">
                    </div>
                    <div class="attach-capacity-wrap" id="capacityWrapREF">
                        <div class="attach-capacity-header">
                            <span class="attach-capacity-label">Capacidad utilizada</span>
                            <span class="attach-capacity-value" id="capacityValueREF">0 MB de 5 MB</span>
                        </div>
                        <div class="attach-bar-track"><div class="attach-bar-fill green" id="attachBarREF" style="width:0%"></div></div>
                        <div class="attach-status" id="attachStatusREF">
                            <span class="attach-status-dot green" id="attachDotREF"></span>
                            <span id="attachStatusTextREF">Capacidad disponible</span>
                        </div>
                        <div class="attach-error-msg" id="attachErrREF"><span>⚠️</span><span id="attachErrTextREF">El archivo supera el límite de 5 MB.</span></div>
                    </div>
                    <div class="attach-file-list" id="fileListREF"></div>
                    <div class="compress-progress" id="compressProgressREF">
                        <div class="compress-header">
                            <span style="font-size:16px;">⚡</span>
                            <span class="compress-header-text">Comprimiendo...</span>
                            <span id="compressPctREF" class="compress-pct" style="margin-left:auto;">0%</span>
                        </div>
                        <div class="compress-body">
                            <div class="compress-row">
                                <div class="compress-stat"><div class="compress-stat-val" id="compressDoneMBREF">0 KB</div><div class="compress-stat-label">Comprimido</div></div>
                                <div class="compress-stat"><div class="compress-stat-val" id="compressRemMBREF">0 KB</div><div class="compress-stat-label">Restante</div></div>
                                <div class="compress-stat"><div class="compress-stat-val" id="compressElapsedREF">0s</div><div class="compress-stat-label">Transcurrido</div></div>
                                <div class="compress-stat"><div class="compress-stat-val" id="compressEtaREF">—</div><div class="compress-stat-label">Estimado</div></div>
                            </div>
                            <div class="compress-bar-track"><div class="compress-bar-fill" id="compressBarFillREF"></div></div>
                            <div class="compress-info">
                                <span id="compressInfoREF">Preparando…</span>
                                <span id="compressDonePctREF">0% completado</span>
                            </div>
                            <div class="compress-resume-note" id="compressResumeREF"><span>🔄</span><span>Pausado. Continuará cuando vuelva la conexión.</span></div>
                        </div>
                    </div>
                    <div class="offline-msg" id="offlineMsgREF"><span>📡</span><span>Sin conexión. La compresión se reanudará automáticamente.</span></div>
                </div>
            </div>

            <!-- ══ RESUMEN DE SOLICITUD ══ -->
            <div id="sec-resumen" class="sec-hide">
                <div class="div"></div>
                <div class="sumbox" id="sumBox" style="display:none">
                    <div class="sum-header">
                        <div class="sum-header-left">
                            <div class="sum-header-icon">
                                <svg viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
                            </div>
                            <div>
                                <div class="sum-ttl">Resumen de Solicitud</div>
                                <div class="sum-ttl-sub">Revisa tus datos antes de enviar</div>
                            </div>
                        </div>
                        <div class="sum-badge" id="sumBadge"><span class="sum-badge-dot"></span> Listo</div>
                    </div>
                    <div class="sum-body" id="sumCont"></div>
                    <div class="sum-footer">
                        <span class="sum-footer-icon">ℹ️</span>
                        <p class="sum-footer-text"><strong>Verifica la información antes de enviar.</strong> Si detectas algún error, corrige los campos correspondientes.</p>
                    </div>
                </div>
            </div>

            <!-- ══ CASILLA DE VERIFICACIÓN ══ -->
            <div id="sec-declaracion" class="sec-hide">
                <div class="check-wrap">
                    <label class="check-label" for="declaracion">
                        <input type="checkbox" id="declaracion" name="declaracion">
                        <span class="check-box"></span>
                        <span class="check-txt">DECLARO BAJO MI RESPONSABILIDAD QUE TODA LA INFORMACIÓN PROPORCIONADA EN ESTE FORMULARIO ES VERDADERA, ACTUAL Y AUTÉNTICA. ASIMISMO, CERTIFICO QUE LOS DOCUMENTOS ADJUNTADOS SON COPIAS FIELES DE SUS ORIGINALES Y NO HAN SIDO ALTERADOS DE NINGUNA MANERA. CON ESTA ACCIÓN, VALIDO QUE HE TOMADO CONOCIMIENTO DE LOS ASPECTOS RELEVANTES DEL TRÁMITE Y QUE LOS REQUISITOS MARCADOS COMO OBLIGATORIOS LOS HE REUNIDO.</span>
                    </label>
                </div>
            </div>

            <div class="recap" id="recapWrap">
                <div class="recap-spin" id="recapSpin" style="display:none;"></div>
                <div class="recap-txt" id="recapTxt"></div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn" disabled>
                Enviar Solicitud
            </button>

            <div class="toast" id="toastMsg"></div>
        </form>
    </div>
</div>

<!-- ===== BARRA DE PROGRESO FLOTANTE ===== -->
<div class="form-progress-wrap" id="formProgressWrap">
  <div class="form-progress-pill">
    <div class="form-progress-bar-track">
      <div class="form-progress-bar-fill" id="formProgressFill"></div>
    </div>
    <span class="form-progress-text"><strong id="formProgressDone">0</strong> de <span id="formProgressTotal">0</span> campos completados</span>
  </div>
</div>


<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
document.addEventListener('DOMContentLoaded', function(){

/* ══ THEME ══ */
var THEME_KEY = 'ava-morelos-theme';
(function(){ try{ if(localStorage.getItem(THEME_KEY)==='dark') document.body.classList.add('dark-mode'); }catch(e){} })();
var themeBtn = document.getElementById('themeToggleBtn');
if(themeBtn) themeBtn.addEventListener('click', function(){
    var d = document.body.classList.toggle('dark-mode');
    try{ localStorage.setItem(THEME_KEY, d?'dark':'light'); }catch(e){}
});

/* ══ LADA ══ */
var LADAS = [
    {region:'América del Norte',flag:'🇲🇽',name:'México',code:'+52',val:'+52'},
    {region:'América del Norte',flag:'🇺🇸',name:'Estados Unidos',code:'+1',val:'+1'},
    {region:'América del Norte',flag:'🇨🇦',name:'Canadá',code:'+1',val:'+1-CA'},
    {region:'América Central',flag:'🇨🇷',name:'Costa Rica',code:'+506',val:'+506'},
    {region:'América Central',flag:'🇸🇻',name:'El Salvador',code:'+503',val:'+503'},
    {region:'América Central',flag:'🇬🇹',name:'Guatemala',code:'+502',val:'+502'},
    {region:'América Central',flag:'🇭🇳',name:'Honduras',code:'+504',val:'+504'},
    {region:'América Central',flag:'🇳🇮',name:'Nicaragua',code:'+505',val:'+505'},
    {region:'América Central',flag:'🇵🇦',name:'Panamá',code:'+507',val:'+507'},
    {region:'América Central',flag:'🇨🇺',name:'Cuba',code:'+53',val:'+53'},
    {region:'América del Sur',flag:'🇦🇷',name:'Argentina',code:'+54',val:'+54'},
    {region:'América del Sur',flag:'🇧🇴',name:'Bolivia',code:'+591',val:'+591'},
    {region:'América del Sur',flag:'🇧🇷',name:'Brasil',code:'+55',val:'+55'},
    {region:'América del Sur',flag:'🇨🇱',name:'Chile',code:'+56',val:'+56'},
    {region:'América del Sur',flag:'🇨🇴',name:'Colombia',code:'+57',val:'+57'},
    {region:'América del Sur',flag:'🇪🇨',name:'Ecuador',code:'+593',val:'+593'},
    {region:'América del Sur',flag:'🇵🇪',name:'Perú',code:'+51',val:'+51'},
    {region:'América del Sur',flag:'🇺🇾',name:'Uruguay',code:'+598',val:'+598'},
    {region:'América del Sur',flag:'🇻🇪',name:'Venezuela',code:'+58',val:'+58'},
    {region:'Europa',flag:'🇩🇪',name:'Alemania',code:'+49',val:'+49'},
    {region:'Europa',flag:'🇪🇸',name:'España',code:'+34',val:'+34'},
    {region:'Europa',flag:'🇫🇷',name:'Francia',code:'+33',val:'+33'},
    {region:'Europa',flag:'🇮🇹',name:'Italia',code:'+39',val:'+39'},
    {region:'Europa',flag:'🇵🇹',name:'Portugal',code:'+351',val:'+351'},
    {region:'Europa',flag:'🇬🇧',name:'Reino Unido',code:'+44',val:'+44'},
    {region:'Europa',flag:'🇷🇺',name:'Rusia',code:'+7',val:'+7'},
    {region:'Asia',flag:'🇨🇳',name:'China',code:'+86',val:'+86'},
    {region:'Asia',flag:'🇯🇵',name:'Japón',code:'+81',val:'+81'},
    {region:'Asia',flag:'🇰🇷',name:'Corea del Sur',code:'+82',val:'+82'},
    {region:'Asia',flag:'🇮🇳',name:'India',code:'+91',val:'+91'},
    {region:'Asia',flag:'🇸🇦',name:'Arabia Saudita',code:'+966',val:'+966'},
    {region:'Asia',flag:'🇦🇪',name:'Emiratos Árabes',code:'+971',val:'+971'},
    {region:'Oceanía',flag:'🇦🇺',name:'Australia',code:'+61',val:'+61'},
    {region:'Oceanía',flag:'🇳🇿',name:'Nueva Zelanda',code:'+64',val:'+64'},
    {region:'África',flag:'🇿🇦',name:'Sudáfrica',code:'+27',val:'+27'}
];
var ladaSelected = LADAS[0];
var ladaCustomEl  = document.getElementById('ladaCustom');
var ladaTriggerEl = document.getElementById('ladaTrigger');
var ladaSearchIn  = document.getElementById('ladaSearchInput');
var ladaOptsList  = document.getElementById('ladaOptionsList');
var ladaHidden    = document.getElementById('ladaPais');

function renderLadaOptions(filter){
    var q=(filter||'').toLowerCase();
    ladaOptsList.innerHTML='';
    var filtered=LADAS.filter(function(l){ return !q||l.name.toLowerCase().includes(q)||l.code.includes(q); });
    var cur=null;
    filtered.forEach(function(l){
        if(!q && l.region!==cur){
            cur=l.region;
            var h=document.createElement('div');
            h.style.cssText='padding:6px 12px 3px;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--azul-blue);background:var(--gris-light);border-bottom:1px solid var(--gris-border);';
            h.textContent=l.region;
            ladaOptsList.appendChild(h);
        }
        var div=document.createElement('div');
        div.className='lada-opt'+(l.val===ladaSelected.val?' active':'');
        div.innerHTML='<span class="lo-flag">'+l.flag+'</span><span class="lo-name">'+l.name+'</span><span class="lo-code">'+l.code+'</span>';
        div.addEventListener('click', function(){
            ladaSelected=l;
            ladaTriggerEl.querySelector('.lada-flag').textContent=l.flag;
            ladaTriggerEl.querySelector('.lada-code').textContent=l.code;
            ladaHidden.value=l.val;
            ladaCustomEl.classList.remove('open');
            ladaSearchIn.value='';
            renderLadaOptions('');
        });
        ladaOptsList.appendChild(div);
    });
}
ladaTriggerEl.addEventListener('click', function(){
    if(ladaCustomEl.classList.contains('open')){ ladaCustomEl.classList.remove('open'); }
    else { ladaCustomEl.classList.add('open'); ladaSearchIn.focus(); renderLadaOptions(''); }
});
ladaSearchIn.addEventListener('input', function(){ renderLadaOptions(this.value); });
document.addEventListener('click', function(e){ if(!ladaCustomEl.contains(e.target)) ladaCustomEl.classList.remove('open'); });
renderLadaOptions('');

/* ══ reCAPTCHA v3 ══ */
var RC_KEY = '6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV';
var rcApiReady = false;
var recapSpin = document.getElementById('recapSpin');
var recapTxt  = document.getElementById('recapTxt');
if(recapSpin) recapSpin.style.display='inline-block';
if(recapTxt){ recapTxt.textContent='Cargando verificación de seguridad…'; recapTxt.className='recap-txt'; }

function waitForRecaptcha(cb){
    if(typeof grecaptcha!=='undefined') grecaptcha.ready(cb);
    else setTimeout(function(){ waitForRecaptcha(cb); }, 200);
}
waitForRecaptcha(function(){
    rcApiReady=true;
    if(recapSpin) recapSpin.style.display='none';
    if(recapTxt){ recapTxt.textContent='✓ Verificación de seguridad lista'; recapTxt.className='recap-txt ok'; }
    checkEnvio();
});

/* ══ UTILIDADES ══ */
function fmtBytes(b){ if(b<1024) return b+'B'; if(b<1048576) return (b/1024).toFixed(1)+' KB'; return (b/1048576).toFixed(2)+' MB'; }
function fmtSec(s){ return s<60?Math.round(s)+'s':Math.floor(s/60)+'m '+Math.round(s%60)+'s'; }
function getFileIcon(name){ var e=name.split('.').pop().toLowerCase(); if(['jpg','jpeg','png','gif','webp'].indexOf(e)>=0) return '🖼️'; if(e==='pdf') return '📄'; return '📎'; }
function getToday(){ var d=new Date(); return d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0'); }
function V(id){ var el=document.getElementById(id); return el?el.value:''; }

/* ══ ESTADO JSZip ══ */
var MAX_ZIP_BYTES = 5*1024*1024;
var attachState = {
    'ALTA': {files:[],zipBlob:null,compressing:false,paused:false,startTime:null,elapsed:0,_runId:null},
    'REF':  {files:[],zipBlob:null,compressing:false,paused:false,startTime:null,elapsed:0,_runId:null}
};
var compressionTimers = {};

/* ══ DRAG & DROP ══ */
function onDragOver(e,type){ e.preventDefault(); var dz=document.getElementById('attachDropzone'+type); if(dz) dz.classList.add('drag-over'); }
function onDragLeave(e,type){ var dz=document.getElementById('attachDropzone'+type); if(dz) dz.classList.remove('drag-over'); }
function onDrop(e,type){ e.preventDefault(); var dz=document.getElementById('attachDropzone'+type); if(dz) dz.classList.remove('drag-over'); handleFiles(e.dataTransfer.files,type); }
// Expose drag functions globally (used in HTML inline handlers)
window.onDragOver=onDragOver; window.onDragLeave=onDragLeave; window.onDrop=onDrop;

/* ══ MANEJO DE ARCHIVOS ══ */
function handleFiles(fileList,type){
    var state=attachState[type];
    Array.from(fileList).forEach(function(f){
        var dup=state.files.some(function(ex){ return ex.name===f.name&&ex.size===f.size; });
        if(!dup) state.files.push(f);
    });
    state.zipBlob=null;
    renderFileList(type);
    updateCapacityBar(type);
    if(state.files.length>=1 && typeof JSZip!=='undefined') scheduleCompression(type);
    checkEnvio();
    updateProgressBar();
    buildSummaryIfVisible();
}
window.handleFiles=handleFiles;

function removeFile(type,idx){
    var state=attachState[type];
    state.files.splice(idx,1);
    state.zipBlob=null;
    renderFileList(type);
    hideAttachMsg(type);
    updateCapacityBar(type);
    if(state.files.length>=1 && typeof JSZip!=='undefined') scheduleCompression(type);
    else { var cp=document.getElementById('compressProgress'+type); if(cp) cp.classList.remove('show'); }
    checkEnvio();
    updateProgressBar();
    buildSummaryIfVisible();
}
window.removeFile=removeFile;

function renderFileList(type){
    var list=document.getElementById('fileList'+type);
    if(!list) return;
    list.innerHTML='';
    attachState[type].files.forEach(function(f,i){
        var item=document.createElement('div');
        item.className='attach-file-item';
        item.innerHTML='<span class="attach-file-icon">'+getFileIcon(f.name)+'</span>'+
            '<span class="attach-file-name">'+f.name+'</span>'+
            '<span class="attach-file-size">'+fmtBytes(f.size)+'</span>'+
            '<button type="button" class="attach-file-remove" onclick="removeFile(\''+type+'\','+i+')">×</button>';
        list.appendChild(item);
    });
}

function updateCapacityBar(type){
    var state=attachState[type];
    var wrap=document.getElementById('capacityWrap'+type);
    var bar=document.getElementById('attachBar'+type);
    var valEl=document.getElementById('capacityValue'+type);
    var dot=document.getElementById('attachDot'+type);
    var statusTxt=document.getElementById('attachStatusText'+type);
    var rtStats=document.getElementById('attachRealtime'+type);
    var rtCount=document.getElementById('attachCount'+type);
    var rtWeight=document.getElementById('attachWeight'+type);
    var limitExc=document.getElementById('attachLimitExc'+type);
    if(!wrap||!bar) return;

    if(state.files.length===0){
        wrap.classList.remove('visible');
        if(rtStats) rtStats.style.display='none';
        if(limitExc) limitExc.style.display='none';
        bar.className='attach-bar-fill green'; bar.style.width='0%';
        return;
    }
    wrap.classList.add('visible');
    if(rtStats) rtStats.style.display='flex';
    if(rtCount) rtCount.textContent=state.files.length;

    if(!state.zipBlob){
        bar.className='attach-bar-fill green'; bar.style.width='0%';
        if(dot) dot.className='attach-status-dot green';
        if(statusTxt) statusTxt.textContent=state.compressing?'Comprimiendo archivos…':'En espera de compresión…';
        if(valEl) valEl.textContent='— de 5 MB (ZIP pendiente)';
        if(rtWeight) rtWeight.textContent='—';
        if(limitExc) limitExc.style.display='none';
        return;
    }

    var zSize=state.zipBlob.size;
    var pct=Math.min(100,(zSize/MAX_ZIP_BYTES)*100);
    var zStr=fmtBytes(zSize);
    bar.style.width=pct+'%';
    if(valEl) valEl.textContent=zStr+' de 5 MB (ZIP comprimido)';
    if(rtWeight) rtWeight.textContent=zStr;
    bar.className='attach-bar-fill';
    if(dot) dot.className='attach-status-dot';

    if(zSize>=MAX_ZIP_BYTES){
        bar.classList.add('red'); if(dot) dot.classList.add('red');
        if(statusTxt) statusTxt.textContent='ZIP supera 5 MB — elimina archivos';
        showAttachMsg(type,'El ZIP pesa '+zStr+' y supera el límite. Elimina archivos o comprime por tu cuenta.');
        if(limitExc) limitExc.style.display='block';
    } else if(zSize>=MAX_ZIP_BYTES*0.80){
        bar.classList.add('yellow'); if(dot) dot.classList.add('yellow');
        if(statusTxt) statusTxt.textContent='Casi lleno — quedan '+fmtBytes(MAX_ZIP_BYTES-zSize)+' en el ZIP';
        hideAttachMsg(type);
        if(limitExc) limitExc.style.display='none';
    } else {
        bar.classList.add('green'); if(dot) dot.classList.add('green');
        if(statusTxt) statusTxt.textContent='ZIP listo — quedan '+fmtBytes(MAX_ZIP_BYTES-zSize)+' disponibles';
        hideAttachMsg(type);
        if(limitExc) limitExc.style.display='none';
    }
}

function showAttachMsg(type,msg){
    var el=document.getElementById('attachErr'+type), tx=document.getElementById('attachErrText'+type);
    if(tx) tx.textContent=msg; if(el) el.classList.add('show');
}
function hideAttachMsg(type){ var el=document.getElementById('attachErr'+type); if(el) el.classList.remove('show'); }

/* ══ COMPRESIÓN JSZip ══ */
function scheduleCompression(type){
    clearTimeout(compressionTimers[type]);
    compressionTimers[type]=setTimeout(function(){ startCompression(type); },80);
}

function startCompression(type){
    var state=attachState[type];
    if(state.compressing) state.compressing=false;
    if(state.files.length===0) return;
    if(!navigator.onLine){
        var om=document.getElementById('offlineMsg'+type); if(om) om.classList.add('show');
        state.paused=true;
        var cr=document.getElementById('compressResume'+type); if(cr) cr.classList.add('show');
        var cp=document.getElementById('compressProgress'+type); if(cp) cp.classList.add('show');
        return;
    }
    var snapshot=state.files.slice(), runId=Date.now(), zip=new JSZip();
    var totalRaw=snapshot.reduce(function(a,f){ return a+f.size; },0), processed=0;
    state.compressing=true; state.paused=false;
    state.startTime=Date.now(); state.elapsed=0; state._runId=runId;
    var cp=document.getElementById('compressProgress'+type); if(cp) cp.classList.add('show');
    updateCapacityBar(type);

    var ticker=setInterval(function(){
        if(!state.compressing||state._runId!==runId){ clearInterval(ticker); return; }
        state.elapsed=Date.now()-state.startTime;
        var el=document.getElementById('compressElapsed'+type); if(el) el.textContent=fmtSec(state.elapsed/1000);
    },300);

    function abort(){
        clearInterval(ticker); state.compressing=false;
        var cp2=document.getElementById('compressProgress'+type); if(cp2) cp2.classList.remove('show');
    }

    function processFile(idx){
        if(state._runId!==runId||!state.compressing){ abort(); return; }
        if(idx>=snapshot.length){
            var ci=document.getElementById('compressInfo'+type); if(ci) ci.textContent='Generando ZIP…';
            zip.generateAsync({type:'blob',compression:'DEFLATE',compressionOptions:{level:6}},function(meta){
                if(state._runId!==runId) return;
                updateCompressUI(type,Math.round(meta.percent),processed,0,(Date.now()-state.startTime)/1000,totalRaw);
            }).then(function(blob){
                clearInterval(ticker);
                if(state._runId!==runId){ abort(); return; }
                state.compressing=false; state.zipBlob=blob;
                var cp3=document.getElementById('compressProgress'+type); if(cp3) cp3.classList.remove('show');
                var h=document.getElementById('attachHidden'+type);
                if(h) h.value='ZIP: archivos-'+getToday()+'.zip ('+fmtBytes(blob.size)+')';
                updateCapacityBar(type);
                buildSummaryIfVisible();
                checkEnvio();
            }).catch(function(){ abort(); showAttachMsg(type,'Error al comprimir. Intenta de nuevo.'); });
            return;
        }
        var f=snapshot[idx], reader=new FileReader();
        reader.onload=function(ev){
            if(state._runId!==runId){ abort(); return; }
            zip.file(f.name,ev.target.result);
            processed+=f.size;
            var pct=Math.round((processed/totalRaw)*70);
            updateCompressUI(type,pct,processed,totalRaw-processed,(Date.now()-state.startTime)/1000,totalRaw);
            if(!navigator.onLine){
                clearInterval(ticker); state.paused=true; state.compressing=false;
                var om2=document.getElementById('offlineMsg'+type); if(om2) om2.classList.add('show');
                var cr2=document.getElementById('compressResume'+type); if(cr2) cr2.classList.add('show');
                return;
            }
            setTimeout(function(){ processFile(idx+1); },0);
        };
        reader.onerror=function(){ setTimeout(function(){ processFile(idx+1); },0); };
        reader.readAsArrayBuffer(f);
    }
    processFile(0);
}

function updateCompressUI(type,pct,done,remaining,elapsedSec,total){
    var map={pct:'compressPct',bar:'compressBarFill',done:'compressDoneMB',rem:'compressRemMB',donePct:'compressDonePct',elapsed:'compressElapsed',eta:'compressEta',info:'compressInfo'};
    Object.keys(map).forEach(function(k){
        var el=document.getElementById(map[k]+type); if(!el) return;
        if(k==='pct') el.textContent=pct+'%';
        if(k==='bar') el.style.width=pct+'%';
        if(k==='done') el.textContent=fmtBytes(done);
        if(k==='rem') el.textContent=fmtBytes(remaining);
        if(k==='donePct') el.textContent=pct+'% completado';
        if(k==='elapsed') el.textContent=fmtSec(elapsedSec);
        if(k==='eta') el.textContent=(pct>5&&elapsedSec>0)?fmtSec((elapsedSec/pct)*(100-pct)):'—';
        if(k==='info') el.textContent='Procesando '+attachState[type].files.length+' archivo(s)…';
    });
}

window.addEventListener('online', function(){
    Object.keys(attachState).forEach(function(type){
        var state=attachState[type];
        var om=document.getElementById('offlineMsg'+type); if(om) om.classList.remove('show');
        if(state.paused&&state.files.length>=1){ state.paused=false; startCompression(type); }
    });
});
window.addEventListener('offline', function(){
    Object.keys(attachState).forEach(function(type){
        var state=attachState[type];
        var om=document.getElementById('offlineMsg'+type); if(om) om.classList.add('show');
        if(state.compressing){
            state.paused=true; state.compressing=false;
            state.elapsed=Date.now()-state.startTime;
            var cr=document.getElementById('compressResume'+type); if(cr) cr.classList.add('show');
        }
    });
});

/* ══ RESUMEN DE SOLICITUD ══ */
function buildSummary(){
    var sumBox=document.getElementById('sumBox'), sumCont=document.getElementById('sumCont');
    if(!sumBox||!sumCont) return;

    function makeRow(label,value,chipClass){
        var empty=!value||!String(value).trim()||value==='N/A';
        var valHtml;
        if(empty) valHtml='<span class="sum-v sum-v--empty">—</span>';
        else if(chipClass) valHtml='<span class="sum-chip '+chipClass+'">'+value+'</span>';
        else valHtml='<span class="sum-v">'+value+'</span>';
        return '<div class="sum-row"><span class="sum-k">'+label+':</span>'+valHtml+'</div>';
    }
    function makeGroup(emoji,titulo,filas){
        return '<div class="sum-group"><div class="sum-group-label"><span class="sum-group-label-icon">'+emoji+'</span><span class="sum-group-label-text">'+titulo+'</span></div>'+filas+'</div>';
    }

    var tramite=V('tipoTramite');
    var tramiteLabel=tramite==='alta'?'Alta vehicular':tramite==='refrendo'?'Refrendo':'—';
    var lada=(ladaHidden?ladaHidden.value:'+52').replace('-CA','');
    var tel=V('telefono');
    var telFull=tel?(lada+' '+tel):'';

    var g1=makeGroup('👤','Datos Personales',
        makeRow('Nombre',V('nombre'))+
        makeRow('Teléfono',telFull)+
        makeRow('Correo',V('email'))
    );
    var g2=makeGroup('🚗','Trámite', makeRow('Tipo',tramiteLabel,'sum-chip'));

    if(tramite==='alta'){
        var valV=V('valorVehiculo');
        var costoEl=document.getElementById('costoTotal');
        var costo=costoEl?costoEl.textContent:'—';
        g2+=makeGroup('💰','Vehículo y Costo',
            makeRow('Valor del vehículo',valV?'MX$ '+parseFloat(valV).toLocaleString('es-MX'):'','sum-chip--amount')+
            makeRow('Costo del trámite',costo||'—','sum-chip--amount')
        );
    } else if(tramite==='refrendo'){
        var unidadSel=document.getElementById('tipoUnidad');
        var unidadTxt=unidadSel&&unidadSel.selectedIndex>0?unidadSel.options[unidadSel.selectedIndex].text:'';
        var costoRefEl=document.getElementById('costoTotalRef');
        var costoRef=costoRefEl?costoRefEl.textContent:'—';
        g2+=makeGroup('🔄','Datos del Refrendo',
            makeRow('Placas',V('numeroPlacas'))+
            makeRow('Tipo de unidad',unidadTxt)+
            makeRow('Costo',costoRef||'—','sum-chip--amount')
        );
    }

    var stateKey=tramite==='alta'?'ALTA':'REF';
    var sd=attachState[stateKey];
    var archivos=sd?sd.files.length:0;
    var zipInfo=sd&&sd.zipBlob?fmtBytes(sd.zipBlob.size):'Pendiente';
    var archivosStr=archivos>0?(archivos+' archivo(s) — ZIP: '+zipInfo):'Sin archivos';
    g2+=makeGroup('📎','Documentos Adjuntos', makeRow('Archivos',archivosStr,'sum-chip--files'));

    sumCont.innerHTML=g1+g2;
    sumBox.style.display='';
}

function buildSummaryIfVisible(){
    var secRes=document.getElementById('sec-resumen');
    if(secRes && window.getComputedStyle(secRes).display!=='none') buildSummary();
}

/* ══ MOSTRAR / OCULTAR SECCIONES ══ */
var selTramite=document.getElementById('tipoTramite');
selTramite.addEventListener('change', function(){
    var val=this.value;
    var secAlta=document.getElementById('sec-alta');
    var secRef=document.getElementById('sec-ref');
    var secDecl=document.getElementById('sec-declaracion');
    var secRes=document.getElementById('sec-resumen');

    // Limpiar requeridos
    document.getElementById('numeroPlacas').required=false;
    document.getElementById('tipoUnidad').required=false;
    document.getElementById('valorVehiculo').required=false;

    if(val==='alta'){
        secAlta.style.display='block';
        secRef.style.display='none';
        secDecl.style.display='block';
        secRes.style.display='block';
        document.getElementById('valorVehiculo').required=true;
        document.getElementById('costPillRef').classList.remove('show');
        document.getElementById('tipoUnidad').value='';
        document.getElementById('costPillRef').classList.remove('show');
    } else if(val==='refrendo'){
        secAlta.style.display='none';
        secRef.style.display='block';
        secDecl.style.display='block';
        secRes.style.display='block';
        document.getElementById('numeroPlacas').required=true;
        document.getElementById('tipoUnidad').required=true;
        document.getElementById('costPill').classList.remove('show');
        document.getElementById('valorVehiculo').value='';
    } else {
        secAlta.style.display='none';
        secRef.style.display='none';
        secDecl.style.display='none';
        secRes.style.display='none';
    }

    if(val==='alta'||val==='refrendo'){
        showProgressBar('tramiteForm');
        buildSummary();
    }

    document.getElementById('declaracion').checked=false;
    checkEnvio();
    updateProgressBar();
});

/* ══ CÁLCULO DE COSTOS ══ */
document.getElementById('valorVehiculo').addEventListener('input', function(){
    var v=parseFloat(this.value)||0;
    var pill=document.getElementById('costPill');
    var amt=document.getElementById('costoTotal');
    var c=0;
    if(v>0&&v<=990000) c=6000;
    else if(v>=1000000&&v<=1950000) c=6500;
    else if(v>=2000000) c=7500;
    if(c>0){ amt.textContent='$'+c.toLocaleString('es-MX',{minimumFractionDigits:2}); pill.classList.add('show'); }
    else pill.classList.remove('show');
    checkEnvio(); buildSummaryIfVisible();
});

document.getElementById('tipoUnidad').addEventListener('change', function(){
    var pill=document.getElementById('costPillRef');
    var amt=document.getElementById('costoTotalRef');
    var opt=this.options[this.selectedIndex];
    var c=parseFloat(opt.dataset.costo)||0;
    if(c>0){ amt.textContent='$'+c.toLocaleString('es-MX',{minimumFractionDigits:2}); pill.classList.add('show'); }
    else pill.classList.remove('show');
    checkEnvio(); buildSummaryIfVisible();
});

/* ── Listeners para rebuild de resumen ── */
['nombre','telefono','email','numeroPlacas'].forEach(function(id){
    var el=document.getElementById(id);
    if(el) el.addEventListener('input', buildSummaryIfVisible);
});

/* ══ VALIDACIÓN Y BOTÓN ENVIAR ══ */
function checkEnvio(){
    var tramite=document.getElementById('tipoTramite').value;
    var declarado=document.getElementById('declaracion').checked;
    var btn=document.getElementById('submitBtn');
    if(!tramite||!rcApiReady){ btn.disabled=true; return; }
    // El botón se activa solo con checkbox marcado; validación completa ocurre al submit
    btn.disabled=!declarado;
}

document.getElementById('declaracion').addEventListener('change', function(){ checkEnvio(); updateProgressBar(); });
document.getElementById('numeroPlacas').addEventListener('input', function(){ checkEnvio(); updateProgressBar(); });
document.getElementById('tipoUnidad').addEventListener('change', function(){ checkEnvio(); updateProgressBar(); });
['nombre','telefono','email'].forEach(function(id){
    var el=document.getElementById(id);
    if(el){ el.addEventListener('input',updateProgressBar); el.addEventListener('change',updateProgressBar); }
});

/* ══ BARRA DE PROGRESO ══ */
var progressState={currentForm:null};

function getRequiredFieldsVisible(formId){
    var form=document.getElementById(formId); if(!form) return [];
    var fields=[], seen={};
    form.querySelectorAll('[required]').forEach(function(el){
        if(el.type==='hidden') return;
        if(el.classList&&el.classList.contains('lada-select-hidden')) return;
        // Skip fields in hidden sections
        var parent=el.closest('.sec-hide, [style*="display: none"], [style*="display:none"]');
        if(parent) return;
        var key=el.name||el.id||('f'+Math.random());
        if(!seen[key]){ seen[key]=true; fields.push(el); }
    });
    return fields;
}

function updateProgressBar(){
    if(!progressState.currentForm) return;
    var fields=getRequiredFieldsVisible(progressState.currentForm);
    var total=fields.length, done=0;
    fields.forEach(function(el){
        if(el.value&&el.value.trim().length>0) done++;
    });
    var pct=total>0?(done/total)*100:0;
    document.getElementById('formProgressFill').style.width=pct+'%';
    document.getElementById('formProgressDone').textContent=done;
    document.getElementById('formProgressTotal').textContent=total;
}

function showProgressBar(formId){
    progressState.currentForm=formId;
    document.getElementById('formProgressWrap').classList.add('visible');
    var form=document.getElementById(formId);
    if(form) form.querySelectorAll('input,select,textarea').forEach(function(el){
        el.addEventListener('input',updateProgressBar);
        el.addEventListener('change',updateProgressBar);
    });
    updateProgressBar();
}

/* ══ ENVÍO DEL FORMULARIO ══ */
document.getElementById('tramiteForm').addEventListener('submit', function(e){
    e.preventDefault();
    var form=this;
    var tramite=document.getElementById('tipoTramite').value;

    if(!document.getElementById('declaracion').checked){
        showToast('Debe marcar la casilla de declaración para continuar.','err'); return;
    }
    if(!rcApiReady){
        showToast('Espere a que se complete la verificación de seguridad.','err'); return;
    }

    // Validar campos obligatorios y hacer scroll al primero vacío
    var primerVacio=findFirstEmpty(tramite);
    if(primerVacio){
        primerVacio.focus();
        primerVacio.scrollIntoView({behavior:'smooth',block:'center'});
        primerVacio.style.borderColor='#ef4444';
        setTimeout(function(){ primerVacio.style.borderColor=''; },3000);
        showToast('Completa todos los campos obligatorios antes de enviar.','err');
        return;
    }

    // Validar archivos adjuntos
    var stateKey=tramite==='alta'?'ALTA':'REF';
    if(attachState[stateKey].files.length===0){
        var dz=document.getElementById('attachDropzone'+stateKey);
        if(dz){ dz.style.borderColor='#ef4444'; setTimeout(function(){ dz.style.borderColor=''; },3000); }
        showToast('Debe adjuntar al menos un documento antes de enviar.','err');
        return;
    }

    // Validar que el ZIP no supere el límite
    var sd=attachState[stateKey];
    if(sd.zipBlob && sd.zipBlob.size>=MAX_ZIP_BYTES){
        showToast('El archivo ZIP supera los 5 MB. Elimina archivos antes de enviar.','err');
        return;
    }

    var btn=document.getElementById('submitBtn');
    btn.disabled=true; btn.textContent='Verificando…';

    // Preparar teléfono con lada
    var lada=(ladaHidden?ladaHidden.value:'+52').replace('-CA','');
    var num=document.getElementById('telefono').value.trim();
    document.getElementById('telefono').value=lada+' '+num;

    grecaptcha.execute(RC_KEY,{action:'submit'}).then(function(token){
        var hiddenToken=form.querySelector('input[name="g-recaptcha-response"]');
        if(!hiddenToken){
            hiddenToken=document.createElement('input');
            hiddenToken.type='hidden'; hiddenToken.name='g-recaptcha-response';
            form.appendChild(hiddenToken);
        }
        hiddenToken.value=token;
        btn.textContent='Enviando…';

        var fd=new FormData(form);

        // Adjuntar ZIP generado por JSZip
        if(sd.zipBlob){
            var zipFileName='documentos-tramite-'+getToday()+'.zip';
            fd.append('documentos_zip',sd.zipBlob,zipFileName);
        }

        fetch(form.action,{method:'POST',body:fd})
            .then(function(){ showSuccessModal(); })
            .catch(function(){ showSuccessModal(); }); // Mostrar siempre al usuario

    }).catch(function(){
        btn.disabled=false; btn.textContent='Enviar Solicitud';
        showToast('Error en la verificación de seguridad. Intente de nuevo.','err');
    });
});

function findFirstEmpty(tramite){
    var nombre=document.getElementById('nombre');
    if(!nombre.value.trim()) return nombre;
    var tel=document.getElementById('telefono');
    if(!tel.value.trim()) return tel;
    var email=document.getElementById('email');
    if(!email.value.trim()) return email;
    // Validar email básico
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())){
        showToast('El correo electrónico no tiene un formato válido.','err');
        email.focus(); email.scrollIntoView({behavior:'smooth',block:'center'});
        email.style.borderColor='#ef4444';
        setTimeout(function(){ email.style.borderColor=''; },3000);
        return email;
    }
    if(tramite==='alta'){
        var val=document.getElementById('valorVehiculo');
        if(!val.value||parseFloat(val.value)<=0) return val;
    } else if(tramite==='refrendo'){
        var plac=document.getElementById('numeroPlacas');
        if(!plac.value.trim()) return plac;
        var unid=document.getElementById('tipoUnidad');
        if(!unid.value) return unid;
    }
    return null;
}

/* ══ MODAL DE ÉXITO ══ */
function showSuccessModal(){
    document.getElementById('successOverlay').classList.add('show');
    document.body.style.overflow='hidden';
}

function closeSuccessModal(){
    document.getElementById('successOverlay').classList.remove('show');
    document.body.style.overflow='';

    // Reset formulario
    document.getElementById('tramiteForm').reset();
    document.getElementById('sec-alta').style.display='none';
    document.getElementById('sec-ref').style.display='none';
    document.getElementById('sec-declaracion').style.display='none';
    document.getElementById('sec-resumen').style.display='none';
    document.getElementById('costPill').classList.remove('show');
    document.getElementById('costPillRef').classList.remove('show');
    document.getElementById('sumBox').style.display='none';

    // Reset adjuntos
    Object.keys(attachState).forEach(function(type){
        attachState[type]={files:[],zipBlob:null,compressing:false,paused:false,startTime:null,elapsed:0,_runId:null};
        var fl=document.getElementById('fileList'+type); if(fl) fl.innerHTML='';
        var cp=document.getElementById('compressProgress'+type); if(cp) cp.classList.remove('show');
        var om=document.getElementById('offlineMsg'+type); if(om) om.classList.remove('show');
        var cw=document.getElementById('capacityWrap'+type); if(cw) cw.classList.remove('visible');
        var rs=document.getElementById('attachRealtime'+type); if(rs) rs.style.display='none';
        var hi=document.getElementById('attachHidden'+type); if(hi) hi.value='';
    });

    document.getElementById('submitBtn').disabled=true;
    document.getElementById('submitBtn').textContent='Enviar Solicitud';
    document.getElementById('formProgressWrap').classList.remove('visible');
    progressState.cu
