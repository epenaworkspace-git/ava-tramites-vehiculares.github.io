<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVA - Tr√°mites Vehiculares en Morelos</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap" rel="stylesheet">
    <script src="https://www.google.com/recaptcha/api.js?render=6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV" async defer></script>
    <script src="https://elfsightcdn.com/platform.js" async></script>

    <style>
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

        :root {
            --azul-dark:   #0A1F44;
            --azul-mid:    #162d54;
            --azul-blue:   #165DFF;
            --azul-light:  #e8f0ff;
            --blanco:      #FFFFFF;
            --gris-dark:   #333333;
            --gris-mid:    #6b7280;
            --gris-light:  #f3f6fa;
            --gris-border: #dde3ec;
            --verde:       #22c55e;
            --rojo:        #ef4444;
            --r:           10px;
            --r-lg:        16px;
            --shadow:      0 4px 24px rgba(10,31,68,.10);
            --shadow-lg:   0 8px 40px rgba(10,31,68,.14);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #eef2f8;
            color: var(--gris-dark);
            min-height: 100vh;
            padding: 24px 16px 100px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .wrapper {
            max-width: 860px;
            margin: 0 auto;
            animation: fadeUp .6s ease both;
        }
        @keyframes fadeUp {
            from { opacity:0; transform:translateY(20px); }
            to   { opacity:1; transform:translateY(0); }
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .hdr {
            background: linear-gradient(135deg, var(--azul-dark) 0%, var(--azul-mid) 100%);
            border-radius: var(--r-lg) var(--r-lg) 0 0;
            padding: 40px 40px 34px;
            text-align: center;
            position: relative; overflow: hidden;
        }
        .hdr::before {
            content:''; position:absolute; inset:0;
            background: radial-gradient(ellipse 80% 60% at 50% 120%, rgba(22,93,255,.28) 0%, transparent 70%);
        }
        .hdr-logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.7rem; font-weight: 800;
            letter-spacing: 3px;
            position: relative; z-index:1; line-height:1; margin-bottom:8px;
        }
        .hdr-logo .letra-a  { color: var(--blanco); font-style:normal; }
        .hdr-logo .letra-va { color: var(--azul-blue); font-style:normal; }
        .hdr-sub {
            font-size: .78rem; font-weight:600; letter-spacing:4px;
            text-transform:uppercase; color:rgba(255,255,255,.70);
            position:relative; z-index:1;
        }

        /* ‚îÄ‚îÄ FORM CARD ‚îÄ‚îÄ */
        .form-card {
            background: var(--blanco);
            border:1px solid var(--gris-border); border-top:none;
            border-radius:0 0 var(--r-lg) var(--r-lg);
            padding: 40px; box-shadow: var(--shadow-lg);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        /* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
        .sec-title {
            display:flex; align-items:center; gap:12px;
            margin-bottom:24px; padding-bottom:14px;
            border-bottom:2px solid var(--azul-blue);
        }
        .sec-icon {
            width:34px; height:34px; background:var(--azul-light);
            border-radius:8px; display:flex; align-items:center; justify-content:center;
            font-size:1rem; flex-shrink:0;
            transition: background 0.3s ease;
        }
        .sec-title h2 {
            font-size:.88rem; font-weight:700; letter-spacing:1.5px;
            text-transform:uppercase; color:var(--azul-dark);
            transition: color 0.3s ease;
        }

        /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
        .g2 { display:grid; grid-template-columns:1fr 1fr; gap:18px; }
        .g-full { grid-column:1 / -1; }

        /* ‚îÄ‚îÄ FIELD ‚îÄ‚îÄ */
        .fld { display:flex; flex-direction:column; gap:6px; }
        .fld label {
            font-size:.8rem; font-weight:600; color:var(--azul-dark); letter-spacing:.2px;
            transition: color 0.3s ease;
        }
        .fld label .req { color:var(--azul-blue); margin-left:2px; }
        .fld label .opt { color:var(--gris-mid); font-weight:400; font-style:italic; margin-left:4px; font-size:.75rem; }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        select {
            width:100%; padding:11px 14px;
            border:1.5px solid var(--gris-border);
            border-radius:var(--r);
            font-size:.9rem; font-family:'Inter',sans-serif; color:var(--gris-dark);
            background:var(--blanco);
            transition:border-color .25s, box-shadow .25s, background-color 0.3s ease, color 0.3s ease;
        }
        input::placeholder { color:#b0b9c8; transition: color 0.3s ease; }
        input:focus, select:focus {
            outline:none; border-color:var(--azul-blue);
            box-shadow:0 0 0 3px rgba(22,93,255,.11);
        }
        select {
            cursor:pointer; appearance:none;
            background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23165DFF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat:no-repeat; background-position:right 12px center;
            padding-right:40px;
        }

        /* ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ */
        .div { height:1px; background:var(--gris-border); margin:30px 0; transition: background 0.3s ease; }

        /* ‚îÄ‚îÄ COST PILL ‚îÄ‚îÄ */
        .cost-pill {
            display:none; align-items:center; justify-content:space-between;
            background:linear-gradient(135deg, var(--azul-light) 0%, #dbeafe 100%);
            border:1.5px solid var(--azul-blue);
            border-radius:var(--r-lg); padding:14px 20px; margin-top:10px;
            animation:fadeUp .4s ease;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .cost-pill.show { display:flex; }
        .cp-lbl { font-size:.8rem; font-weight:700; color:var(--azul-dark); transition: color 0.3s ease; }
        .cp-amt { font-size:1.65rem; font-weight:800; color:var(--azul-blue); font-feature-settings:"tnum"; }

        /* ‚îÄ‚îÄ REQ BOX ‚îÄ‚îÄ */
        .rbox { background:var(--gris-light); border-radius:var(--r-lg); border:1px solid var(--gris-border); overflow:hidden; transition: background 0.3s ease, border-color 0.3s ease; }
        .rbox-head {
            background:var(--azul-dark); color:var(--blanco);
            padding:12px 18px; font-size:.78rem; font-weight:700;
            letter-spacing:1px; text-transform:uppercase;
            display:flex; align-items:center; gap:8px;
        }
        .rbox-body { padding:18px; }
        .r-alert {
            background:#fefce8; border:1px solid #facc15;
            border-radius:8px; padding:12px 14px;
            font-size:.8rem; color:#854d0e; margin-bottom:16px; line-height:1.6;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .rg-title {
            font-size:.75rem; font-weight:700; text-transform:uppercase;
            letter-spacing:.8px; color:var(--azul-blue); margin:14px 0 7px;
        }
        .rlist { list-style:none; }
        .rlist li {
            font-size:.8rem; line-height:1.6; padding:5px 0 5px 22px;
            position:relative; border-bottom:1px solid rgba(0,0,0,.04);
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .rlist li:last-child { border-bottom:none; }
        .rlist li.ob::before { content:'‚úì'; position:absolute; left:0; top:5px; color:var(--azul-blue); font-weight:800; }
        .rlist li.op::before { content:'‚óã'; position:absolute; left:1px; top:5px; color:var(--gris-mid); font-weight:800; }
        .bOb {
            display:inline-block; background:var(--azul-blue); color:#fff;
            font-size:.6rem; font-weight:800; padding:1px 5px; border-radius:3px;
            margin-right:3px; vertical-align:middle; text-transform:uppercase;
        }
        .bOp {
            display:inline-block; background:var(--gris-mid); color:#fff;
            font-size:.6rem; font-weight:800; padding:1px 5px; border-radius:3px;
            margin-right:3px; vertical-align:middle; text-transform:uppercase;
        }
        .r-fmt {
            background:#eff6ff; border:1px solid #93c5fd;
            border-radius:8px; padding:12px 14px;
            font-size:.79rem; color:#1e40af; margin-top:14px; line-height:1.7;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* ‚îÄ‚îÄ FILE DROP ‚îÄ‚îÄ */
        .fdrop {
            border:2px dashed var(--gris-border); border-radius:var(--r-lg);
            padding:26px 18px; text-align:center; cursor:pointer;
            transition:all .3s; background:var(--gris-light); position:relative;
        }
        .fdrop:hover, .fdrop.drag { border-color:var(--azul-blue); background:var(--azul-light); }
        .fdrop input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
        .fd-icon  { font-size:2rem; margin-bottom:6px; }
        .fd-main  { font-size:.85rem; font-weight:700; color:var(--azul-dark); margin-bottom:3px; transition: color 0.3s ease; }
        .fd-sub   { font-size:.75rem; color:var(--gris-mid); transition: color 0.3s ease; }
        .fd-link  { color:var(--azul-blue); font-weight:700; text-decoration:underline; }
        .fd-hint  { font-size:.72rem; color:var(--gris-mid); margin-top:4px; transition: color 0.3s ease; }
        .fd-hint strong { color:var(--azul-dark); transition: color 0.3s ease; }

        /* ‚îÄ‚îÄ FILE MANAGER ‚îÄ‚îÄ */
        .fmgr { margin-top:14px; }
        .fmgr-bar-wrap { margin-bottom:6px; }
        .fmgr-bar-label {
            display:flex; justify-content:space-between; align-items:center;
            font-size:.76rem; font-weight:600; color:var(--azul-dark); margin-bottom:5px;
            transition: color 0.3s ease;
        }
        .fmgr-bar-track {
            width:100%; height:10px; background:#e5e7eb; border-radius:99px; overflow:hidden;
            transition: background 0.3s ease;
        }
        .fmgr-bar-fill {
            height:100%; border-radius:99px; transition:width .4s ease, background .4s ease;
            background: var(--verde);
        }
        .fmgr-status {
            display:flex; align-items:center; gap:6px;
            font-size:.75rem; margin-top:5px; margin-bottom:10px;
            font-weight:500;
        }
        .fmgr-dot {
            width:10px; height:10px; border-radius:50%; flex-shrink:0;
            background: var(--verde);
        }
        .fmgr-error {
            font-size:.76rem; color:#b91c1c; background:#fef2f2;
            border:1px solid #fecaca; border-radius:7px;
            padding:7px 12px; margin-bottom:8px; display:none;
        }
        .fmgr-list { display:flex; flex-direction:column; gap:6px; }
        .fmgr-item {
            display:flex; align-items:center; justify-content:space-between;
            background:var(--blanco); border:1px solid var(--gris-border);
            border-radius:9px; padding:9px 12px;
            font-size:.78rem; gap:8px;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .fmgr-item-left { display:flex; align-items:center; gap:8px; flex:1; min-width:0; }
        .fmgr-item-icon { font-size:1.1rem; flex-shrink:0; }
        .fmgr-item-name { font-weight:600; color:var(--azul-dark); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; transition: color 0.3s ease; }
        .fmgr-item-size { color:var(--gris-mid); flex-shrink:0; font-size:.74rem; transition: color 0.3s ease; }
        .fmgr-item-del {
            background:none; border:none; cursor:pointer;
            color:#9ca3af; font-size:1.1rem; line-height:1;
            padding:2px 4px; border-radius:4px; flex-shrink:0;
            transition:color .2s, background .2s;
        }
        .fmgr-item-del:hover { color:#ef4444; background:#fef2f2; }

        /* ‚îÄ‚îÄ RECAPTCHA ‚îÄ‚îÄ */
        .recap { margin:26px 0 18px; text-align:center; min-height:32px; }
        .recap-spin {
            display:inline-block; width:26px; height:26px;
            border:3px solid var(--gris-border);
            border-top:3px solid var(--azul-blue);
            border-radius:50%; animation:spin 1s linear infinite;
        }
        @keyframes spin { to { transform:rotate(360deg); } }
        .recap-txt { font-size:.79rem; margin-top:7px; color:var(--gris-mid); transition: color 0.3s ease; }
        .recap-txt.ok  { color:var(--verde); }
        .recap-txt.err { color:var(--rojo); }

        /* ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ */
        .btn-submit {
            width:100%; padding:14px;
            background:linear-gradient(135deg, var(--azul-blue) 0%, #0d3dcc 100%);
            color:var(--blanco); border:none; border-radius:var(--r-lg);
            font-family:'Inter',sans-serif; font-size:.9rem; font-weight:700;
            letter-spacing:.8px; text-transform:uppercase;
            cursor:pointer;
            box-shadow:0 6px 18px rgba(22,93,255,.28);
            transition:transform .2s, box-shadow .2s, opacity .2s;
        }
        .btn-submit:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 10px 28px rgba(22,93,255,.38); }
        .btn-submit:disabled { opacity:.5; cursor:not-allowed; }

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        .toast { display:none; margin-top:16px; padding:13px 16px; border-radius:var(--r); font-size:.84rem; font-weight:600; text-align:center; }
        .toast.ok  { background:#f0fdf4; color:#166534; border:1px solid #bbf7d0; display:block; }
        .toast.err { background:#fef2f2; color:#991b1b; border:1px solid #fecaca; display:block; }

        /* ‚îÄ‚îÄ HIDDEN ‚îÄ‚îÄ */
        .sec-hide { display:none; }

        /* ‚îÄ‚îÄ WHATSAPP ‚îÄ‚îÄ */
        .wa-btn {
            position:fixed; bottom:50px; left:50px;
            background:linear-gradient(135deg,#25d366 0%,#128c7e 100%);
            color:white; width:72px; height:72px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            box-shadow:0 10px 30px rgba(37,211,102,.4);
            cursor:pointer; z-index:900;
            transition:all .4s cubic-bezier(.4,0,.2,1);
            text-decoration:none;
            animation:waFloat 3s ease-in-out infinite;
            border:4px solid white; overflow:hidden;
        }
        .wa-btn::before {
            content:''; position:absolute; inset:0;
            background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.3) 50%,transparent 70%);
            animation:waShine 3s infinite;
        }
        .wa-btn:hover { transform:scale(1.18) translateY(-5px); box-shadow:0 20px 40px rgba(37,211,102,.6); animation:none; }
        .wa-tip {
            position:absolute; left:90px; background:white; color:#333;
            padding:11px 18px; border-radius:10px; white-space:nowrap;
            box-shadow:0 8px 24px rgba(0,0,0,.14); opacity:0; pointer-events:none;
            transition:all .4s cubic-bezier(.4,0,.2,1);
            font-size:.85rem; font-weight:600;
            border:1px solid rgba(0,0,0,.08); z-index:901;
        }
        .wa-btn:hover .wa-tip { opacity:1; transform:translateX(10px); }
        .wa-svg { width:32px; height:32px; position:relative; z-index:1; }
        .wa-svg path { fill:white; }
        @keyframes waFloat {
            0%,100% { transform:translateY(0) rotate(0deg); }
            25%      { transform:translateY(-13px) rotate(2deg); }
            75%      { transform:translateY(-5px) rotate(-2deg); }
        }
        @keyframes waShine {
            0%   { transform:translateX(-100%); }
            100% { transform:translateX(100%); }
        }

        .elfsight-app-beb4a331-0ecc-4c09-b401-4d88d35cbf03 { z-index:950 !important; }

        /* ‚îÄ‚îÄ CASILLA DE VERIFICACI√ìN ‚îÄ‚îÄ */
        .check-wrap {
            background: var(--gris-light);
            border: 1.5px solid var(--gris-border);
            border-radius: var(--r-lg);
            padding: 18px 20px;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .check-label {
            display: flex; align-items: flex-start; gap: 14px; cursor: pointer;
        }
        .check-label input[type="checkbox"] { display: none; }
        .check-box {
            width: 22px; height: 22px; min-width: 22px;
            border: 2px solid var(--gris-border);
            border-radius: 5px; background: var(--blanco);
            display: flex; align-items: center; justify-content: center;
            margin-top: 1px;
            transition: all .2s ease;
        }
        .check-box::after {
            content: ''; display: none;
            width: 6px; height: 11px;
            border: 2.5px solid var(--blanco);
            border-top: none; border-left: none;
            transform: rotate(45deg) translateY(-1px);
        }
        .check-label input:checked ~ .check-box {
            background: var(--azul-blue); border-color: var(--azul-blue);
        }
        .check-label input:checked ~ .check-box::after { display: block; }
        .check-label:hover .check-box { border-color: var(--azul-blue); }
        .check-txt {
            font-size: .77rem; line-height: 1.65;
            color: var(--gris-dark); font-weight: 500;
            transition: color 0.3s ease;
        }

        /* ‚îÄ‚îÄ TEL√âFONO CON LADA ‚îÄ‚îÄ */
        .phone-wrap {
            display: flex; gap: 0;
            border: 1.5px solid var(--gris-border);
            border-radius: var(--r);
            overflow: visible;
            transition: border-color .25s, box-shadow .25s;
            position: relative;
        }
        .phone-wrap:focus-within {
            border-color: var(--azul-blue);
            box-shadow: 0 0 0 3px rgba(22,93,255,.11);
        }

        .lada-custom {
            position: relative; flex-shrink: 0;
            border-right: 1.5px solid var(--gris-border);
            background: var(--gris-light);
            border-radius: var(--r) 0 0 var(--r);
            user-select: none;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        .lada-trigger {
            display: flex; align-items: center; gap: 6px;
            padding: 11px 10px 11px 12px;
            cursor: pointer; min-width: 108px;
            font-size: .85rem; font-family: 'Inter', sans-serif;
            color: var(--gris-dark); white-space: nowrap;
            transition: color 0.3s ease;
        }
        .lada-trigger .lada-flag  { font-size: 1.15rem; line-height: 1; }
        .lada-trigger .lada-code  { font-weight: 600; }
        .lada-trigger .lada-arrow {
            margin-left: auto; font-size: .65rem; color: var(--azul-blue);
            transition: transform .2s;
        }
        .lada-custom.open .lada-arrow { transform: rotate(180deg); }

        .lada-dropdown {
            display: none; position: absolute; top: calc(100% + 4px); left: -1px;
            width: 220px; max-height: 280px; overflow-y: auto;
            background: var(--blanco); border: 1.5px solid var(--azul-blue);
            border-radius: var(--r); box-shadow: 0 8px 24px rgba(10,31,68,.14);
            z-index: 200;
            transition: background 0.3s ease;
        }
        .lada-custom.open .lada-dropdown { display: block; }

        .lada-search {
            padding: 8px 10px;
            border-bottom: 1px solid var(--gris-border);
            position: sticky; top: 0; background: var(--blanco); z-index: 1;
            transition: background 0.3s ease;
        }
        .lada-search input {
            width: 100%; border: 1.5px solid var(--gris-border); border-radius: 7px;
            padding: 6px 10px; font-size: .8rem; font-family: 'Inter', sans-serif;
            outline: none; color: var(--gris-dark);
            transition: border-color .2s, background 0.3s ease, color 0.3s ease;
        }
        .lada-search input:focus { border-color: var(--azul-blue); }

        .lada-opt {
            display: flex; align-items: center; gap: 9px;
            padding: 9px 12px; cursor: pointer; font-size: .83rem;
            transition: background .15s;
        }
        .lada-opt:hover   { background: var(--azul-light); }
        .lada-opt.active  { background: var(--azul-light); font-weight: 700; }
        .lada-opt .lo-flag { font-size: 1.1rem; line-height: 1; flex-shrink: 0; }
        .lada-opt .lo-name { color: var(--gris-mid); font-size: .76rem; flex: 1; }
        .lada-opt .lo-code { font-weight: 600; color: var(--azul-dark); flex-shrink: 0; }

        .lada-select-hidden { display: none !important; }

        .phone-input {
            border: none !important;
            border-radius: 0 var(--r) var(--r) 0 !important;
            box-shadow: none !important;
            flex: 1;
        }
        .phone-input:focus { outline: none; box-shadow: none !important; }

        /* ===================== THEME TOGGLE BUTTON ===================== */
        .theme-toggle-btn {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 2000;
          width: 52px;
          height: 52px;
          border-radius: 50%;
          background: linear-gradient(145deg, #e8ecf4, #d0d6e8);
          box-shadow:
            0 6px 20px rgba(0,0,0,0.18),
            inset 0 -2px 4px rgba(0,0,0,0.15),
            inset 0 2px 4px rgba(255,255,255,0.9);
          cursor: pointer;
          border: none;
          outline: none;
          overflow: hidden;
          transition: all 0.3s ease;
          animation: subtlePulse 3s infinite ease-in-out;
        }
        .theme-toggle-btn::before {
          content: '';
          position: absolute;
          top: -50%; left: -50%;
          width: 200%; height: 200%;
          background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.75) 0%, rgba(255,255,255,0) 65%);
          opacity: 0;
          transition: opacity 0.4s ease;
          pointer-events: none;
        }
        .theme-toggle-btn:hover::before { opacity: 1; }
        .theme-toggle-btn:hover {
          animation: none;
          transform: scale(1.08);
          box-shadow: 0 10px 30px rgba(0,0,0,0.25),
            inset 0 -2px 4px rgba(0,0,0,0.15),
            inset 0 3px 6px rgba(255,255,255,1);
        }
        .theme-toggle-btn:active { transform: scale(0.94); }

        @keyframes subtlePulse {
          0%,100% { transform: scale(1); }
          50%      { transform: scale(1.03); }
        }

        .toggle-icon-wrap {
          position: relative;
          width: 100%; height: 100%;
          display: flex; align-items: center; justify-content: center;
          transition: transform 0.5s cubic-bezier(0.34,1.56,0.64,1);
        }
        .theme-toggle-btn:hover .toggle-icon-wrap { transform: rotate(20deg); }

        .icon-sun, .icon-moon {
          position: absolute;
          width: 28px; height: 28px;
          transition: all 0.45s cubic-bezier(0.68,-0.55,0.265,1.55);
        }
        .icon-sun {
          opacity: 1;
          transform: scale(1) rotate(0deg);
          filter: drop-shadow(0 0 4px rgba(255,215,0,0.6));
        }
        .icon-moon {
          opacity: 0;
          transform: scale(0.4) rotate(-80deg);
          filter: drop-shadow(0 0 4px rgba(100,120,255,0.6));
        }

        body.dark-mode .icon-sun  { opacity: 0; transform: scale(0.4) rotate(80deg); }
        body.dark-mode .icon-moon { opacity: 1; transform: scale(1) rotate(0deg); }
        body.dark-mode .theme-toggle-btn {
          background: linear-gradient(145deg, #1e2d50, #0f1d38);
          box-shadow: 0 6px 20px rgba(0,0,0,0.4),
            0 0 15px rgba(65,105,225,0.3),
            inset 0 -2px 4px rgba(0,0,0,0.4),
            inset 0 2px 4px rgba(255,255,255,0.06);
        }

        /* ===================== DARK MODE ===================== */
        body.dark-mode {
          background: #0c1525;
          color: #d0d8ec;
        }
        body.dark-mode .form-card {
          background: #111e36;
          border-color: #1e2d4a;
        }
        body.dark-mode .sec-title h2 { color: #a8bde0; }
        body.dark-mode .sec-icon { background: #1a2d50; }
        body.dark-mode .fld label { color: #7a8fb0; }
        body.dark-mode input[type="text"],
        body.dark-mode input[type="email"],
        body.dark-mode input[type="tel"],
        body.dark-mode input[type="number"],
        body.dark-mode select {
          background: #162040;
          border-color: #243660;
          color: #d0d8ec;
        }
        body.dark-mode input[type="text"]:focus,
        body.dark-mode input[type="email"]:focus,
        body.dark-mode input[type="tel"]:focus,
        body.dark-mode input[type="number"]:focus,
        body.dark-mode select:focus {
          background: #1a2850;
          border-color: #4d8aff;
          box-shadow: 0 0 0 3px rgba(77,138,255,0.15);
        }
        body.dark-mode input::placeholder { color: #4a5878; }
        body.dark-mode .div { background: #1e2d4a; }
        body.dark-mode .cost-pill {
          background: linear-gradient(135deg, #1a2d50 0%, #162040 100%);
          border-color: #4d8aff;
        }
        body.dark-mode .cp-lbl { color: #a8bde0; }
        body.dark-mode .cp-amt { color: #78b0ff; }
        body.dark-mode .rbox { background: #0f1d35; border-color: #1e2d4a; }
        body.dark-mode .rbox-head { background: #0a1525; }
        body.dark-mode .rlist li { color: #b0c4e0; border-bottom-color: rgba(255,255,255,.06); }
        body.dark-mode .r-alert { background: #2a2000; border-color: #6b5300; color: #e0c060; }
        body.dark-mode .r-fmt { background: #0f1e35; border-color: #1e3a60; color: #6ba3ff; }
        body.dark-mode .fdrop { background: #0f1d35; border-color: #243660; }
        body.dark-mode .fdrop:hover, body.dark-mode .fdrop.drag { background: #162040; border-color: #4d8aff; }
        body.dark-mode .fd-main { color: #a8bde0; }
        body.dark-mode .fd-sub { color: #4a5878; }
        body.dark-mode .fd-hint { color: #4a5878; }
        body.dark-mode .fd-hint strong { color: #7a8fb0; }
        body.dark-mode .fmgr-bar-label { color: #7a8fb0; }
        body.dark-mode .fmgr-bar-track { background: #1e2d4a; }
        body.dark-mode .fmgr-item { background: #162040; border-color: #243660; }
        body.dark-mode .fmgr-item-name { color: #a8bde0; }
        body.dark-mode .fmgr-item-size { color: #4a5878; }
        body.dark-mode .check-wrap { background: #0f1d35; border-color: #1e2d4a; }
        body.dark-mode .check-box { background: #162040; border-color: #243660; }
        body.dark-mode .check-txt { color: #b0c4e0; }
        body.dark-mode .lada-custom { background: #162040; border-color: #243660; }
        body.dark-mode .lada-trigger { color: #d0d8ec; }
        body.dark-mode .lada-dropdown { background: #111e36; border-color: #4d8aff; }
        body.dark-mode .lada-search { background: #0f1d35; border-color: #1e2d4a; }
        body.dark-mode .lada-search input { background: #162040; border-color: #243660; color: #d0d8ec; }
        body.dark-mode .lada-opt:hover { background: #1a2d50; }
        body.dark-mode .lada-opt.active { background: #1a2d50; }
        body.dark-mode .lada-opt .lo-name { color: #4a5878; }
        body.dark-mode .lada-opt .lo-code { color: #a8bde0; }
        body.dark-mode .phone-wrap { border-color: #243660; }
        body.dark-mode .recap-txt { color: #4a5878; }
        body.dark-mode .toast.ok  { background: #052e16; color: #86efac; border-color: #166534; }
        body.dark-mode .toast.err { background: #2d0a0a; color: #fca5a5; border-color: #7f1d1d; }

        /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
           DARK MODE ‚Äî BOTONES FLOTANTES: BISEL MONOCROM√ÅTICO
           El contorno blanco desaparece y se convierte en un
           biselado que se funde con el color principal del bot√≥n
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

        /* Bot√≥n "Iniciar Tr√°mite" ‚Äî contorno uniforme, discreto, en dark mode */
        body.dark-mode .tramite-float {
            border: 2px solid rgba(255,255,255,0.09);
        }

        /* Bot√≥n WhatsApp ‚Äî contorno uniforme, discreto, en dark mode */
        body.dark-mode .wa-btn {
            border: 2px solid rgba(255,255,255,0.12);
        }

        /* Tooltip en dark mode */
        body.dark-mode .tramite-tooltip {
            background: rgba(14, 24, 44, 0.96);
            color: #c8d8f0;
            border: 1px solid #243660;
            box-shadow: 0 8px 28px rgba(0,0,0,0.40);
        }

        /* ===================== FLOATING PROGRESS BAR ===================== */
        .form-progress-wrap {
          position: fixed;
          bottom: 28px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 1500;
          display: none;
          width: calc(100% - 200px);
          max-width: 720px;
          min-width: 280px;
          pointer-events: none;
        }
        .form-progress-wrap.visible { display: block; }

        .form-progress-pill {
          background: #ffffff;
          border-radius: 60px;
          padding: 10px 20px 10px 16px;
          display: flex;
          align-items: center;
          gap: 14px;
          box-shadow:
            0 4px 24px rgba(10,31,68,0.14),
            0 1px 4px rgba(10,31,68,0.08);
          border: 1px solid rgba(10,31,68,0.07);
          transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-progress-bar-track {
          flex: 1;
          height: 8px;
          background: #E8ECF4;
          border-radius: 99px;
          overflow: hidden;
          position: relative;
          transition: background 0.3s ease;
        }

        .form-progress-bar-fill {
          height: 100%;
          background: linear-gradient(90deg, #165DFF 0%, #3a7fff 100%);
          border-radius: 99px;
          width: 0%;
          transition: width 0.45s cubic-bezier(0.4, 0, 0.2, 1);
          position: relative;
        }

        .form-progress-bar-fill::after {
          content: '';
          position: absolute;
          top: 0; left: -60px;
          width: 50px; height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.55), transparent);
          animation: barShine 2.2s ease-in-out infinite;
        }
        @keyframes barShine {
          0%   { left: -60px; opacity: 0; }
          10%  { opacity: 1; }
          90%  { opacity: 1; }
          100% { left: calc(100% + 20px); opacity: 0; }
        }

        .form-progress-text {
          font-size: 12.5px;
          font-weight: 500;
          color: #6B7A99;
          white-space: nowrap;
          flex-shrink: 0;
          letter-spacing: 0.1px;
          min-width: 150px;
          text-align: right;
          transition: color 0.3s ease;
        }
        .form-progress-text strong {
          color: #165DFF;
          font-weight: 700;
        }

        body.dark-mode .form-progress-pill {
          background: #1a2645;
          border-color: rgba(255,255,255,0.12);
          box-shadow:
            0 4px 28px rgba(0,0,0,0.55),
            0 1px 4px rgba(0,0,0,0.35);
        }
        body.dark-mode .form-progress-bar-track { background: #263558; }
        body.dark-mode .form-progress-bar-fill {
          background: linear-gradient(90deg, #4d8aff 0%, #78b0ff 100%);
        }
        body.dark-mode .form-progress-text {
          color: #c8d6f0;
          font-weight: 600;
        }
        body.dark-mode .form-progress-text strong {
          color: #78b0ff;
          font-weight: 800;
        }

        /* ===================== BOT√ìN FLOTANTE ‚Äî INICIAR TR√ÅMITE ===================== */
        .tramite-float {
            position: fixed;
            top: 50px;
            left: 50px;
            background: linear-gradient(135deg, #0A1F44 0%, #1a3a6e 100%);
            color: white;
            width: 75px;
            height: 75px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(10, 31, 68, 0.4);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            animation: floatPremium 3s ease-in-out infinite;
            border: 4px solid white;
            overflow: hidden;
        }

        .tramite-float::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
            animation: shine 3s infinite;
        }

        .tramite-float:hover {
            transform: scale(1.2) translateY(-5px);
            box-shadow: 0 20px 40px rgba(10, 31, 68, 0.6);
            animation: none;
        }

        .tramite-tooltip {
            position: absolute;
            left: 95px;
            background: white;
            color: #0A1F44;
            padding: 15px 25px;
            border-radius: 12px;
            white-space: nowrap;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            font-weight: 600;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1001;
        }

        .tramite-float:hover .tramite-tooltip {
            opacity: 1;
            transform: translateX(10px);
        }

        .tramite-icon {
            width: 36px;
            height: 36px;
            position: relative;
            z-index: 1;
            fill: white;
        }

        @keyframes floatPremium {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-15px) rotate(2deg);
            }
            75% {
                transform: translateY(-5px) rotate(-2deg);
            }
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
        @media(max-width:640px){
            body { padding:10px 10px 90px; }
            .hdr, .form-card { padding-left:20px; padding-right:20px; }
            .hdr { padding-top:28px; padding-bottom:26px; }
            .hdr-logo { font-size:2rem; }
            .g2 { grid-template-columns:1fr; }
            .wa-btn { width:58px; height:58px; bottom:24px; left:18px; }
            .wa-svg { width:26px; height:26px; }
            .wa-tip { display:none; }
            .theme-toggle-btn { top: 14px; right: 14px; width: 44px; height: 44px; }
            .icon-sun, .icon-moon { width: 22px; height: 22px; }
            .form-progress-wrap { width: calc(100% - 24px); bottom: 16px; }
            .form-progress-pill { padding: 8px 14px 8px 12px; gap: 10px; }
            .form-progress-text { font-size: 11.5px; min-width: 110px; }
            .tramite-float {
                width: 65px;
                height: 65px;
                top: 30px;
                left: 30px;
            }
            .tramite-icon {
                width: 32px;
                height: 32px;
            }
            .tramite-tooltip {
                display: none;
            }
        }
    </style>
</head>
<body>

<!-- ===== BOT√ìN FLOTANTE ‚Äî INICIAR TR√ÅMITE ===== -->
<a href="https://www.anpai.com.mx/iniciar-tramite"
   class="tramite-float"
   target="_blank"
   rel="noopener noreferrer"
   aria-label="Iniciar tr√°mite en ANPAI">
    <span class="tramite-tooltip">üìù Iniciar tr√°mite</span>
    <svg class="tramite-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
    </svg>
</a>

<!-- ===== BOT√ìN MODO CLARO / OSCURO ===== -->
<button class="theme-toggle-btn" id="themeToggleBtn"
        aria-label="Cambiar tema claro/oscuro" title="Cambiar tema">
  <div class="toggle-icon-wrap">
    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="4.5" fill="#FFD700" stroke="#FFA500" stroke-width="1.4"/>
      <g stroke="#FFD700" stroke-width="2" stroke-linecap="round">
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(0 12 12)">
          <animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/>
        </line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(45 12 12)">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
        </line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(90 12 12)">
          <animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/>
        </line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(135 12 12)">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
        </line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(180 12 12)">
          <animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/>
        </line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(225 12 12)">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
        </line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(270 12 12)">
          <animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/>
        </line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(315 12 12)">
          <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
        </line>
      </g>
    </svg>
    <svg class="icon-moon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
            fill="#c8d0ff" stroke="#4169E1" stroke-width="1.5"/>
      <circle cx="15" cy="9" r="1" fill="#fff8c0" opacity="0.85">
        <animate attributeName="opacity" values="0.85;0.3;0.85" dur="4s" repeatCount="indefinite"/>
      </circle>
      <circle cx="17" cy="13" r="0.7" fill="#fff8c0" opacity="0.6">
        <animate attributeName="opacity" values="0.6;0.2;0.6" dur="3s" repeatCount="indefinite"/>
      </circle>
      <circle cx="13" cy="15" r="0.55" fill="#fff8c0" opacity="0.4">
        <animate attributeName="opacity" values="0.4;0.1;0.4" dur="5s" repeatCount="indefinite"/>
      </circle>
    </svg>
  </div>
</button>

<!-- WhatsApp flotante -->
<a href="https://wa.me/527771234567?text=Hola,%20tengo%20una%20consulta%20sobre%20tr%C3%A1mites%20vehiculares"
   class="wa-btn" target="_blank" rel="noopener noreferrer">
    <svg class="wa-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
    </svg>
    <div class="wa-tip">üí¨ ¬øDudas? Chatea con nosotros</div>
</a>

<div class="elfsight-app-beb4a331-0ecc-4c09-b401-4d88d35cbf03" data-elfsight-app-lazy></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FORMULARIO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="wrapper">

    <!-- Header -->
    <div class="hdr">
        <div class="hdr-logo"><span class="letra-a">A</span><span class="letra-va">VA</span></div>
        <div class="hdr-sub">Tr√°mites Vehiculares en Morelos</div>
    </div>

    <!-- Form -->
    <div class="form-card">
        <form id="tramiteForm" action="https://formsubmit.co/info@anpai.com.mx" method="POST" enctype="multipart/form-data" novalidate>
            <input type="hidden" name="_subject" value="Nueva solicitud de tr√°mite vehicular ‚Äî AVA Morelos">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_captcha" value="false">
            <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off">
            <input type="hidden" name="_autoresponse" value="Hemos recibido tu solicitud de tr√°mite vehicular. En breve nos pondremos en contacto contigo. ‚Äî AVA Tr√°mites Vehiculares en Morelos">
            <input type="hidden" name="_cc" value="info@anpai.com.mx">
            <input type="hidden" name="_next" value="https://ava-tramites-vehiculares.github.io/gracias.html">

            <!-- 1. Datos Generales -->
            <div class="sec-title">
                <div class="sec-icon">üë§</div>
                <h2>Datos Personales</h2>
            </div>

            <div class="g2">
                <div class="fld g-full">
                    <label for="nombre">Nombre completo <span class="req">*</span></label>
                    <input type="text" id="nombre" name="nombre" placeholder="Tu nombre completo" required>
                </div>
                <div class="fld">
                    <label for="telefono">Tel√©fono de contacto <span class="req">*</span></label>
                    <div class="phone-wrap">
                        <div class="lada-custom" id="ladaCustom">
                            <div class="lada-trigger" id="ladaTrigger">
                                <span class="lada-flag">üá≤üáΩ</span>
                                <span class="lada-code">+52</span>
                                <span class="lada-arrow">‚ñº</span>
                            </div>
                            <div class="lada-dropdown" id="ladaDropdown">
                                <div class="lada-search">
                                    <input type="text" id="ladaSearchInput" placeholder="üîç Buscar pa√≠s‚Ä¶" autocomplete="off">
                                </div>
                                <div id="ladaOptionsList"></div>
                            </div>
                        </div>
                        <select id="ladaPais" name="lada" class="lada-select-hidden" aria-label="Lada del pa√≠s">
                            <option value="+52" selected>+52</option>
                            <option value="+1">+1</option>
                            <option value="+1-CA">+1</option>
                            <option value="+502">+502</option>
                            <option value="+503">+503</option>
                            <option value="+504">+504</option>
                            <option value="+505">+505</option>
                            <option value="+506">+506</option>
                            <option value="+507">+507</option>
                            <option value="+53">+53</option>
                            <option value="+57">+57</option>
                            <option value="+58">+58</option>
                            <option value="+51">+51</option>
                            <option value="+56">+56</option>
                            <option value="+54">+54</option>
                            <option value="+55">+55</option>
                            <option value="+593">+593</option>
                            <option value="+591">+591</option>
                            <option value="+595">+595</option>
                            <option value="+598">+598</option>
                            <option value="+34">+34</option>
                            <option value="+33">+33</option>
                            <option value="+44">+44</option>
                            <option value="+49">+49</option>
                            <option value="+39">+39</option>
                            <option value="+351">+351</option>
                            <option value="+31">+31</option>
                            <option value="+32">+32</option>
                            <option value="+41">+41</option>
                            <option value="+43">+43</option>
                            <option value="+7">+7</option>
                            <option value="+86">+86</option>
                            <option value="+81">+81</option>
                            <option value="+82">+82</option>
                            <option value="+91">+91</option>
                            <option value="+61">+61</option>
                            <option value="+64">+64</option>
                            <option value="+27">+27</option>
                            <option value="+971">+971</option>
                            <option value="+966">+966</option>
                            <option value="+972">+972</option>
                            <option value="+90">+90</option>
                        </select>
                        <input type="tel" id="telefono" name="telefono" placeholder="Ej: 7771234567" required class="phone-input">
                    </div>
                </div>
                <div class="fld">
                    <label for="email">Correo electr√≥nico <span class="req">*</span></label>
                    <input type="email" id="email" name="email" placeholder="correo@ejemplo.com" required>
                </div>
            </div>

            <div class="div"></div>

            <!-- 2. Tipo de Tr√°mite -->
            <div class="sec-title">
                <div class="sec-icon">üöó</div>
                <h2>Tipo de Tr√°mite</h2>
            </div>

            <div class="fld">
                <label for="tipoTramite">Seleccione el tr√°mite <span class="req">*</span></label>
                <select id="tipoTramite" name="tipoTramite" required>
                    <option value="">‚Äî Seleccione una opci√≥n ‚Äî</option>
                    <option value="alta">Alta vehicular</option>
                    <option value="refrendo">Refrendo</option>
                </select>
            </div>

            <!-- ‚ïê‚ïê SECCI√ìN ALTA VEHICULAR ‚ïê‚ïê -->
            <div id="sec-alta" class="sec-hide">
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">üí∞</div>
                    <h2>Valor del Veh√≠culo y Costo</h2>
                </div>
                <div class="fld">
                    <label for="valorVehiculo">Valor del veh√≠culo <span class="req">*</span><span class="opt">(pesos mexicanos MXN)</span></label>
                    <input type="number" id="valorVehiculo" name="valorVehiculo" min="0" placeholder="Ej: 850000">
                </div>
                <div class="cost-pill" id="costPill">
                    <span class="cp-lbl">Costo total del tr√°mite</span>
                    <span class="cp-amt" id="costoTotal">$0.00</span>
                </div>
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">üìã</div>
                    <h2>Requisitos para Alta Vehicular</h2>
                </div>
                <div class="rbox">
                    <div class="rbox-head"><span>üìå</span> Documentaci√≥n necesaria</div>
                    <div class="rbox-body">
                        <div class="r-alert">
                            <strong>IMPORTANTE:</strong> Todos los requisitos marcados como obligatorios son indispensables para procesar el tr√°mite. El costo total incluye el pago de derechos e impuestos correspondientes, por lo que no es necesario que el cliente los abone por separado.
                        </div>
                        <div class="rg-title">Personas F√≠sicas</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Factura de origen y archivo XML de la misma.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Carta factura (vigente 30 d√≠as m√°x.) ‚Äî solo si la compra fue a cr√©dito.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Identificaci√≥n oficial vigente con fotograf√≠a (INE, pasaporte, licencia de conducir de Morelos, etc.).</li>
                            <li class="op"><span class="bOp">Opcional</span> Comprobante de domicilio en Morelos no mayor a 3 meses.</li>
                            <li class="op"><span class="bOp">Opcional</span> Identificaci√≥n del titular del comprobante de domicilio (si no es el propietario del veh√≠culo).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> P√≥liza de seguro automotriz vigente.</li>
                        </ul>
                        <div class="rg-title">Personas Morales</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Factura de origen y archivo XML de la misma.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Carta factura (vigente 30 d√≠as m√°x.).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Acta constitutiva.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Poder notarial que acredite la representaci√≥n legal.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Identificaci√≥n oficial vigente del representante legal.</li>
                            <li class="op"><span class="bOp">Opcional</span> Comprobante de domicilio en Morelos a nombre de la empresa, no mayor a 3 meses.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Constancia de situaci√≥n fiscal actualizada de la empresa y del representante legal.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> P√≥liza de seguro automotriz vigente.</li>
                        </ul>
                        <div class="r-fmt">
                            <strong>üìÑ REQUISITOS DE FORMATO</strong><br>
                            Todos los documentos deben estar escaneados en <strong>formato PDF</strong> y ser completamente legibles. Si hay muchos archivos o son muy grandes, compr√≠malos en <strong>formato ZIP o RAR</strong>.
                        </div>
                    </div>
                </div>
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">üìé</div>
                    <h2>Cargar Documentaci√≥n</h2>
                </div>
                <div class="fld">
                    <label>Adjuntar Documentos <span class="req">*</span></label>
                    <div class="fdrop" id="dropAlta">
                        <input type="file" id="documentos" name="documentos" accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" multiple>
                        <div class="fd-icon">üìÅ</div>
                        <div class="fd-main">Arrastra tus archivos aqu√≠ o <span class="fd-link">haz clic para seleccionar</span></div>
                        <div class="fd-sub">Formatos: PDF, JPG, PNG, ZIP, RAR &nbsp;|&nbsp; <strong>L√≠mite total: 5 MB</strong></div>
                        <div class="fd-hint">üí° Si tus documentos superan el l√≠mite, compr√≠melos en un archivo <strong>ZIP o RAR</strong> antes de adjuntarlos</div>
                    </div>
                    <div class="fmgr" id="fmgrAlta" style="display:none">
                        <div class="fmgr-bar-wrap">
                            <div class="fmgr-bar-label">
                                <span>Capacidad utilizada</span>
                                <span id="fmgrAltaLabel">0 MB de 5 MB</span>
                            </div>
                            <div class="fmgr-bar-track"><div class="fmgr-bar-fill" id="fmgrAltaFill" style="width:0%"></div></div>
                            <div class="fmgr-status"><div class="fmgr-dot" id="fmgrAltaDot"></div><span id="fmgrAltaStatus"></span></div>
                        </div>
                        <div class="fmgr-error" id="fmgrAltaError"></div>
                        <div class="fmgr-list" id="fmgrAltaList"></div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê SECCI√ìN REFRENDO ‚ïê‚ïê -->
            <div id="sec-ref" class="sec-hide">
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">üîÑ</div>
                    <h2>Datos del Refrendo</h2>
                </div>
                <div class="g2">
                    <div class="fld g-full">
                        <label for="numeroPlacas">N√∫mero de placas <span class="req">*</span></label>
                        <input type="text" id="numeroPlacas" name="numeroPlacas" placeholder="Ej: ABC-123-X">
                    </div>
                    <div class="fld g-full">
                        <label for="tipoUnidad">Tipo de unidad a refrendar <span class="req">*</span></label>
                        <select id="tipoUnidad" name="tipoUnidad">
                            <option value="">‚Äî Seleccione el tipo de unidad ‚Äî</option>
                            <option value="autos" data-costo="2764.28">Autom√≥viles particulares</option>
                            <option value="camiones" data-costo="2655.71">Camiones, remolques, autos antiguos y demostradoras</option>
                            <option value="motos" data-costo="2384.28">Motocicletas</option>
                            <option value="capacidades" data-costo="2492.85">Veh√≠culos con capacidades diferentes</option>
                            <option value="publico" data-costo="3144.27">Transporte p√∫blico</option>
                        </select>
                    </div>
                </div>
                <div class="cost-pill" id="costPillRef">
                    <span class="cp-lbl">Costo total del refrendo</span>
                    <span class="cp-amt" id="costoTotalRef">$0.00</span>
                </div>
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">üìã</div>
                    <h2>Requisitos para Refrendo</h2>
                </div>
                <div class="rbox">
                    <div class="rbox-head"><span>üìå</span> Documentaci√≥n necesaria</div>
                    <div class="rbox-body">
                        <div class="r-alert">
                            <strong>IMPORTANTE:</strong> Todos los requisitos son indispensables para procesar el tr√°mite. El costo total incluye el pago de derechos e impuestos correspondientes.
                        </div>
                        <div class="rg-title">Personas F√≠sicas</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Identificaci√≥n oficial con fotograf√≠a vigente (INE ‚Äî por los dos lados, pasaporte, licencia de conducir de Morelos, etc.).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> P√≥liza de seguro automotriz vigente expedida por una aseguradora registrada.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Tarjeta de circulaci√≥n anterior.</li>
                        </ul>
                        <div class="rg-title">Personas Morales</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Todos los requisitos de Personas F√≠sicas, m√°s:</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> RFC de la empresa (constancia de situaci√≥n fiscal).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Acta constitutiva certificada ante notario p√∫blico.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Poder notarial que acredite la representaci√≥n legal.</li>
                        </ul>
                        <div class="r-fmt">
                            <strong>üìÑ REQUISITOS DE FORMATO</strong><br>
                            Todos los documentos deben estar escaneados en <strong>formato PDF</strong> y ser completamente legibles. Se pueden enviar en un solo archivo o <strong>comprimidos en ZIP o RAR</strong>.
                        </div>
                    </div>
                </div>
                <div class="div"></div>
                <div class="sec-title">
                    <div class="sec-icon">üìé</div>
                    <h2>Cargar Documentaci√≥n</h2>
                </div>
                <div class="fld">
                    <label>Adjuntar Documentos <span class="req">*</span></label>
                    <div class="fdrop" id="dropRef">
                        <input type="file" id="docsRefrendo" name="docsRefrendo" accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" multiple>
                        <div class="fd-icon">üìÅ</div>
                        <div class="fd-main">Arrastra tus archivos aqu√≠ o <span class="fd-link">haz clic para seleccionar</span></div>
                        <div class="fd-sub">Formatos: PDF, JPG, PNG, ZIP, RAR &nbsp;|&nbsp; <strong>L√≠mite total: 5 MB</strong></div>
                        <div class="fd-hint">üí° Si tus documentos superan el l√≠mite, compr√≠melos en un archivo <strong>ZIP o RAR</strong> antes de adjuntarlos</div>
                    </div>
                    <div class="fmgr" id="fmgrRef" style="display:none">
                        <div class="fmgr-bar-wrap">
                            <div class="fmgr-bar-label">
                                <span>Capacidad utilizada</span>
                                <span id="fmgrRefLabel">0 MB de 5 MB</span>
                            </div>
                            <div class="fmgr-bar-track"><div class="fmgr-bar-fill" id="fmgrRefFill" style="width:0%"></div></div>
                            <div class="fmgr-status"><div class="fmgr-dot" id="fmgrRefDot"></div><span id="fmgrRefStatus"></span></div>
                        </div>
                        <div class="fmgr-error" id="fmgrRefError"></div>
                        <div class="fmgr-list" id="fmgrRefList"></div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê CASILLA DE VERIFICACI√ìN ‚ïê‚ïê -->
            <div id="sec-declaracion" class="sec-hide">
                <div class="div"></div>
                <div class="check-wrap">
                    <label class="check-label" for="declaracion">
                        <input type="checkbox" id="declaracion" name="declaracion">
                        <span class="check-box"></span>
                        <span class="check-txt">DECLARO BAJO MI RESPONSABILIDAD QUE TODA LA INFORMACI√ìN PROPORCIONADA EN ESTE FORMULARIO ES VERDADERA, ACTUAL Y AUT√âNTICA. ASIMISMO, CERTIFICO QUE LOS DOCUMENTOS ADJUNTADOS SON COPIAS FIELES DE SUS ORIGINALES Y NO HAN SIDO ALTERADOS DE NINGUNA MANERA. CON ESTA ACCI√ìN, VALIDO QUE HE TOMADO CONOCIMIENTO DE LOS ASPECTOS RELEVANTES DEL TR√ÅMITE Y QUE LOS REQUISITOS MARCADOS COMO OBLIGATORIOS LOS HE REUNIDO.</span>
                    </label>
                </div>
            </div>

            <div class="recap" id="recapWrap">
                <div class="recap-spin" id="recapSpin" style="display:none;"></div>
                <div class="recap-txt" id="recapTxt"></div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn" disabled>
                Enviar Solicitud
            </button>

            <div class="toast" id="toastMsg"></div>
        </form>
    </div>
</div>

<!-- ===== BARRA DE PROGRESO FLOTANTE ===== -->
<div class="form-progress-wrap" id="formProgressWrap">
  <div class="form-progress-pill">
    <div class="form-progress-bar-track">
      <div class="form-progress-bar-fill" id="formProgressFill"></div>
    </div>
    <span class="form-progress-text">
      <strong id="formProgressDone">0</strong>
      de
      <span id="formProgressTotal">0</span>
      campos completados
    </span>
  </div>
</div>

<script>
    /* ‚ïê‚ïê THEME TOGGLE ‚ïê‚ïê */
    var THEME_STORAGE_KEY = 'ava-morelos-theme';
    (function initTheme() {
        try {
            if (localStorage.getItem(THEME_STORAGE_KEY) === 'dark') {
                document.body.classList.add('dark-mode');
            }
        } catch(e) {}
    })();

    document.addEventListener('DOMContentLoaded', function() {
        var themeBtn = document.getElementById('themeToggleBtn');
        if (themeBtn) {
            themeBtn.addEventListener('click', function() {
                var isDark = document.body.classList.toggle('dark-mode');
                try {
                    localStorage.setItem(THEME_STORAGE_KEY, isDark ? 'dark' : 'light');
                } catch(e) {}
                themeBtn.style.boxShadow = isDark
                    ? '0 0 24px rgba(65,105,225,0.75)'
                    : '0 0 24px rgba(255,215,0,0.75)';
                setTimeout(function() { themeBtn.style.boxShadow = ''; }, 400);
            });
        }
    });

    /* ‚ïê‚ïê CUSTOM LADA DROPDOWN ‚ïê‚ïê */
    const LADAS = [
        { region:'Am√©rica del Norte', flag:'üá®üá¶', name:'Canad√°',           code:'+1',   val:'+1-CA'  },
        { region:'Am√©rica del Norte', flag:'üá≤üáΩ', name:'M√©xico',           code:'+52',  val:'+52'    },
        { region:'Am√©rica del Norte', flag:'üá∫üá∏', name:'Estados Unidos',   code:'+1',   val:'+1'     },
        { region:'Am√©rica Central y Caribe', flag:'üá®üá∑', name:'Costa Rica',    code:'+506', val:'+506'   },
        { region:'Am√©rica Central y Caribe', flag:'üá®üá∫', name:'Cuba',          code:'+53',  val:'+53'    },
        { region:'Am√©rica Central y Caribe', flag:'üá∏üáª', name:'El Salvador',   code:'+503', val:'+503'   },
        { region:'Am√©rica Central y Caribe', flag:'üá¨üáπ', name:'Guatemala',     code:'+502', val:'+502'   },
        { region:'Am√©rica Central y Caribe', flag:'üá≠üá≥', name:'Honduras',      code:'+504', val:'+504'   },
        { region:'Am√©rica Central y Caribe', flag:'üá≥üáÆ', name:'Nicaragua',     code:'+505', val:'+505'   },
        { region:'Am√©rica Central y Caribe', flag:'üáµüá¶', name:'Panam√°',        code:'+507', val:'+507'   },
        { region:'Am√©rica del Sur', flag:'üá¶üá∑', name:'Argentina',       code:'+54',  val:'+54'    },
        { region:'Am√©rica del Sur', flag:'üáßüá¥', name:'Bolivia',         code:'+591', val:'+591'   },
        { region:'Am√©rica del Sur', flag:'üáßüá∑', name:'Brasil',          code:'+55',  val:'+55'    },
        { region:'Am√©rica del Sur', flag:'üá®üá±', name:'Chile',           code:'+56',  val:'+56'    },
        { region:'Am√©rica del Sur', flag:'üá®üá¥', name:'Colombia',        code:'+57',  val:'+57'    },
        { region:'Am√©rica del Sur', flag:'üá™üá®', name:'Ecuador',         code:'+593', val:'+593'   },
        { region:'Am√©rica del Sur', flag:'üáµüáæ', name:'Paraguay',        code:'+595', val:'+595'   },
        { region:'Am√©rica del Sur', flag:'üáµüá™', name:'Per√∫',            code:'+51',  val:'+51'    },
        { region:'Am√©rica del Sur', flag:'üá∫üáæ', name:'Uruguay',         code:'+598', val:'+598'   },
        { region:'Am√©rica del Sur', flag:'üáªüá™', name:'Venezuela',       code:'+58',  val:'+58'    },
        { region:'Europa', flag:'üá©üá™', name:'Alemania',        code:'+49',  val:'+49'    },
        { region:'Europa', flag:'üá¶üáπ', name:'Austria',         code:'+43',  val:'+43'    },
        { region:'Europa', flag:'üáßüá™', name:'B√©lgica',         code:'+32',  val:'+32'    },
        { region:'Europa', flag:'üá™üá∏', name:'Espa√±a',          code:'+34',  val:'+34'    },
        { region:'Europa', flag:'üá´üá∑', name:'Francia',         code:'+33',  val:'+33'    },
        { region:'Europa', flag:'üáÆüáπ', name:'Italia',          code:'+39',  val:'+39'    },
        { region:'Europa', flag:'üá≥üá±', name:'Pa√≠ses Bajos',    code:'+31',  val:'+31'    },
        { region:'Europa', flag:'üáµüáπ', name:'Portugal',        code:'+351', val:'+351'   },
        { region:'Europa', flag:'üá¨üáß', name:'Reino Unido',     code:'+44',  val:'+44'    },
        { region:'Europa', flag:'üá∑üá∫', name:'Rusia',           code:'+7',   val:'+7'     },
        { region:'Europa', flag:'üá®üá≠', name:'Suiza',           code:'+41',  val:'+41'    },
        { region:'Asia y Medio Oriente', flag:'üá∏üá¶', name:'Arabia Saudita',  code:'+966', val:'+966'   },
        { region:'Asia y Medio Oriente', flag:'üá®üá≥', name:'China',           code:'+86',  val:'+86'    },
        { region:'Asia y Medio Oriente', flag:'üá¶üá™', name:'Emiratos √Årabes', code:'+971', val:'+971'   },
        { region:'Asia y Medio Oriente', flag:'üáÆüá≥', name:'India',           code:'+91',  val:'+91'    },
        { region:'Asia y Medio Oriente', flag:'üáÆüá±', name:'Israel',          code:'+972', val:'+972'   },
        { region:'Asia y Medio Oriente', flag:'üáØüáµ', name:'Jap√≥n',           code:'+81',  val:'+81'    },
        { region:'Asia y Medio Oriente', flag:'üá∞üá∑', name:'Corea del Sur',   code:'+82',  val:'+82'    },
        { region:'Asia y Medio Oriente', flag:'üáπüá∑', name:'Turqu√≠a',         code:'+90',  val:'+90'    },
        { region:'Ocean√≠a', flag:'üá¶üá∫', name:'Australia',       code:'+61',  val:'+61'    },
        { region:'Ocean√≠a', flag:'üá≥üáø', name:'Nueva Zelanda',   code:'+64',  val:'+64'    },
        { region:'√Åfrica', flag:'üáøüá¶', name:'Sud√°frica',        code:'+27',  val:'+27'    },
    ];

    let ladaSelected = LADAS.find(l => l.val === '+52');

    const ladaCustom   = document.getElementById('ladaCustom');
    const ladaTrigger  = document.getElementById('ladaTrigger');
    const ladaDropdown = document.getElementById('ladaDropdown');
    const ladaSearchIn = document.getElementById('ladaSearchInput');
    const ladaOptsList = document.getElementById('ladaOptionsList');
    const ladaHidden   = document.getElementById('ladaPais');

    function renderLadaOptions(filter) {
        const q = (filter || '').toLowerCase();
        ladaOptsList.innerHTML = '';
        const filtered = LADAS.filter(l =>
            !q || l.name.toLowerCase().includes(q) || l.code.includes(q)
        );
        if (!q) {
            let currentRegion = null;
            filtered.forEach(l => {
                if (l.region !== currentRegion) {
                    currentRegion = l.region;
                    const hdr = document.createElement('div');
                    hdr.style.cssText = 'padding:6px 12px 3px;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--azul-blue);background:var(--gris-light);border-bottom:1px solid var(--gris-border);position:sticky;top:40px;';
                    hdr.textContent = l.region;
                    ladaOptsList.appendChild(hdr);
                }
                ladaOptsList.appendChild(buildLadaOpt(l));
            });
        } else {
            filtered.forEach(l => ladaOptsList.appendChild(buildLadaOpt(l)));
        }
    }

    function buildLadaOpt(l) {
        const div = document.createElement('div');
        div.className = 'lada-opt' + (l.val === ladaSelected.val ? ' active' : '');
        div.innerHTML = `<span class="lo-flag">${l.flag}</span>
                         <span class="lo-name">${l.name}</span>
                         <span class="lo-code">${l.code}</span>`;
        div.addEventListener('click', () => {
            ladaSelected = l;
            ladaTrigger.querySelector('.lada-flag').textContent = l.flag;
            ladaTrigger.querySelector('.lada-code').textContent = l.code;
            ladaHidden.value = l.val;
            closeLada();
        });
        return div;
    }

    function openLada() {
        ladaCustom.classList.add('open');
        ladaSearchIn.value = '';
        renderLadaOptions('');
        ladaSearchIn.focus();
    }
    function closeLada() {
        ladaCustom.classList.remove('open');
        ladaSearchIn.value = '';
        renderLadaOptions('');
    }

    ladaTrigger.addEventListener('click', () => {
        ladaCustom.classList.contains('open') ? closeLada() : openLada();
    });
    ladaSearchIn.addEventListener('input', () => renderLadaOptions(ladaSearchIn.value));
    document.addEventListener('click', e => {
        if (!ladaCustom.contains(e.target)) closeLada();
    });
    renderLadaOptions('');

    /* ‚ïê‚ïê reCAPTCHA v3 ‚ïê‚ïê */
    const RC_KEY = '6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV';
    let   rcApiReady = false;

    function waitForRecaptcha(cb) {
        if (typeof grecaptcha !== 'undefined') {
            grecaptcha.ready(cb);
        } else {
            setTimeout(() => waitForRecaptcha(cb), 200);
        }
    }

    waitForRecaptcha(() => {
        rcApiReady = true;
        const spin = document.getElementById('recapSpin');
        const txt  = document.getElementById('recapTxt');
        if (spin) spin.style.display = 'none';
        if (txt)  { txt.textContent = '‚úì Verificaci√≥n de seguridad lista'; txt.className = 'recap-txt ok'; }
        checkEnvio();
    });

    (function initRecapUI(){
        const spin = document.getElementById('recapSpin');
        const txt  = document.getElementById('recapTxt');
        if (spin) spin.style.display = 'inline-block';
        if (txt)  { txt.textContent = 'Cargando verificaci√≥n de seguridad‚Ä¶'; txt.className = 'recap-txt'; }
    })();

    /* ‚ïê‚ïê BARRA FLOTANTE DE PROGRESO ‚ïê‚ïê */
    var progressState = { currentForm: null, total: 0, done: 0 };

    function getRequiredFieldsForForm(formId) {
        var form = document.getElementById(formId);
        if (!form) return [];
        var fields = [];
        var radioGroups = {};
        var seen = {};
        form.querySelectorAll('[required]').forEach(function(el) {
            if (el.type === 'hidden') return;
            if (el.classList.contains('lada-select-hidden')) return;
            var key = el.name || el.id || ('anon_' + Math.random());
            if (el.type === 'radio') {
                if (!radioGroups[el.name]) {
                    radioGroups[el.name] = true;
                    fields.push({ type: 'radio', name: el.name });
                }
            } else {
                if (!seen[key]) {
                    seen[key] = true;
                    fields.push({ type: 'standard', el: el });
                }
            }
        });
        return fields;
    }

    function isFieldFilled(fieldDef) {
        if (fieldDef.type === 'radio') {
            return document.querySelector('input[name="' + fieldDef.name + '"]:checked') !== null;
        }
        if (fieldDef.type === 'standard') {
            return fieldDef.el && fieldDef.el.value.trim().length > 0;
        }
        return false;
    }

    function updateProgressBar() {
        if (!progressState.currentForm) return;
        var fields = getRequiredFieldsForForm(progressState.currentForm);
        var total  = fields.length;
        var done   = 0;
        fields.forEach(function(f) { if (isFieldFilled(f)) done++; });
        progressState.total = total;
        progressState.done  = done;
        var pct = total > 0 ? (done / total) * 100 : 0;
        document.getElementById('formProgressFill').style.width = pct + '%';
        document.getElementById('formProgressDone').textContent  = done;
        document.getElementById('formProgressTotal').textContent = total;
    }

    function attachProgressListeners(formId) {
        var form = document.getElementById(formId);
        if (!form) return;
        form.querySelectorAll('input, select, textarea').forEach(function(el) {
            el.addEventListener('input',  updateProgressBar);
            el.addEventListener('change', updateProgressBar);
        });
    }

    function showProgressBar(formId) {
        progressState.currentForm = formId;
        document.getElementById('formProgressWrap').classList.add('visible');
        attachProgressListeners(formId);
        updateProgressBar();
    }

    /* ‚îÄ‚îÄ Mostrar/ocultar secciones seg√∫n tr√°mite ‚îÄ‚îÄ */
    document.getElementById('tipoTramite').addEventListener('change', function(){
        const alta  = document.getElementById('sec-alta');
        const ref   = document.getElementById('sec-ref');
        const decl  = document.getElementById('sec-declaracion');

        document.getElementById('numeroPlacas').required  = false;
        document.getElementById('tipoUnidad').required    = false;
        document.getElementById('docsRefrendo').required  = false;
        document.getElementById('valorVehiculo').required = false;
        document.getElementById('documentos').required    = false;

        if (this.value === 'alta') {
            alta.style.display = 'block';
            ref.style.display  = 'none';
            decl.style.display = 'block';
            document.getElementById('valorVehiculo').required = true;
            document.getElementById('documentos').required    = true;
            document.getElementById('costPillRef').classList.remove('show');
            document.getElementById('tipoUnidad').value = '';
        } else if (this.value === 'refrendo') {
            alta.style.display = 'none';
            ref.style.display  = 'block';
            decl.style.display = 'block';
            document.getElementById('numeroPlacas').required  = true;
            document.getElementById('tipoUnidad').required    = true;
            document.getElementById('docsRefrendo').required  = true;
            document.getElementById('costPill').classList.remove('show');
            document.getElementById('valorVehiculo').value = '';
        } else {
            alta.style.display  = 'none';
            ref.style.display   = 'none';
            decl.style.display  = 'none';
        }

        if (this.value === 'alta' || this.value === 'refrendo') {
            showProgressBar('tramiteForm');
        }

        checkEnvio();
        updateProgressBar();
    });

    /* ‚îÄ‚îÄ C√°lculo de costo ‚Äî Alta vehicular ‚îÄ‚îÄ */
    document.getElementById('valorVehiculo').addEventListener('input', function(){
        const v    = parseFloat(this.value) || 0;
        const pill = document.getElementById('costPill');
        const amt  = document.getElementById('costoTotal');
        let   c    = 0;
        if      (v > 0 && v <= 990000)        c = 6000;
        else if (v >= 1000000 && v <= 1950000) c = 6500;
        else if (v >= 2000000)                 c = 7500;
        if (c > 0) {
            amt.textContent = '$' + c.toLocaleString('es-MX', { minimumFractionDigits:2 });
            pill.classList.add('show');
        } else {
            pill.classList.remove('show');
        }
        checkEnvio();
    });

    /* ‚îÄ‚îÄ C√°lculo de costo ‚Äî Refrendo ‚îÄ‚îÄ */
    document.getElementById('tipoUnidad').addEventListener('change', function(){
        const pill = document.getElementById('costPillRef');
        const amt  = document.getElementById('costoTotalRef');
        const opt  = this.options[this.selectedIndex];
        const c    = parseFloat(opt.dataset.costo) || 0;
        if (c > 0) {
            amt.textContent = '$' + c.toLocaleString('es-MX', { minimumFractionDigits:2 });
            pill.classList.add('show');
        } else {
            pill.classList.remove('show');
        }
        checkEnvio();
    });

    /* ‚îÄ‚îÄ File Manager ‚îÄ‚îÄ */
    const MAX_BYTES = 5 * 1024 * 1024;
    const state = { alta: [], ref: [] };

    function formatSize(bytes) {
        if (bytes >= 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        return (bytes / 1024).toFixed(1) + ' KB';
    }
    function totalBytes(files) { return files.reduce((s, f) => s + f.size, 0); }

    function updateManager(key) {
        const files  = state[key];
        const idPfx  = key === 'alta' ? 'fmgrAlta' : 'fmgrRef';
        const mgr    = document.getElementById('fmgr' + (key === 'alta' ? 'Alta' : 'Ref'));
        const fill   = document.getElementById(idPfx + 'Fill');
        const lbl    = document.getElementById(idPfx + 'Label');
        const dot    = document.getElementById(idPfx + 'Dot');
        const status = document.getElementById(idPfx + 'Status');
        const err    = document.getElementById(idPfx + 'Error');
        const list   = document.getElementById(idPfx + 'List');

        if (files.length === 0) { mgr.style.display = 'none'; return; }
        mgr.style.display = 'block';

        const used  = totalBytes(files);
        const pct   = Math.min((used / MAX_BYTES) * 100, 100);

        fill.style.width = pct + '%';
        lbl.textContent  = formatSize(used) + ' de 5 MB';

        let color, dotColor, statusTxt;
        if (pct >= 100) {
            color = '#ef4444'; dotColor = '#ef4444';
            statusTxt = 'üî¥ L√≠mite alcanzado ‚Äî no puedes a√±adir m√°s archivos';
        } else if (pct >= 75) {
            color = '#f59e0b'; dotColor = '#f59e0b';
            const left = formatSize(MAX_BYTES - used);
            statusTxt = '‚ö†Ô∏è Casi lleno ‚Äî quedan ' + left + ' disponibles';
        } else {
            color = '#22c55e'; dotColor = '#22c55e';
            const left = formatSize(MAX_BYTES - used);
            statusTxt = '‚úÖ Capacidad disponible ‚Äî quedan ' + left;
        }
        fill.style.background = color;
        dot.style.background  = dotColor;
        status.textContent    = statusTxt;
        status.style.color    = dotColor;

        list.innerHTML = '';
        files.forEach((f, idx) => {
            const item = document.createElement('div');
            item.className = 'fmgr-item';
            item.innerHTML = `
                <div class="fmgr-item-left">
                    <span class="fmgr-item-icon">üìÑ</span>
                    <span class="fmgr-item-name" title="${f.name}">${f.name}</span>
                </div>
                <span class="fmgr-item-size">${formatSize(f.size)}</span>
                <button type="button" class="fmgr-item-del" data-idx="${idx}" data-key="${key}" title="Eliminar archivo">‚úï</button>`;
            list.appendChild(item);
        });

        list.querySelectorAll('.fmgr-item-del').forEach(btn => {
            btn.addEventListener('click', function() {
                const k = this.dataset.key;
                const i = parseInt(this.dataset.idx);
                state[k].splice(i, 1);
                syncInput(k);
                updateManager(k);
                checkEnvio();
                updateProgressBar();
            });
        });

        err.style.display = 'none';
    }

    function showFmgrError(key, msg) {
        const idPfx = key === 'alta' ? 'fmgrAlta' : 'fmgrRef';
        const err   = document.getElementById(idPfx + 'Error');
        const mgr   = document.getElementById('fmgr' + (key === 'alta' ? 'Alta' : 'Ref'));
        mgr.style.display = 'block';
        err.textContent   = msg;
        err.style.display = 'block';
    }

    function syncInput(key) {
        const dt = new DataTransfer();
        state[key].forEach(f => dt.items.add(f));
        if (key === 'alta') iA.files = dt.files;
        else                iR.files = dt.files;
    }

    function handleFiles(key, newFiles) {
        const existing = state[key];
        const errs     = [];
        Array.from(newFiles).forEach(f => {
            const projectedTotal = totalBytes(existing) + f.size;
            if (projectedTotal > MAX_BYTES) {
                errs.push(`"${f.name}" supera el l√≠mite de 5 MB. Comprime en ZIP/RAR.`);
            } else {
                existing.push(f);
            }
        });
        syncInput(key);
        updateManager(key);
        if (errs.length) showFmgrError(key, errs.join(' | '));
        checkEnvio();
        updateProgressBar();
    }

    const dA = document.getElementById('dropAlta');
    const iA = document.getElementById('documentos');
    ['dragenter','dragover'].forEach(e => dA.addEventListener(e, ev => { ev.preventDefault(); dA.classList.add('drag'); }));
    ['dragleave','drop'].forEach(e => dA.addEventListener(e, ev => { ev.preventDefault(); dA.classList.remove('drag'); }));
    dA.addEventListener('drop', ev => { handleFiles('alta', ev.dataTransfer.files); });
    iA.addEventListener('change', () => { handleFiles('alta', iA.files); iA.value = ''; });

    const dR = document.getElementById('dropRef');
    const iR = document.getElementById('docsRefrendo');
    ['dragenter','dragover'].forEach(e => dR.addEventListener(e, ev => { ev.preventDefault(); dR.classList.add('drag'); }));
    ['dragleave','drop'].forEach(e => dR.addEventListener(e, ev => { ev.preventDefault(); dR.classList.remove('drag'); }));
    dR.addEventListener('drop', ev => { handleFiles('ref', ev.dataTransfer.files); });
    iR.addEventListener('change', () => { handleFiles('ref', iR.files); iR.value = ''; });

    document.getElementById('declaracion').addEventListener('change', checkEnvio);
    document.getElementById('numeroPlacas').addEventListener('input', checkEnvio);
    document.getElementById('tipoUnidad').addEventListener('change', checkEnvio);

    ['nombre', 'telefono', 'email'].forEach(function(id) {
        var el = document.getElementById(id);
        if (el) {
            el.addEventListener('input', updateProgressBar);
            el.addEventListener('change', updateProgressBar);
        }
    });

    function checkEnvio(){
        const tramite   = document.getElementById('tipoTramite').value;
        const declarado = document.getElementById('declaracion').checked;
        const btn       = document.getElementById('submitBtn');

        if (!tramite || !declarado || !rcApiReady) { btn.disabled = true; return; }

        if (tramite === 'alta') {
            const val  = parseFloat(document.getElementById('valorVehiculo').value) || 0;
            const docs = state.alta.length > 0;
            const drop = document.getElementById('dropAlta');
            drop.style.borderColor = !docs ? '#f59e0b' : '';
            btn.disabled = !(val > 0 && docs);
        } else if (tramite === 'refrendo') {
            const plac  = document.getElementById('numeroPlacas').value.trim() !== '';
            const unid  = document.getElementById('tipoUnidad').value !== '';
            const docs  = state.ref.length > 0;
            const drop  = document.getElementById('dropRef');
            drop.style.borderColor = !docs ? '#f59e0b' : '';
            btn.disabled = !(plac && unid && docs);
        } else {
            btn.disabled = true;
        }
    }

    document.getElementById('tramiteForm').addEventListener('submit', function(e){
        e.preventDefault();
        const form = this;

        if (!document.getElementById('declaracion').checked) {
            showToast('Debe marcar la casilla de declaraci√≥n para continuar.','err'); return;
        }
        if (!rcApiReady) {
            showToast('Espere a que se complete la verificaci√≥n de seguridad.','err'); return;
        }

        const btn = document.getElementById('submitBtn');
        btn.disabled    = true;
        btn.textContent = 'Verificando‚Ä¶';

        const lada = document.getElementById('ladaPais').value.replace('-CA','');
        const num  = document.getElementById('telefono').value.trim();
        document.getElementById('telefono').value = lada + ' ' + num;

        grecaptcha.execute(RC_KEY, { action: 'submit' })
            .then(token => {
                let hiddenToken = form.querySelector('input[name="g-recaptcha-response"]');
                if (!hiddenToken) {
                    hiddenToken = document.createElement('input');
                    hiddenToken.type = 'hidden';
                    hiddenToken.name = 'g-recaptcha-response';
                    form.appendChild(hiddenToken);
                }
                hiddenToken.value = token;
                btn.textContent = 'Enviando‚Ä¶';
                form.submit();
            })
            .catch(() => {
                btn.disabled    = false;
                btn.textContent = 'Enviar Solicitud';
                showToast('Error en la verificaci√≥n de seguridad. Intente de nuevo.','err');
            });
    });

    function showToast(msg, type){
        const t = document.getElementById('toastMsg');
        t.textContent = msg; t.className = 'toast '+type;
        setTimeout(() => { t.className = 'toast'; }, 6000);
    }
</script>

</body>
</html>
