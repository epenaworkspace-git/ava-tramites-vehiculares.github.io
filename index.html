<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVA - TrÃ¡mites Vehiculares en Morelos</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap" rel="stylesheet">
    <!-- reCAPTCHA v3: async + defer para evitar ReferenceError si la API aÃºn no cargÃ³ -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV" async defer></script>
    <!-- Elfsight AI Chatbot â€” se carga de forma asÃ­ncrona, no bloquea el formulario -->
    <script src="https://elfsightcdn.com/platform.js" async></script>

    <style>
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

        :root {
            --azul-dark:   #0A1F44;
            --azul-mid:    #162d54;
            --azul-blue:   #165DFF;
            --azul-light:  #e8f0ff;
            --blanco:      #FFFFFF;
            --gris-dark:   #333333;
            --gris-mid:    #6b7280;
            --gris-light:  #f3f6fa;
            --gris-border: #dde3ec;
            --verde:       #22c55e;
            --rojo:        #ef4444;
            --r:           10px;
            --r-lg:        16px;
            --shadow:      0 4px 24px rgba(10,31,68,.10);
            --shadow-lg:   0 8px 40px rgba(10,31,68,.14);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #eef2f8;
            color: var(--gris-dark);
            min-height: 100vh;
            padding: 24px 16px 100px;
        }

        .wrapper {
            max-width: 860px;
            margin: 0 auto;
            animation: fadeUp .6s ease both;
        }
        @keyframes fadeUp {
            from { opacity:0; transform:translateY(20px); }
            to   { opacity:1; transform:translateY(0); }
        }

        /* â”€â”€ HEADER â”€â”€ */
        .hdr {
            background: linear-gradient(135deg, var(--azul-dark) 0%, var(--azul-mid) 100%);
            border-radius: var(--r-lg) var(--r-lg) 0 0;
            padding: 40px 40px 34px;
            text-align: center;
            position: relative; overflow: hidden;
        }
        .hdr::before {
            content:''; position:absolute; inset:0;
            background: radial-gradient(ellipse 80% 60% at 50% 120%, rgba(22,93,255,.28) 0%, transparent 70%);
        }
        .hdr-logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.7rem; font-weight: 800;
            letter-spacing: 3px;
            position: relative; z-index:1; line-height:1; margin-bottom:8px;
        }
        .hdr-logo .letra-a  { color: var(--blanco); font-style:normal; }
        .hdr-logo .letra-va { color: var(--azul-blue); font-style:normal; }
        .hdr-sub {
            font-size: .78rem; font-weight:600; letter-spacing:4px;
            text-transform:uppercase; color:rgba(255,255,255,.70);
            position:relative; z-index:1;
        }



        /* â”€â”€ FORM CARD â”€â”€ */
        .form-card {
            background: var(--blanco);
            border:1px solid var(--gris-border); border-top:none;
            border-radius:0 0 var(--r-lg) var(--r-lg);
            padding: 40px; box-shadow: var(--shadow-lg);
        }

        /* â”€â”€ SECTION TITLE â”€â”€ */
        .sec-title {
            display:flex; align-items:center; gap:12px;
            margin-bottom:24px; padding-bottom:14px;
            border-bottom:2px solid var(--azul-blue);
        }
        .sec-icon {
            width:34px; height:34px; background:var(--azul-light);
            border-radius:8px; display:flex; align-items:center; justify-content:center;
            font-size:1rem; flex-shrink:0;
        }
        .sec-title h2 {
            font-size:.88rem; font-weight:700; letter-spacing:1.5px;
            text-transform:uppercase; color:var(--azul-dark);
        }

        /* â”€â”€ GRID â”€â”€ */
        .g2 { display:grid; grid-template-columns:1fr 1fr; gap:18px; }
        .g-full { grid-column:1 / -1; }

        /* â”€â”€ FIELD â”€â”€ */
        .fld { display:flex; flex-direction:column; gap:6px; }
        .fld label {
            font-size:.8rem; font-weight:600; color:var(--azul-dark); letter-spacing:.2px;
        }
        .fld label .req { color:var(--azul-blue); margin-left:2px; }
        .fld label .opt { color:var(--gris-mid); font-weight:400; font-style:italic; margin-left:4px; font-size:.75rem; }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        select {
            width:100%; padding:11px 14px;
            border:1.5px solid var(--gris-border);
            border-radius:var(--r);
            font-size:.9rem; font-family:'Inter',sans-serif; color:var(--gris-dark);
            background:var(--blanco);
            transition:border-color .25s, box-shadow .25s;
        }
        input::placeholder { color:#b0b9c8; }
        input:focus, select:focus {
            outline:none; border-color:var(--azul-blue);
            box-shadow:0 0 0 3px rgba(22,93,255,.11);
        }
        select {
            cursor:pointer; appearance:none;
            background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23165DFF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat:no-repeat; background-position:right 12px center;
            padding-right:40px;
        }

        /* â”€â”€ DIVIDER â”€â”€ */
        .div { height:1px; background:var(--gris-border); margin:30px 0; }

        /* â”€â”€ COST PILL â”€â”€ */
        .cost-pill {
            display:none; align-items:center; justify-content:space-between;
            background:linear-gradient(135deg, var(--azul-light) 0%, #dbeafe 100%);
            border:1.5px solid var(--azul-blue);
            border-radius:var(--r-lg); padding:14px 20px; margin-top:10px;
            animation:fadeUp .4s ease;
        }
        .cost-pill.show { display:flex; }
        .cp-lbl { font-size:.8rem; font-weight:700; color:var(--azul-dark); }
        .cp-amt { font-size:1.65rem; font-weight:800; color:var(--azul-blue); font-feature-settings:"tnum"; }

        /* â”€â”€ REQ BOX â”€â”€ */
        .rbox { background:var(--gris-light); border-radius:var(--r-lg); border:1px solid var(--gris-border); overflow:hidden; }
        .rbox-head {
            background:var(--azul-dark); color:var(--blanco);
            padding:12px 18px; font-size:.78rem; font-weight:700;
            letter-spacing:1px; text-transform:uppercase;
            display:flex; align-items:center; gap:8px;
        }
        .rbox-body { padding:18px; }
        .r-alert {
            background:#fefce8; border:1px solid #facc15;
            border-radius:8px; padding:12px 14px;
            font-size:.8rem; color:#854d0e; margin-bottom:16px; line-height:1.6;
        }
        .rg-title {
            font-size:.75rem; font-weight:700; text-transform:uppercase;
            letter-spacing:.8px; color:var(--azul-blue); margin:14px 0 7px;
        }
        .rlist { list-style:none; }
        .rlist li {
            font-size:.8rem; line-height:1.6; padding:5px 0 5px 22px;
            position:relative; border-bottom:1px solid rgba(0,0,0,.04);
        }
        .rlist li:last-child { border-bottom:none; }
        .rlist li.ob::before { content:'âœ“'; position:absolute; left:0; top:5px; color:var(--azul-blue); font-weight:800; }
        .rlist li.op::before { content:'â—‹'; position:absolute; left:1px; top:5px; color:var(--gris-mid); font-weight:800; }
        .bOb {
            display:inline-block; background:var(--azul-blue); color:#fff;
            font-size:.6rem; font-weight:800; padding:1px 5px; border-radius:3px;
            margin-right:3px; vertical-align:middle; text-transform:uppercase;
        }
        .bOp {
            display:inline-block; background:var(--gris-mid); color:#fff;
            font-size:.6rem; font-weight:800; padding:1px 5px; border-radius:3px;
            margin-right:3px; vertical-align:middle; text-transform:uppercase;
        }
        .r-fmt {
            background:#eff6ff; border:1px solid #93c5fd;
            border-radius:8px; padding:12px 14px;
            font-size:.79rem; color:#1e40af; margin-top:14px; line-height:1.7;
        }

        /* â”€â”€ FILE DROP â”€â”€ */
        .fdrop {
            border:2px dashed var(--gris-border); border-radius:var(--r-lg);
            padding:26px 18px; text-align:center; cursor:pointer;
            transition:all .3s; background:var(--gris-light); position:relative;
        }
        .fdrop:hover, .fdrop.drag { border-color:var(--azul-blue); background:var(--azul-light); }
        .fdrop input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
        .fd-icon  { font-size:2rem; margin-bottom:6px; }
        .fd-main  { font-size:.85rem; font-weight:700; color:var(--azul-dark); margin-bottom:3px; }
        .fd-sub   { font-size:.75rem; color:var(--gris-mid); }
        .fd-link  { color:var(--azul-blue); font-weight:700; text-decoration:underline; }
        .fd-hint  { font-size:.72rem; color:var(--gris-mid); margin-top:4px; }
        .fd-hint strong { color:var(--azul-dark); }

        /* â”€â”€ FILE MANAGER â”€â”€ */
        .fmgr { margin-top:14px; }
        .fmgr-bar-wrap { margin-bottom:6px; }
        .fmgr-bar-label {
            display:flex; justify-content:space-between; align-items:center;
            font-size:.76rem; font-weight:600; color:var(--azul-dark); margin-bottom:5px;
        }
        .fmgr-bar-track {
            width:100%; height:10px; background:#e5e7eb; border-radius:99px; overflow:hidden;
        }
        .fmgr-bar-fill {
            height:100%; border-radius:99px; transition:width .4s ease, background .4s ease;
            background: var(--verde);
        }
        .fmgr-status {
            display:flex; align-items:center; gap:6px;
            font-size:.75rem; margin-top:5px; margin-bottom:10px;
            font-weight:500;
        }
        .fmgr-dot {
            width:10px; height:10px; border-radius:50%; flex-shrink:0;
            background: var(--verde);
        }
        .fmgr-error {
            font-size:.76rem; color:#b91c1c; background:#fef2f2;
            border:1px solid #fecaca; border-radius:7px;
            padding:7px 12px; margin-bottom:8px; display:none;
        }
        .fmgr-list { display:flex; flex-direction:column; gap:6px; }
        .fmgr-item {
            display:flex; align-items:center; justify-content:space-between;
            background:var(--blanco); border:1px solid var(--gris-border);
            border-radius:9px; padding:9px 12px;
            font-size:.78rem; gap:8px;
        }
        .fmgr-item-left { display:flex; align-items:center; gap:8px; flex:1; min-width:0; }
        .fmgr-item-icon { font-size:1.1rem; flex-shrink:0; }
        .fmgr-item-name { font-weight:600; color:var(--azul-dark); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .fmgr-item-size { color:var(--gris-mid); flex-shrink:0; font-size:.74rem; }
        .fmgr-item-del {
            background:none; border:none; cursor:pointer;
            color:#9ca3af; font-size:1.1rem; line-height:1;
            padding:2px 4px; border-radius:4px; flex-shrink:0;
            transition:color .2s, background .2s;
        }
        .fmgr-item-del:hover { color:#ef4444; background:#fef2f2; }

        /* â”€â”€ RECAPTCHA â”€â”€ */
        .recap { margin:26px 0 18px; text-align:center; min-height:32px; }
        .recap-spin {
            display:inline-block; width:26px; height:26px;
            border:3px solid var(--gris-border);
            border-top:3px solid var(--azul-blue);
            border-radius:50%; animation:spin 1s linear infinite;
        }
        @keyframes spin { to { transform:rotate(360deg); } }
        .recap-txt { font-size:.79rem; margin-top:7px; color:var(--gris-mid); }
        .recap-txt.ok  { color:var(--verde); }
        .recap-txt.err { color:var(--rojo); }

        /* â”€â”€ SUBMIT â”€â”€ */
        .btn-submit {
            width:100%; padding:14px;
            background:linear-gradient(135deg, var(--azul-blue) 0%, #0d3dcc 100%);
            color:var(--blanco); border:none; border-radius:var(--r-lg);
            font-family:'Inter',sans-serif; font-size:.9rem; font-weight:700;
            letter-spacing:.8px; text-transform:uppercase;
            cursor:pointer;
            box-shadow:0 6px 18px rgba(22,93,255,.28);
            transition:transform .2s, box-shadow .2s, opacity .2s;
        }
        .btn-submit:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 10px 28px rgba(22,93,255,.38); }
        .btn-submit:disabled { opacity:.5; cursor:not-allowed; }

        /* â”€â”€ TOAST â”€â”€ */
        .toast { display:none; margin-top:16px; padding:13px 16px; border-radius:var(--r); font-size:.84rem; font-weight:600; text-align:center; }
        .toast.ok  { background:#f0fdf4; color:#166534; border:1px solid #bbf7d0; display:block; }
        .toast.err { background:#fef2f2; color:#991b1b; border:1px solid #fecaca; display:block; }

        /* â”€â”€ HIDDEN â”€â”€ */
        .sec-hide { display:none; }

        /* â”€â”€ WHATSAPP â”€â”€ */
        .wa-btn {
            position:fixed; bottom:50px; left:50px;
            background:linear-gradient(135deg,#25d366 0%,#128c7e 100%);
            color:white; width:72px; height:72px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            box-shadow:0 10px 30px rgba(37,211,102,.4);
            cursor:pointer; z-index:900;
            transition:all .4s cubic-bezier(.4,0,.2,1);
            text-decoration:none;
            animation:waFloat 3s ease-in-out infinite;
            border:4px solid white; overflow:hidden;
        }
        .wa-btn::before {
            content:''; position:absolute; inset:0;
            background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.3) 50%,transparent 70%);
            animation:waShine 3s infinite;
        }
        .wa-btn:hover { transform:scale(1.18) translateY(-5px); box-shadow:0 20px 40px rgba(37,211,102,.6); animation:none; }
        .wa-tip {
            position:absolute; left:90px; background:white; color:#333;
            padding:11px 18px; border-radius:10px; white-space:nowrap;
            box-shadow:0 8px 24px rgba(0,0,0,.14); opacity:0; pointer-events:none;
            transition:all .4s cubic-bezier(.4,0,.2,1);
            font-size:.85rem; font-weight:600;
            border:1px solid rgba(0,0,0,.08); z-index:901;
        }
        .wa-btn:hover .wa-tip { opacity:1; transform:translateX(10px); }
        .wa-svg { width:32px; height:32px; position:relative; z-index:1; }
        .wa-svg path { fill:white; }
        @keyframes waFloat {
            0%,100% { transform:translateY(0) rotate(0deg); }
            25%      { transform:translateY(-13px) rotate(2deg); }
            75%      { transform:translateY(-5px) rotate(-2deg); }
        }
        @keyframes waShine {
            0%   { transform:translateX(-100%); }
            100% { transform:translateX(100%); }
        }

        /* â”€â”€ Elfsight: z-index seguro, no tape el form â”€â”€ */
        .elfsight-app-beb4a331-0ecc-4c09-b401-4d88d35cbf03 { z-index:950 !important; }

        /* â”€â”€ CASILLA DE VERIFICACIÃ“N â”€â”€ */
        .check-wrap {
            background: var(--gris-light);
            border: 1.5px solid var(--gris-border);
            border-radius: var(--r-lg);
            padding: 18px 20px;
        }
        .check-label {
            display: flex; align-items: flex-start; gap: 14px; cursor: pointer;
        }
        .check-label input[type="checkbox"] { display: none; }
        .check-box {
            width: 22px; height: 22px; min-width: 22px;
            border: 2px solid var(--gris-border);
            border-radius: 5px; background: var(--blanco);
            display: flex; align-items: center; justify-content: center;
            margin-top: 1px;
            transition: all .2s ease;
        }
        .check-box::after {
            content: ''; display: none;
            width: 6px; height: 11px;
            border: 2.5px solid var(--blanco);
            border-top: none; border-left: none;
            transform: rotate(45deg) translateY(-1px);
        }
        .check-label input:checked ~ .check-box {
            background: var(--azul-blue); border-color: var(--azul-blue);
        }
        .check-label input:checked ~ .check-box::after { display: block; }
        .check-label:hover .check-box { border-color: var(--azul-blue); }
        .check-txt {
            font-size: .77rem; line-height: 1.65;
            color: var(--gris-dark); font-weight: 500;
        }

        /* â”€â”€ TELÃ‰FONO CON LADA â”€â”€ */
        .phone-wrap {
            display: flex; gap: 0;
            border: 1.5px solid var(--gris-border);
            border-radius: var(--r);
            overflow: hidden;
            transition: border-color .25s, box-shadow .25s;
        }
        .phone-wrap:focus-within {
            border-color: var(--azul-blue);
            box-shadow: 0 0 0 3px rgba(22,93,255,.11);
        }
        .lada-select {
            border: none !important;
            border-right: 1.5px solid var(--gris-border) !important;
            border-radius: 0 !important;
            background-color: var(--gris-light);
            min-width: 110px; width: auto;
            padding: 11px 10px 11px 12px;
            font-size: .85rem;
            box-shadow: none !important;
            flex-shrink: 0;
            background-position: right 6px center;
            padding-right: 28px;
        }
        .lada-select:focus { outline: none; box-shadow: none !important; border-color: var(--gris-border) !important; }
        .phone-input {
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            flex: 1;
        }
        .phone-input:focus { outline: none; box-shadow: none !important; }

        /* â”€â”€ RESPONSIVE â”€â”€ */
        @media(max-width:640px){
            body { padding:10px 10px 90px; }
            .hdr, .form-card { padding-left:20px; padding-right:20px; }
            .hdr { padding-top:28px; padding-bottom:26px; }
            .hdr-logo { font-size:2rem; }
            .g2 { grid-template-columns:1fr; }

            .wa-btn { width:58px; height:58px; bottom:24px; left:18px; }
            .wa-svg { width:26px; height:26px; }
            .wa-tip { display:none; }
        }
    </style>
</head>
<body>

<!-- WhatsApp flotante -->
<a href="https://wa.me/527771234567?text=Hola,%20tengo%20una%20consulta%20sobre%20tr%C3%A1mites%20vehiculares"
   class="wa-btn" target="_blank" rel="noopener noreferrer">
    <svg class="wa-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
    </svg>
    <div class="wa-tip">ğŸ’¬ Â¿Dudas? Chatea con nosotros</div>
</a>

<!-- Elfsight Chatbot â€” colocado fuera del form, no interfiere con nada -->
<div class="elfsight-app-beb4a331-0ecc-4c09-b401-4d88d35cbf03" data-elfsight-app-lazy></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• FORMULARIO â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="wrapper">

    <!-- Header -->
    <div class="hdr">
        <div class="hdr-logo"><span class="letra-a">A</span><span class="letra-va">VA</span></div>
        <div class="hdr-sub">TrÃ¡mites Vehiculares en Morelos</div>
    </div>




    <!-- Form -->
    <div class="form-card">
        <form id="tramiteForm" action="https://formsubmit.co/info@anpai.com.mx" method="POST" enctype="multipart/form-data" novalidate>
            <!-- â•â• ConfiguraciÃ³n FormSubmit (documentaciÃ³n oficial) â•â• -->
            <!-- Asunto del correo recibido -->
            <input type="hidden" name="_subject" value="Nueva solicitud de trÃ¡mite vehicular â€” AVA Morelos">
            <!-- Plantilla visual en tabla para mejor lectura -->
            <input type="hidden" name="_template" value="table">
            <!-- Deshabilita el captcha propio de FormSubmit (usamos reCAPTCHA v3 propio) -->
            <input type="hidden" name="_captcha" value="false">
            <!-- Honeypot anti-spam (campo oculto; si un bot lo llena, el envÃ­o se ignora) -->
            <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off">
            <!-- Respuesta automÃ¡tica al remitente (usa el campo email del form) -->
            <input type="hidden" name="_autoresponse" value="Hemos recibido tu solicitud de trÃ¡mite vehicular. En breve nos pondremos en contacto contigo. â€” AVA TrÃ¡mites Vehiculares en Morelos">
            <!-- Copia del correo al corredor designado (CC) -->
            <input type="hidden" name="_cc" value="info@anpai.com.mx">
            <!-- Redirigir al usuario tras el envÃ­o exitoso (personaliza esta URL) -->
            <input type="hidden" name="_next" value="https://ava-tramites-vehiculares.github.io/gracias.html">

            <!-- 1. Datos Generales -->
            <div class="sec-title">
                <div class="sec-icon">ğŸ‘¤</div>
                <h2>Datos Personales</h2>
            </div>

            <div class="g2">
                <div class="fld g-full">
                    <label for="nombre">Nombre completo <span class="req">*</span></label>
                    <input type="text" id="nombre" name="nombre" placeholder="Tu nombre completo" required>
                </div>
                <div class="fld">
                    <label for="telefono">TelÃ©fono de contacto <span class="req">*</span></label>
                    <div class="phone-wrap">
                        <select id="ladaPais" name="lada" class="lada-select" aria-label="Lada del paÃ­s">
                            <option value="+52" data-flag="ğŸ‡²ğŸ‡½" selected>ğŸ‡²ğŸ‡½ +52</option>
                            <option value="+1" data-flag="ğŸ‡ºğŸ‡¸">ğŸ‡ºğŸ‡¸ +1</option>
                            <option value="+1-CA" data-flag="ğŸ‡¨ğŸ‡¦">ğŸ‡¨ğŸ‡¦ +1</option>
                            <option value="+502" data-flag="ğŸ‡¬ğŸ‡¹">ğŸ‡¬ğŸ‡¹ +502</option>
                            <option value="+503" data-flag="ğŸ‡¸ğŸ‡»">ğŸ‡¸ğŸ‡» +503</option>
                            <option value="+504" data-flag="ğŸ‡­ğŸ‡³">ğŸ‡­ğŸ‡³ +504</option>
                            <option value="+505" data-flag="ğŸ‡³ğŸ‡®">ğŸ‡³ğŸ‡® +505</option>
                            <option value="+506" data-flag="ğŸ‡¨ğŸ‡·">ğŸ‡¨ğŸ‡· +506</option>
                            <option value="+507" data-flag="ğŸ‡µğŸ‡¦">ğŸ‡µğŸ‡¦ +507</option>
                            <option value="+53" data-flag="ğŸ‡¨ğŸ‡º">ğŸ‡¨ğŸ‡º +53</option>
                            <option value="+57" data-flag="ğŸ‡¨ğŸ‡´">ğŸ‡¨ğŸ‡´ +57</option>
                            <option value="+58" data-flag="ğŸ‡»ğŸ‡ª">ğŸ‡»ğŸ‡ª +58</option>
                            <option value="+51" data-flag="ğŸ‡µğŸ‡ª">ğŸ‡µğŸ‡ª +51</option>
                            <option value="+56" data-flag="ğŸ‡¨ğŸ‡±">ğŸ‡¨ğŸ‡± +56</option>
                            <option value="+54" data-flag="ğŸ‡¦ğŸ‡·">ğŸ‡¦ğŸ‡· +54</option>
                            <option value="+55" data-flag="ğŸ‡§ğŸ‡·">ğŸ‡§ğŸ‡· +55</option>
                            <option value="+593" data-flag="ğŸ‡ªğŸ‡¨">ğŸ‡ªğŸ‡¨ +593</option>
                            <option value="+591" data-flag="ğŸ‡§ğŸ‡´">ğŸ‡§ğŸ‡´ +591</option>
                            <option value="+595" data-flag="ğŸ‡µğŸ‡¾">ğŸ‡µğŸ‡¾ +595</option>
                            <option value="+598" data-flag="ğŸ‡ºğŸ‡¾">ğŸ‡ºğŸ‡¾ +598</option>
                            <option value="+34" data-flag="ğŸ‡ªğŸ‡¸">ğŸ‡ªğŸ‡¸ +34</option>
                            <option value="+33" data-flag="ğŸ‡«ğŸ‡·">ğŸ‡«ğŸ‡· +33</option>
                            <option value="+44" data-flag="ğŸ‡¬ğŸ‡§">ğŸ‡¬ğŸ‡§ +44</option>
                            <option value="+49" data-flag="ğŸ‡©ğŸ‡ª">ğŸ‡©ğŸ‡ª +49</option>
                            <option value="+39" data-flag="ğŸ‡®ğŸ‡¹">ğŸ‡®ğŸ‡¹ +39</option>
                            <option value="+351" data-flag="ğŸ‡µğŸ‡¹">ğŸ‡µğŸ‡¹ +351</option>
                            <option value="+31" data-flag="ğŸ‡³ğŸ‡±">ğŸ‡³ğŸ‡± +31</option>
                            <option value="+32" data-flag="ğŸ‡§ğŸ‡ª">ğŸ‡§ğŸ‡ª +32</option>
                            <option value="+41" data-flag="ğŸ‡¨ğŸ‡­">ğŸ‡¨ğŸ‡­ +41</option>
                            <option value="+43" data-flag="ğŸ‡¦ğŸ‡¹">ğŸ‡¦ğŸ‡¹ +43</option>
                            <option value="+7" data-flag="ğŸ‡·ğŸ‡º">ğŸ‡·ğŸ‡º +7</option>
                            <option value="+86" data-flag="ğŸ‡¨ğŸ‡³">ğŸ‡¨ğŸ‡³ +86</option>
                            <option value="+81" data-flag="ğŸ‡¯ğŸ‡µ">ğŸ‡¯ğŸ‡µ +81</option>
                            <option value="+82" data-flag="ğŸ‡°ğŸ‡·">ğŸ‡°ğŸ‡· +82</option>
                            <option value="+91" data-flag="ğŸ‡®ğŸ‡³">ğŸ‡®ğŸ‡³ +91</option>
                            <option value="+61" data-flag="ğŸ‡¦ğŸ‡º">ğŸ‡¦ğŸ‡º +61</option>
                            <option value="+64" data-flag="ğŸ‡³ğŸ‡¿">ğŸ‡³ğŸ‡¿ +64</option>
                            <option value="+27" data-flag="ğŸ‡¿ğŸ‡¦">ğŸ‡¿ğŸ‡¦ +27</option>
                            <option value="+971" data-flag="ğŸ‡¦ğŸ‡ª">ğŸ‡¦ğŸ‡ª +971</option>
                            <option value="+966" data-flag="ğŸ‡¸ğŸ‡¦">ğŸ‡¸ğŸ‡¦ +966</option>
                            <option value="+972" data-flag="ğŸ‡®ğŸ‡±">ğŸ‡®ğŸ‡± +972</option>
                            <option value="+90" data-flag="ğŸ‡¹ğŸ‡·">ğŸ‡¹ğŸ‡· +90</option>
                        </select>
                        <input type="tel" id="telefono" name="telefono" placeholder="Ej: 7771234567" required class="phone-input">
                    </div>
                </div>
                <div class="fld">
                    <label for="email">Correo electrÃ³nico <span class="req">*</span></label>
                    <input type="email" id="email" name="email" placeholder="correo@ejemplo.com" required>
                </div>
            </div>

            <div class="div"></div>

            <!-- 2. Tipo de TrÃ¡mite -->
            <div class="sec-title">
                <div class="sec-icon">ğŸš—</div>
                <h2>Tipo de TrÃ¡mite</h2>
            </div>

            <div class="fld">
                <label for="tipoTramite">Seleccione el trÃ¡mite <span class="req">*</span></label>
                <select id="tipoTramite" name="tipoTramite" required>
                    <option value="">â€” Seleccione una opciÃ³n â€”</option>
                    <option value="alta">Alta vehicular</option>
                    <option value="refrendo">Refrendo</option>
                </select>
            </div>

            <!-- â•â• SECCIÃ“N ALTA VEHICULAR â•â• -->
            <div id="sec-alta" class="sec-hide">
                <div class="div"></div>

                <div class="sec-title">
                    <div class="sec-icon">ğŸ’°</div>
                    <h2>Valor del VehÃ­culo y Costo</h2>
                </div>

                <div class="fld">
                    <label for="valorVehiculo">Valor del vehÃ­culo <span class="req">*</span><span class="opt">(pesos mexicanos MXN)</span></label>
                    <input type="number" id="valorVehiculo" name="valorVehiculo" min="0" placeholder="Ej: 850000">
                </div>
                <div class="cost-pill" id="costPill">
                    <span class="cp-lbl">Costo total del trÃ¡mite</span>
                    <span class="cp-amt" id="costoTotal">$0.00</span>
                </div>

                <div class="div"></div>

                <!-- Requisitos -->
                <div class="sec-title">
                    <div class="sec-icon">ğŸ“‹</div>
                    <h2>Requisitos para Alta Vehicular</h2>
                </div>

                <div class="rbox">
                    <div class="rbox-head"><span>ğŸ“Œ</span> DocumentaciÃ³n necesaria</div>
                    <div class="rbox-body">

                        <div class="r-alert">
                            <strong>IMPORTANTE:</strong> Todos los requisitos marcados como obligatorios son indispensables para procesar el trÃ¡mite. El costo total incluye el pago de derechos e impuestos correspondientes, por lo que no es necesario que el cliente los abone por separado.
                        </div>

                        <div class="rg-title">Personas FÃ­sicas</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Factura de origen y archivo XML de la misma.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Carta factura (vigente 30 dÃ­as mÃ¡x.) â€” solo si la compra fue a crÃ©dito.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> IdentificaciÃ³n oficial vigente con fotografÃ­a (INE, pasaporte, licencia de conducir de Morelos, etc.).</li>
                            <li class="op"><span class="bOp">Opcional</span> Comprobante de domicilio en Morelos no mayor a 3 meses (recibo de luz, agua, predial, estado de cuenta bancario, etc.).</li>
                            <li class="op"><span class="bOp">Opcional</span> IdentificaciÃ³n del titular del comprobante de domicilio (si no es el propietario del vehÃ­culo).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> PÃ³liza de seguro automotriz vigente.</li>
                        </ul>

                        <div class="rg-title">Personas Morales</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Factura de origen y archivo XML de la misma.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Carta factura (vigente 30 dÃ­as mÃ¡x.).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Acta constitutiva.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Poder notarial que acredite la representaciÃ³n legal.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> IdentificaciÃ³n oficial vigente del representante legal.</li>
                            <li class="op"><span class="bOp">Opcional</span> Comprobante de domicilio en Morelos a nombre de la empresa, no mayor a 3 meses.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Constancia de situaciÃ³n fiscal actualizada de la empresa y del representante legal.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> PÃ³liza de seguro automotriz vigente.</li>
                        </ul>

                        <div class="r-fmt">
                            <strong>ğŸ“„ REQUISITOS DE FORMATO</strong><br>
                            Todos los documentos deben estar escaneados en <strong>formato PDF</strong> y ser completamente legibles (texto, sellos y datos claros, sin sombras ni reflejos, orientaciÃ³n correcta, copia fiel a la original).<br>
                            Si hay muchos archivos o son muy grandes, comprÃ­malos en <strong>formato ZIP o RAR</strong>.
                        </div>
                    </div>
                </div>

                <div class="div"></div>

                <!-- Docs Alta -->
                <div class="sec-title">
                    <div class="sec-icon">ğŸ“</div>
                    <h2>Cargar DocumentaciÃ³n</h2>
                </div>

                <div class="fld">
                    <label>Adjuntar Documentos <span class="opt">(opcional â€” factura, pÃ³liza, etc.)</span></label>
                    <div class="fdrop" id="dropAlta">
                        <input type="file" id="documentos" name="documentos" accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" multiple>
                        <div class="fd-icon">ğŸ“</div>
                        <div class="fd-main">Arrastra tus archivos aquÃ­ o <span class="fd-link">haz clic para seleccionar</span></div>
                        <div class="fd-sub">Formatos: PDF, JPG, PNG, ZIP, RAR &nbsp;|&nbsp; <strong>LÃ­mite total: 5 MB</strong> â€” puedes adjuntar varios archivos</div>
                        <div class="fd-hint">ğŸ’¡ Si tus documentos superan el lÃ­mite, comprÃ­melos en un archivo <strong>ZIP o RAR</strong> antes de adjuntarlos</div>
                    </div>
                    <div class="fmgr" id="fmgrAlta" style="display:none">
                        <div class="fmgr-bar-wrap">
                            <div class="fmgr-bar-label">
                                <span>Capacidad utilizada</span>
                                <span id="fmgrAltaLabel">0 MB de 5 MB</span>
                            </div>
                            <div class="fmgr-bar-track"><div class="fmgr-bar-fill" id="fmgrAltaFill" style="width:0%"></div></div>
                            <div class="fmgr-status"><div class="fmgr-dot" id="fmgrAltaDot"></div><span id="fmgrAltaStatus"></span></div>
                        </div>
                        <div class="fmgr-error" id="fmgrAltaError"></div>
                        <div class="fmgr-list" id="fmgrAltaList"></div>
                    </div>
                </div>
            </div>

            <!-- â•â• SECCIÃ“N REFRENDO â•â• -->
            <div id="sec-ref" class="sec-hide">
                <div class="div"></div>

                <div class="sec-title">
                    <div class="sec-icon">ğŸ”„</div>
                    <h2>Datos del Refrendo</h2>
                </div>

                <div class="g2">
                    <div class="fld g-full">
                        <label for="numeroPlacas">NÃºmero de placas <span class="req">*</span></label>
                        <input type="text" id="numeroPlacas" name="numeroPlacas" placeholder="Ej: ABC-123-X">
                    </div>
                    <div class="fld g-full">
                        <label for="tipoUnidad">Tipo de unidad a refrendar <span class="req">*</span></label>
                        <select id="tipoUnidad" name="tipoUnidad">
                            <option value="">â€” Seleccione el tipo de unidad â€”</option>
                            <option value="autos" data-costo="2764.28">AutomÃ³viles particulares</option>
                            <option value="camiones" data-costo="2655.71">Camiones, remolques, autos antiguos y demostradoras</option>
                            <option value="motos" data-costo="2384.28">Motocicletas</option>
                            <option value="capacidades" data-costo="2492.85">VehÃ­culos con capacidades diferentes</option>
                            <option value="publico" data-costo="3144.27">Transporte pÃºblico</option>
                        </select>
                    </div>
                </div>

                <div class="cost-pill" id="costPillRef">
                    <span class="cp-lbl">Costo total del refrendo</span>
                    <span class="cp-amt" id="costoTotalRef">$0.00</span>
                </div>

                <div class="div"></div>

                <!-- Requisitos Refrendo -->
                <div class="sec-title">
                    <div class="sec-icon">ğŸ“‹</div>
                    <h2>Requisitos para Refrendo</h2>
                </div>

                <div class="rbox">
                    <div class="rbox-head"><span>ğŸ“Œ</span> DocumentaciÃ³n necesaria</div>
                    <div class="rbox-body">

                        <div class="r-alert">
                            <strong>IMPORTANTE:</strong> Todos los requisitos son indispensables para procesar el trÃ¡mite. El costo total incluye el pago de derechos e impuestos correspondientes, por lo que no es necesario que el cliente los abone por separado.
                        </div>

                        <div class="rg-title">Personas FÃ­sicas</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> IdentificaciÃ³n oficial con fotografÃ­a vigente (INE â€” por los dos lados, pasaporte, licencia de conducir de Morelos, etc.).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> PÃ³liza de seguro automotriz vigente expedida por una aseguradora registrada.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Tarjeta de circulaciÃ³n anterior.</li>
                        </ul>

                        <div class="rg-title">Personas Morales</div>
                        <ul class="rlist">
                            <li class="ob"><span class="bOb">Obligatorio</span> Todos los requisitos de Personas FÃ­sicas, mÃ¡s:</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> RFC de la empresa (constancia de situaciÃ³n fiscal).</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Acta constitutiva certificada ante notario pÃºblico.</li>
                            <li class="ob"><span class="bOb">Obligatorio</span> Poder notarial que acredite la representaciÃ³n legal.</li>
                        </ul>

                        <div class="r-fmt">
                            <strong>ğŸ“„ REQUISITOS DE FORMATO</strong><br>
                            Todos los documentos deben estar escaneados en <strong>formato PDF</strong> y ser completamente legibles. Texto, sellos y datos visibles sin necesidad de ajustes; sin sombras, reflejos, borrosidad ni manchas. Colores fieles o en escala de grises con buen contraste; orientaciÃ³n correcta y tamaÃ±o proporcional. Copia fiel de la original, sin modificaciones; para identificaciones, incluir anverso y reverso.<br><br>
                            Se pueden enviar en un solo archivo o <strong>comprimidos en ZIP o RAR</strong> si es necesario.
                        </div>
                    </div>
                </div>

                <div class="div"></div>

                <!-- Docs Refrendo -->
                <div class="sec-title">
                    <div class="sec-icon">ğŸ“</div>
                    <h2>Cargar DocumentaciÃ³n</h2>
                </div>

                <div class="fld">
                    <label>Adjuntar Documentos <span class="req">*</span></label>
                    <div class="fdrop" id="dropRef">
                        <input type="file" id="docsRefrendo" name="docsRefrendo" accept=".pdf,.jpg,.jpeg,.png,.zip,.rar" multiple>
                        <div class="fd-icon">ğŸ“</div>
                        <div class="fd-main">Arrastra tus archivos aquÃ­ o <span class="fd-link">haz clic para seleccionar</span></div>
                        <div class="fd-sub">Formatos: PDF, JPG, PNG, ZIP, RAR &nbsp;|&nbsp; <strong>LÃ­mite total: 5 MB</strong> â€” puedes adjuntar varios archivos</div>
                        <div class="fd-hint">ğŸ’¡ Si tus documentos superan el lÃ­mite, comprÃ­melos en un archivo <strong>ZIP o RAR</strong> antes de adjuntarlos</div>
                    </div>
                    <div class="fmgr" id="fmgrRef" style="display:none">
                        <div class="fmgr-bar-wrap">
                            <div class="fmgr-bar-label">
                                <span>Capacidad utilizada</span>
                                <span id="fmgrRefLabel">0 MB de 5 MB</span>
                            </div>
                            <div class="fmgr-bar-track"><div class="fmgr-bar-fill" id="fmgrRefFill" style="width:0%"></div></div>
                            <div class="fmgr-status"><div class="fmgr-dot" id="fmgrRefDot"></div><span id="fmgrRefStatus"></span></div>
                        </div>
                        <div class="fmgr-error" id="fmgrRefError"></div>
                        <div class="fmgr-list" id="fmgrRefList"></div>
                    </div>
                </div>
            </div>

            <!-- â•â• CASILLA DE VERIFICACIÃ“N (ambos trÃ¡mites) â•â• -->
            <div id="sec-declaracion" class="sec-hide">
                <div class="div"></div>
                <div class="check-wrap">
                    <label class="check-label" for="declaracion">
                        <input type="checkbox" id="declaracion" name="declaracion">
                        <span class="check-box"></span>
                        <span class="check-txt">DECLARO BAJO MI RESPONSABILIDAD QUE TODA LA INFORMACIÃ“N PROPORCIONADA EN ESTE FORMULARIO ES VERDADERA, ACTUAL Y AUTÃ‰NTICA. ASIMISMO, CERTIFICO QUE LOS DOCUMENTOS ADJUNTADOS SON COPIAS FIELES DE SUS ORIGINALES Y NO HAN SIDO ALTERADOS DE NINGUNA MANERA. CON ESTA ACCIÃ“N, VALIDO QUE HE TOMADO CONOCIMIENTO DE LOS ASPECTOS RELEVANTES DEL TRÃMITE Y QUE LOS REQUISITOS MARCADOS COMO OBLIGATORIOS LOS HE REUNIDO.</span>
                    </label>
                </div>
            </div>

            <!-- reCAPTCHA invisible -->
            <div class="recap" id="recapWrap">
                <div class="recap-spin" id="recapSpin" style="display:none;"></div>
                <div class="recap-txt" id="recapTxt"></div>
            </div>

            <!-- BotÃ³n enviar -->
            <button type="submit" class="btn-submit" id="submitBtn" disabled>
                Enviar Solicitud
            </button>

            <div class="toast" id="toastMsg"></div>

        </form>
    </div>
</div>

<script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       reCAPTCHA v3 â€” arquitectura robusta
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â€¢ No llama grecaptcha.ready() al cargar:
         evita ReferenceError si la API no llegÃ³ aÃºn.
       â€¢ El token se genera JUSTO ANTES de enviar
         (siempre fresco, nunca caduca).
       â€¢ Se inyecta como <input hidden> para que
         FormSubmit lo reciba correctamente.
       â€¢ Indicador visual: spinner mientras el usuario
         llena el form â†’ se reemplaza con âœ“ cuando
         la API ya estÃ¡ disponible en background.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    const RC_KEY = '6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV';
    let   rcApiReady = false;   // true cuando grecaptcha.ready() disparÃ³

    /* â”€â”€ Esperar a que la API cargue (polling seguro) â”€â”€ */
    function waitForRecaptcha(cb) {
        if (typeof grecaptcha !== 'undefined') {
            grecaptcha.ready(cb);
        } else {
            // La API aÃºn no llegÃ³ (async/defer); reintentamos cada 200 ms
            setTimeout(() => waitForRecaptcha(cb), 200);
        }
    }

    waitForRecaptcha(() => {
        rcApiReady = true;
        // Actualizar indicador visual silenciosamente
        const spin = document.getElementById('recapSpin');
        const txt  = document.getElementById('recapTxt');
        if (spin) spin.style.display = 'none';
        if (txt)  { txt.textContent = 'âœ“ VerificaciÃ³n de seguridad lista'; txt.className = 'recap-txt ok'; }
        checkEnvio();
    });

    /* â”€â”€ Indicador inicial mientras carga â”€â”€ */
    (function initRecapUI(){
        const spin = document.getElementById('recapSpin');
        const txt  = document.getElementById('recapTxt');
        if (spin) spin.style.display = 'inline-block';
        if (txt)  { txt.textContent = 'Cargando verificaciÃ³n de seguridadâ€¦'; txt.className = 'recap-txt'; }
    })();

    /* â”€â”€ Mostrar/ocultar secciones segÃºn trÃ¡mite â”€â”€ */
    document.getElementById('tipoTramite').addEventListener('change', function(){
        const alta  = document.getElementById('sec-alta');
        const ref   = document.getElementById('sec-ref');
        const decl  = document.getElementById('sec-declaracion');

        // Reset required de refrendo
        document.getElementById('numeroPlacas').required  = false;
        document.getElementById('tipoUnidad').required    = false;
        document.getElementById('docsRefrendo').required  = false;
        // Reset required de alta
        document.getElementById('valorVehiculo').required = false;
        document.getElementById('documentos').required    = false;

        if (this.value === 'alta') {
            alta.style.display = 'block';
            ref.style.display  = 'none';
            decl.style.display = 'block';
            document.getElementById('valorVehiculo').required = true;
            document.getElementById('documentos').required    = true;
            // Reset costo refrendo al ocultar
            document.getElementById('costPillRef').classList.remove('show');
            document.getElementById('tipoUnidad').value = '';
        } else if (this.value === 'refrendo') {
            alta.style.display = 'none';
            ref.style.display  = 'block';
            decl.style.display = 'block';
            document.getElementById('numeroPlacas').required  = true;
            document.getElementById('tipoUnidad').required    = true;
            document.getElementById('docsRefrendo').required  = true;
            // Reset costo alta al ocultar
            document.getElementById('costPill').classList.remove('show');
            document.getElementById('valorVehiculo').value = '';
        } else {
            alta.style.display  = 'none';
            ref.style.display   = 'none';
            decl.style.display  = 'none';
        }
        checkEnvio();
    });

    /* â”€â”€ CÃ¡lculo de costo â€” Alta vehicular â”€â”€ */
    document.getElementById('valorVehiculo').addEventListener('input', function(){
        const v    = parseFloat(this.value) || 0;
        const pill = document.getElementById('costPill');
        const amt  = document.getElementById('costoTotal');
        let   c    = 0;

        if      (v > 0 && v <= 990000)        c = 6000;
        else if (v >= 1000000 && v <= 1950000) c = 6500;
        else if (v >= 2000000)                 c = 7500;

        if (c > 0) {
            amt.textContent = '$' + c.toLocaleString('es-MX', { minimumFractionDigits:2 });
            pill.classList.add('show');
        } else {
            pill.classList.remove('show');
        }
        checkEnvio();
    });

    /* â”€â”€ CÃ¡lculo de costo â€” Refrendo â”€â”€ */
    document.getElementById('tipoUnidad').addEventListener('change', function(){
        const pill = document.getElementById('costPillRef');
        const amt  = document.getElementById('costoTotalRef');
        const opt  = this.options[this.selectedIndex];
        const c    = parseFloat(opt.dataset.costo) || 0;

        if (c > 0) {
            amt.textContent = '$' + c.toLocaleString('es-MX', { minimumFractionDigits:2 });
            pill.classList.add('show');
        } else {
            pill.classList.remove('show');
        }
        checkEnvio();
    });

    /* â”€â”€ File Manager â”€â”€ */
    const MAX_BYTES = 5 * 1024 * 1024; // 5 MB

    // State: store files as arrays (not FileList)
    const state = { alta: [], ref: [] };

    function formatSize(bytes) {
        if (bytes >= 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        return (bytes / 1024).toFixed(1) + ' KB';
    }

    function totalBytes(files) { return files.reduce((s, f) => s + f.size, 0); }

    function updateManager(key) {
        const files  = state[key];
        const idPfx  = key === 'alta' ? 'fmgrAlta' : 'fmgrRef';
        const mgr    = document.getElementById('fmgr' + (key === 'alta' ? 'Alta' : 'Ref'));
        const fill   = document.getElementById(idPfx + 'Fill');
        const lbl    = document.getElementById(idPfx + 'Label');
        const dot    = document.getElementById(idPfx + 'Dot');
        const status = document.getElementById(idPfx + 'Status');
        const err    = document.getElementById(idPfx + 'Error');
        const list   = document.getElementById(idPfx + 'List');

        if (files.length === 0) { mgr.style.display = 'none'; return; }
        mgr.style.display = 'block';

        const used  = totalBytes(files);
        const pct   = Math.min((used / MAX_BYTES) * 100, 100);

        fill.style.width = pct + '%';
        lbl.textContent  = formatSize(used) + ' de 5 MB';

        // SemÃ¡foro
        let color, dotColor, statusTxt;
        if (pct >= 100) {
            color = '#ef4444'; dotColor = '#ef4444';
            statusTxt = 'ğŸ”´ LÃ­mite alcanzado â€” no puedes aÃ±adir mÃ¡s archivos';
        } else if (pct >= 75) {
            color = '#f59e0b'; dotColor = '#f59e0b';
            const left = formatSize(MAX_BYTES - used);
            statusTxt = 'âš ï¸ Casi lleno â€” quedan ' + left + ' disponibles';
        } else {
            color = '#22c55e'; dotColor = '#22c55e';
            const left = formatSize(MAX_BYTES - used);
            statusTxt = 'âœ… Capacidad disponible â€” quedan ' + left;
        }
        fill.style.background = color;
        dot.style.background  = dotColor;
        status.textContent    = statusTxt;
        status.style.color    = dotColor;

        // Render list
        list.innerHTML = '';
        files.forEach((f, idx) => {
            const item = document.createElement('div');
            item.className = 'fmgr-item';
            item.innerHTML = `
                <div class="fmgr-item-left">
                    <span class="fmgr-item-icon">ğŸ“„</span>
                    <span class="fmgr-item-name" title="${f.name}">${f.name}</span>
                </div>
                <span class="fmgr-item-size">${formatSize(f.size)}</span>
                <button type="button" class="fmgr-item-del" data-idx="${idx}" data-key="${key}" title="Eliminar archivo">âœ•</button>`;
            list.appendChild(item);
        });

        // Delete buttons
        list.querySelectorAll('.fmgr-item-del').forEach(btn => {
            btn.addEventListener('click', function() {
                const k   = this.dataset.key;
                const i   = parseInt(this.dataset.idx);
                state[k].splice(i, 1);
                syncInput(k);
                updateManager(k);
                checkEnvio();
            });
        });

        // Error messages
        err.style.display = 'none';
    }

    function showFmgrError(key, msg) {
        const idPfx = key === 'alta' ? 'fmgrAlta' : 'fmgrRef';
        const err   = document.getElementById(idPfx + 'Error');
        const mgr   = document.getElementById('fmgr' + (key === 'alta' ? 'Alta' : 'Ref'));
        mgr.style.display = 'block';
        err.textContent   = msg;
        err.style.display = 'block';
    }

    function syncInput(key) {
        // We can't assign to FileList, so we use a DataTransfer trick
        const dt = new DataTransfer();
        state[key].forEach(f => dt.items.add(f));
        if (key === 'alta') iA.files = dt.files;
        else                iR.files = dt.files;
    }

    function handleFiles(key, newFiles) {
        const existing = state[key];
        const usedNow  = totalBytes(existing);
        const errs     = [];

        Array.from(newFiles).forEach(f => {
            const projectedTotal = totalBytes(existing) + f.size;
            if (projectedTotal > MAX_BYTES) {
                errs.push(`"${f.name}" supera el lÃ­mite de 5 MB. Comprime en ZIP/RAR.`);
            } else {
                existing.push(f);
            }
        });

        syncInput(key);
        updateManager(key);

        if (errs.length) showFmgrError(key, errs.join(' | '));

        checkEnvio();
    }

    /* â”€â”€ File drop â€” Alta vehicular â”€â”€ */
    const dA = document.getElementById('dropAlta');
    const iA = document.getElementById('documentos');

    ['dragenter','dragover'].forEach(e => dA.addEventListener(e, ev => { ev.preventDefault(); dA.classList.add('drag'); }));
    ['dragleave','drop'].forEach(e => dA.addEventListener(e, ev => { ev.preventDefault(); dA.classList.remove('drag'); }));
    dA.addEventListener('drop', ev => { handleFiles('alta', ev.dataTransfer.files); });
    iA.addEventListener('change', () => { handleFiles('alta', iA.files); iA.value = ''; });

    /* â”€â”€ File drop â€” Refrendo â”€â”€ */
    const dR = document.getElementById('dropRef');
    const iR = document.getElementById('docsRefrendo');

    ['dragenter','dragover'].forEach(e => dR.addEventListener(e, ev => { ev.preventDefault(); dR.classList.add('drag'); }));
    ['dragleave','drop'].forEach(e => dR.addEventListener(e, ev => { ev.preventDefault(); dR.classList.remove('drag'); }));
    dR.addEventListener('drop', ev => { handleFiles('ref', ev.dataTransfer.files); });
    iR.addEventListener('change', () => { handleFiles('ref', iR.files); iR.value = ''; });

    /* â”€â”€ Casilla de verificaciÃ³n â”€â”€ */
    document.getElementById('declaracion').addEventListener('change', checkEnvio);

    /* â”€â”€ Habilitar/deshabilitar botÃ³n Enviar â”€â”€ */
    function checkEnvio(){
        const tramite   = document.getElementById('tipoTramite').value;
        const declarado = document.getElementById('declaracion').checked;
        const btn       = document.getElementById('submitBtn');

        if (!tramite || !declarado || !rcApiReady) { btn.disabled = true; return; }

        if (tramite === 'alta') {
            const val  = parseFloat(document.getElementById('valorVehiculo').value) || 0;
            const docs = state.alta.length > 0;
            btn.disabled = !(val > 0 && docs);
        } else if (tramite === 'refrendo') {
            const plac  = document.getElementById('numeroPlacas').value.trim() !== '';
            const unid  = document.getElementById('tipoUnidad').value !== '';
            const docs  = state.ref.length > 0;
            btn.disabled = !(plac && unid && docs);
        } else {
            btn.disabled = true;
        }
    }

    /* â”€â”€ EnvÃ­o â€” token fresco generado en el momento del submit â”€â”€ */
    document.getElementById('tramiteForm').addEventListener('submit', function(e){
        e.preventDefault();
        const form = this;

        if (!document.getElementById('declaracion').checked) {
            showToast('Debe marcar la casilla de declaraciÃ³n para continuar.','err'); return;
        }
        if (!rcApiReady) {
            showToast('Espere a que se complete la verificaciÃ³n de seguridad.','err'); return;
        }

        const btn = document.getElementById('submitBtn');
        btn.disabled    = true;
        btn.textContent = 'Verificandoâ€¦';

        // Concatenar lada + nÃºmero en el campo de telÃ©fono antes de enviar
        const lada = document.getElementById('ladaPais').value.replace('-CA','');
        const num  = document.getElementById('telefono').value.trim();
        document.getElementById('telefono').value = lada + ' ' + num;

        /* Generar token fresco (caduca en ~2 min; siempre pedimos uno nuevo aquÃ­) */
        grecaptcha.execute(RC_KEY, { action: 'submit' })
            .then(token => {
                // Inyectar token como campo hidden para que FormSubmit lo reciba
                let hiddenToken = form.querySelector('input[name="g-recaptcha-response"]');
                if (!hiddenToken) {
                    hiddenToken = document.createElement('input');
                    hiddenToken.type = 'hidden';
                    hiddenToken.name = 'g-recaptcha-response';
                    form.appendChild(hiddenToken);
                }
                hiddenToken.value = token;

                btn.textContent = 'Enviandoâ€¦';
                form.submit();   // submit nativo â†’ FormSubmit recibe el token limpio
            })
            .catch(() => {
                btn.disabled    = false;
                btn.textContent = 'Enviar Solicitud';
                showToast('Error en la verificaciÃ³n de seguridad. Intente de nuevo.','err');
            });
    });

    function showToast(msg, type){
        const t = document.getElementById('toastMsg');
        t.textContent = msg; t.className = 'toast '+type;
        setTimeout(() => { t.className = 'toast'; }, 6000);
    }
</script>

</body>
</html>
